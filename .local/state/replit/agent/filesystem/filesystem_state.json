{"file_contents":{"server/replit_integrations/audio/routes.ts":{"content":"import express, { type Express, type Request, type Response } from \"express\";\nimport { chatStorage } from \"../chat/storage\";\nimport { openai, speechToText, ensureCompatibleFormat } from \"./client\";\n\n// Body parser with 50MB limit for audio payloads\nconst audioBodyParser = express.json({ limit: \"50mb\" });\n\nexport function registerAudioRoutes(app: Express): void {\n  // Get all conversations\n  app.get(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const conversations = await chatStorage.getAllConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Get single conversation with messages\n  app.get(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      const conversation = await chatStorage.getConversation(id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const messages = await chatStorage.getMessagesByConversation(id);\n      res.json({ ...conversation, messages });\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  // Create new conversation\n  app.post(\"/api/conversations\", async (req: Request, res: Response) => {\n    try {\n      const { title } = req.body;\n      const conversation = await chatStorage.createConversation(title || \"New Chat\");\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  // Delete conversation\n  app.delete(\"/api/conversations/:id\", async (req: Request, res: Response) => {\n    try {\n      const id = parseInt(req.params.id);\n      await chatStorage.deleteConversation(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  // Send voice message and get streaming audio response\n  // Auto-detects audio format and converts WebM/MP4/OGG to WAV\n  // Uses gpt-4o-mini-transcribe for STT, gpt-audio for voice response\n  app.post(\"/api/conversations/:id/messages\", audioBodyParser, async (req: Request, res: Response) => {\n    try {\n      const conversationId = parseInt(req.params.id);\n      const { audio, voice = \"alloy\" } = req.body;\n\n      if (!audio) {\n        return res.status(400).json({ error: \"Audio data (base64) is required\" });\n      }\n\n      // 1. Auto-detect format and convert to OpenAI-compatible format\n      const rawBuffer = Buffer.from(audio, \"base64\");\n      const { buffer: audioBuffer, format: inputFormat } = await ensureCompatibleFormat(rawBuffer);\n\n      // 2. Transcribe user audio\n      const userTranscript = await speechToText(audioBuffer, inputFormat);\n\n      // 3. Save user message\n      await chatStorage.createMessage(conversationId, \"user\", userTranscript);\n\n      // 4. Get conversation history\n      const existingMessages = await chatStorage.getMessagesByConversation(conversationId);\n      const chatHistory = existingMessages.map((m) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      }));\n\n      // 5. Set up SSE\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      res.write(`data: ${JSON.stringify({ type: \"user_transcript\", data: userTranscript })}\\n\\n`);\n\n      // 6. Stream audio response from gpt-audio\n      const stream = await openai.chat.completions.create({\n        model: \"gpt-audio\",\n        modalities: [\"text\", \"audio\"],\n        audio: { voice, format: \"pcm16\" },\n        messages: chatHistory,\n        stream: true,\n      });\n\n      let assistantTranscript = \"\";\n\n      for await (const chunk of stream) {\n        const delta = chunk.choices?.[0]?.delta as any;\n        if (!delta) continue;\n\n        if (delta?.audio?.transcript) {\n          assistantTranscript += delta.audio.transcript;\n          res.write(`data: ${JSON.stringify({ type: \"transcript\", data: delta.audio.transcript })}\\n\\n`);\n        }\n\n        if (delta?.audio?.data) {\n          res.write(`data: ${JSON.stringify({ type: \"audio\", data: delta.audio.data })}\\n\\n`);\n        }\n      }\n\n      // 7. Save assistant message\n      await chatStorage.createMessage(conversationId, \"assistant\", assistantTranscript);\n\n      res.write(`data: ${JSON.stringify({ type: \"done\", transcript: assistantTranscript })}\\n\\n`);\n      res.end();\n    } catch (error) {\n      console.error(\"Error processing voice message:\", error);\n      if (res.headersSent) {\n        res.write(`data: ${JSON.stringify({ type: \"error\", error: \"Failed to process voice message\" })}\\n\\n`);\n        res.end();\n      } else {\n        res.status(500).json({ error: \"Failed to process voice message\" });\n      }\n    }\n  });\n}\n","path":null,"size_bytes":5151,"size_tokens":null},"server/scripts/seed-products.ts":{"content":"// Seed script to create subscription products and prices in Stripe\n// Run this manually: npx tsx server/scripts/seed-products.ts\n\nimport { getUncachableStripeClient } from '../services/stripeClient';\n\nasync function createSubscriptionProducts() {\n  const stripe = await getUncachableStripeClient();\n  \n  console.log('Creating Gold Predict Pro subscription products...\\n');\n\n  // Check if products already exist\n  const existingProducts = await stripe.products.search({ \n    query: \"metadata['app']:'goldpredict'\" \n  });\n  \n  if (existingProducts.data.length > 0) {\n    console.log('Found existing products. Archiving old ones to recreate...');\n    for (const product of existingProducts.data) {\n      const prices = await stripe.prices.list({ product: product.id });\n      for (const price of prices.data) {\n        if (price.active) {\n          await stripe.prices.update(price.id, { active: false });\n          console.log(`  Archived price: ${price.id}`);\n        }\n      }\n      await stripe.products.update(product.id, { active: false });\n      console.log(`  Archived product: ${product.name} (${product.id})`);\n    }\n    console.log('');\n  }\n\n  // Create Basic Plan\n  const basicProduct = await stripe.products.create({\n    name: 'Gold Predict Basic',\n    description: 'Essential gold market analysis with RSI indicator and limited daily predictions',\n    metadata: {\n      app: 'goldpredict',\n      plan: 'basic',\n      features: 'live_price,basic_chart,rsi,3_predictions_daily',\n    },\n  });\n\n  const basicPrice = await stripe.prices.create({\n    product: basicProduct.id,\n    unit_amount: 999, // $9.99\n    currency: 'usd',\n    recurring: { interval: 'month' },\n    metadata: { plan: 'basic' },\n  });\n\n  console.log(`Created Basic Plan: ${basicProduct.id}`);\n  console.log(`  Price: $9.99/month (${basicPrice.id})\\n`);\n\n  // Create Pro Plan\n  const proProduct = await stripe.products.create({\n    name: 'Gold Predict Pro',\n    description: 'Advanced analysis with all technical indicators, more predictions, and trading signals',\n    metadata: {\n      app: 'goldpredict',\n      plan: 'pro',\n      features: 'live_price,advanced_chart,rsi,macd,sma,10_predictions_daily,signals,weekly_alerts',\n    },\n  });\n\n  const proPrice = await stripe.prices.create({\n    product: proProduct.id,\n    unit_amount: 1999, // $19.99\n    currency: 'usd',\n    recurring: { interval: 'month' },\n    metadata: { plan: 'pro' },\n  });\n\n  console.log(`Created Pro Plan: ${proProduct.id}`);\n  console.log(`  Price: $19.99/month (${proPrice.id})\\n`);\n\n  // Create Premium Plan\n  const premiumProduct = await stripe.products.create({\n    name: 'Gold Predict Premium',\n    description: 'Full access with unlimited predictions, priority signals, premium AI reports, and real-time alerts',\n    metadata: {\n      app: 'goldpredict',\n      plan: 'premium',\n      features: 'live_price,premium_chart,all_indicators,unlimited_predictions,priority_signals,premium_ai,realtime_alerts',\n    },\n  });\n\n  const premiumPrice = await stripe.prices.create({\n    product: premiumProduct.id,\n    unit_amount: 4999, // $49.99\n    currency: 'usd',\n    recurring: { interval: 'month' },\n    metadata: { plan: 'premium' },\n  });\n\n  console.log(`Created Premium Plan: ${premiumProduct.id}`);\n  console.log(`  Price: $49.99/month (${premiumPrice.id})\\n`);\n\n  console.log('All products created successfully!');\n  console.log('\\nProducts will be synced to the database automatically via webhooks.');\n}\n\ncreateSubscriptionProducts().catch(console.error);\n","path":null,"size_bytes":3512,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/replit_integrations/audio/index.ts":{"content":"/**\n * Voice chat client utilities for Replit AI Integrations.\n * \n * Usage:\n * 1. Copy audio-playback-worklet.js to your public/ folder\n * 2. Import and use the React hooks in your components\n * \n * Example:\n * ```tsx\n * import { useVoiceRecorder, useVoiceStream } from \"./audio\";\n * \n * function VoiceChat() {\n *   const [transcript, setTranscript] = useState(\"\");\n *   const recorder = useVoiceRecorder();\n *   const stream = useVoiceStream({\n *     onTranscript: (_, full) => setTranscript(full),\n *     onComplete: (text) => console.log(\"Done:\", text),\n *   });\n * \n *   const handleClick = async () => {\n *     if (recorder.state === \"recording\") {\n *       const blob = await recorder.stopRecording();\n *       await stream.streamVoiceResponse(\"/api/voice-conversations/1/messages\", blob);\n *     } else {\n *       await recorder.startRecording();\n *     }\n *   };\n * \n *   return (\n *     <div>\n *       <button onClick={handleClick}>\n *         {recorder.state === \"recording\" ? \"Stop\" : \"Record\"}\n *       </button>\n *       <p>{transcript}</p>\n *     </div>\n *   );\n * }\n * ```\n */\n\nexport { decodePCM16ToFloat32, createAudioPlaybackContext } from \"./audio-utils\";\nexport { useVoiceRecorder, type RecordingState } from \"./useVoiceRecorder\";\nexport { useAudioPlayback, type PlaybackState } from \"./useAudioPlayback\";\nexport { useVoiceStream } from \"./useVoiceStream\";\n\n","path":null,"size_bytes":1379,"size_tokens":null},"server/replit_integrations/chat/storage.ts":{"content":"import { db } from \"../../db\";\nimport { conversations, messages } from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\nexport interface IChatStorage {\n  getConversation(id: number): Promise<typeof conversations.$inferSelect | undefined>;\n  getAllConversations(): Promise<(typeof conversations.$inferSelect)[]>;\n  createConversation(title: string): Promise<typeof conversations.$inferSelect>;\n  deleteConversation(id: number): Promise<void>;\n  getMessagesByConversation(conversationId: number): Promise<(typeof messages.$inferSelect)[]>;\n  createMessage(conversationId: number, role: string, content: string): Promise<typeof messages.$inferSelect>;\n}\n\nexport const chatStorage: IChatStorage = {\n  async getConversation(id: number) {\n    const [conversation] = await db.select().from(conversations).where(eq(conversations.id, id));\n    return conversation;\n  },\n\n  async getAllConversations() {\n    return db.select().from(conversations).orderBy(desc(conversations.createdAt));\n  },\n\n  async createConversation(title: string) {\n    const [conversation] = await db.insert(conversations).values({ title }).returning();\n    return conversation;\n  },\n\n  async deleteConversation(id: number) {\n    await db.delete(messages).where(eq(messages.conversationId, id));\n    await db.delete(conversations).where(eq(conversations.id, id));\n  },\n\n  async getMessagesByConversation(conversationId: number) {\n    return db.select().from(messages).where(eq(messages.conversationId, conversationId)).orderBy(messages.createdAt);\n  },\n\n  async createMessage(conversationId: number, role: string, content: string) {\n    const [message] = await db.insert(messages).values({ conversationId, role, content }).returning();\n    return message;\n  },\n};\n\n","path":null,"size_bytes":1737,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"server/replit_integrations/image/index.ts":{"content":"export { registerImageRoutes } from \"./routes\";\nexport { generateImageBuffer, editImages } from \"./client\";\n\n","path":null,"size_bytes":109,"size_tokens":null},"server/replit_integrations/audio/index.ts":{"content":"export { registerAudioRoutes } from \"./routes\";\nexport {\n  detectAudioFormat,\n  convertToWav,\n  ensureCompatibleFormat,\n  type AudioFormat,\n  voiceChat,\n  voiceChatStream,\n  textToSpeech,\n  textToSpeechStream,\n  speechToText,\n  speechToTextStream,\n} from \"./client\";\n","path":null,"size_bytes":267,"size_tokens":null},"server/replit_integrations/image/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { openai } from \"./client\";\nimport { isAuthenticated } from \"../auth\";\n\nexport function registerImageRoutes(app: Express): void {\n  app.post(\"/api/generate-image\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { prompt, size = \"1024x1024\" } = req.body;\n\n      if (!prompt) {\n        return res.status(400).json({ error: \"Prompt is required\" });\n      }\n\n      const response = await openai.images.generate({\n        model: \"gpt-image-1\",\n        prompt,\n        n: 1,\n        size: size as \"1024x1024\" | \"512x512\" | \"256x256\",\n      });\n\n      const imageData = response.data[0];\n      res.json({\n        url: imageData.url,\n        b64_json: imageData.b64_json,\n      });\n    } catch (error) {\n      console.error(\"Error generating image:\", error);\n      res.status(500).json({ error: \"Failed to generate image\" });\n    }\n  });\n}\n\n","path":null,"size_bytes":932,"size_tokens":null},"server/replit_integrations/image/client.ts":{"content":"import fs from \"node:fs\";\nimport OpenAI, { toFile } from \"openai\";\nimport { Buffer } from \"node:buffer\";\n\nlet _openai: OpenAI | null = null;\n\nfunction getOpenAI(): OpenAI {\n  if (!_openai) {\n    _openai = new OpenAI({\n      apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || 'dummy-key',\n      baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n    });\n  }\n  return _openai;\n}\n\n/**\n * Generate an image and return as Buffer.\n * Uses gpt-image-1 model via Replit AI Integrations.\n */\nexport async function generateImageBuffer(\n  prompt: string,\n  size: \"1024x1024\" | \"512x512\" | \"256x256\" = \"1024x1024\"\n): Promise<Buffer> {\n  const response = await getOpenAI().images.generate({\n    model: \"gpt-image-1\",\n    prompt,\n    size,\n  });\n  const base64 = response.data[0]?.b64_json ?? \"\";\n  return Buffer.from(base64, \"base64\");\n}\n\n/**\n * Edit/combine multiple images into a composite.\n * Uses gpt-image-1 model via Replit AI Integrations.\n */\nexport async function editImages(\n  imageFiles: string[],\n  prompt: string,\n  outputPath?: string\n): Promise<Buffer> {\n  const images = await Promise.all(\n    imageFiles.map((file) =>\n      toFile(fs.createReadStream(file), file, {\n        type: \"image/png\",\n      })\n    )\n  );\n\n  const response = await getOpenAI().images.edit({\n    model: \"gpt-image-1\",\n    image: images,\n    prompt,\n  });\n\n  const imageBase64 = response.data[0]?.b64_json ?? \"\";\n  const imageBytes = Buffer.from(imageBase64, \"base64\");\n\n  if (outputPath) {\n    fs.writeFileSync(outputPath, imageBytes);\n  }\n\n  return imageBytes;\n}\n\n","path":null,"size_bytes":1548,"size_tokens":null},"server/services/stripeService.ts":{"content":"// Stripe service for subscription management\nimport { getUncachableStripeClient } from './stripeClient';\nimport { db } from '../db';\nimport { users } from '@shared/models/auth';\nimport { eq, sql } from 'drizzle-orm';\n\nexport class StripeService {\n  // Create customer in Stripe\n  async createCustomer(email: string, userId: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.customers.create({\n      email,\n      metadata: { userId },\n    });\n  }\n\n  // Create checkout session for subscription (for redirect flow - deprecated)\n  async createCheckoutSession(\n    customerId: string,\n    priceId: string,\n    userId: string,\n    successUrl: string,\n    cancelUrl: string\n  ) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.checkout.sessions.create({\n      customer: customerId,\n      payment_method_types: ['card'],\n      line_items: [{ price: priceId, quantity: 1 }],\n      mode: 'subscription',\n      success_url: successUrl,\n      cancel_url: cancelUrl,\n      metadata: { userId },\n      subscription_data: {\n        metadata: { userId },\n      },\n    });\n  }\n\n  // Create subscription with incomplete payment for embedded Elements\n  async createSubscriptionWithPaymentIntent(\n    customerId: string,\n    priceId: string,\n    userId: string\n  ) {\n    const stripe = await getUncachableStripeClient();\n    \n    // Cancel stale incomplete subscriptions (older than 60 seconds) to avoid conflicts\n    const existingSubs = await stripe.subscriptions.list({\n      customer: customerId,\n      status: 'incomplete',\n    });\n    const staleThreshold = Math.floor(Date.now() / 1000) - 60;\n    for (const sub of existingSubs.data) {\n      if (sub.created < staleThreshold) {\n        try {\n          await stripe.subscriptions.cancel(sub.id);\n        } catch (e) {\n          console.warn('Could not cancel stale incomplete subscription:', sub.id);\n        }\n      }\n    }\n\n    // Create the subscription with payment_behavior: 'default_incomplete'\n    // This returns a client_secret that can be used with Stripe Elements\n    const subscription = await stripe.subscriptions.create({\n      customer: customerId,\n      items: [{ price: priceId }],\n      payment_behavior: 'default_incomplete',\n      payment_settings: { save_default_payment_method: 'on_subscription' },\n      expand: ['latest_invoice.payment_intent'],\n      metadata: { userId },\n    });\n\n    // Try to get client_secret from expanded invoice.payment_intent (works in older API versions)\n    const invoice = subscription.latest_invoice as any;\n    const paymentIntent = invoice?.payment_intent as any;\n\n    if (paymentIntent?.client_secret) {\n      return {\n        subscriptionId: subscription.id,\n        clientSecret: paymentIntent.client_secret,\n        status: subscription.status,\n      };\n    }\n\n    // In newer Stripe API versions (basil+), payment_intent is not on the invoice object.\n    // Get the invoice ID to match against payment intents deterministically.\n    const invoiceId = typeof invoice === 'string' ? invoice : invoice?.id;\n    const subCreatedAt = (subscription as any).created || Math.floor(Date.now() / 1000);\n    \n    const paymentIntents = await stripe.paymentIntents.list({\n      customer: customerId,\n      created: { gte: subCreatedAt - 10 },\n      limit: 10,\n    });\n    \n    // First try: match PI to the subscription's invoice for deterministic linkage\n    if (invoiceId) {\n      const invoiceLinkedPi = paymentIntents.data.find(\n        pi => (pi as any).invoice === invoiceId\n      );\n      if (invoiceLinkedPi?.client_secret) {\n        return {\n          subscriptionId: subscription.id,\n          clientSecret: invoiceLinkedPi.client_secret,\n          status: subscription.status,\n        };\n      }\n    }\n\n    // Fallback: find the most recently created PI needing payment\n    const pendingPi = paymentIntents.data.find(\n      pi => pi.status === 'requires_payment_method' || pi.status === 'requires_confirmation'\n    );\n    \n    if (pendingPi?.client_secret) {\n      return {\n        subscriptionId: subscription.id,\n        clientSecret: pendingPi.client_secret,\n        status: subscription.status,\n      };\n    }\n\n    throw new Error('Failed to create payment intent');\n  }\n\n  // Confirm subscription after successful payment\n  async confirmSubscription(subscriptionId: string, userId: string) {\n    const stripe = await getUncachableStripeClient();\n    const subscription = await stripe.subscriptions.retrieve(subscriptionId);\n    \n    // Verify the subscription belongs to the authenticated user\n    const user = await this.getUser(userId);\n    if (!user || subscription.customer !== user.stripeCustomerId) {\n      if (subscription.metadata?.userId !== userId) {\n        throw new Error('Subscription does not belong to this user');\n      }\n    }\n    \n    // Get price info to determine plan\n    const priceId = subscription.items.data[0]?.price.id;\n    const price = await stripe.prices.retrieve(priceId);\n    const plan = this.getPlanFromPrice(price.metadata, price.unit_amount || 0);\n    \n    // Map Stripe subscription status to our status\n    // After successful payment, status should be 'active'\n    // Also accept 'trialing' as active\n    const sub = subscription as any;\n    let status = 'inactive';\n    if (sub.status === 'active' || sub.status === 'trialing') {\n      status = 'active';\n    } else if (sub.status === 'past_due') {\n      status = 'past_due';\n    } else if (sub.status === 'incomplete') {\n      // Payment was just confirmed, Stripe may still show incomplete briefly\n      // Check if the latest invoice is paid\n      const invoice = sub.latest_invoice;\n      if (typeof invoice === 'string') {\n        const invoiceObj = await stripe.invoices.retrieve(invoice);\n        if (invoiceObj.status === 'paid') {\n          status = 'active';\n        }\n      } else if (invoice?.status === 'paid') {\n        status = 'active';\n      }\n    }\n\n    await this.updateUserStripeInfo(userId, {\n      stripeCustomerId: subscription.customer as string,\n      stripeSubscriptionId: subscriptionId,\n      subscriptionPlan: plan,\n      subscriptionStatus: status,\n      subscriptionExpiresAt: sub.current_period_end \n        ? new Date(sub.current_period_end * 1000) \n        : null,\n    });\n\n    return subscription;\n  }\n\n  // Create customer portal session for managing subscription\n  async createCustomerPortalSession(customerId: string, returnUrl: string) {\n    const stripe = await getUncachableStripeClient();\n    return await stripe.billingPortal.sessions.create({\n      customer: customerId,\n      return_url: returnUrl,\n    });\n  }\n\n  // Get user by ID\n  async getUser(userId: string) {\n    const [user] = await db.select().from(users).where(eq(users.id, userId));\n    return user;\n  }\n\n  // Update user's Stripe info\n  async updateUserStripeInfo(userId: string, stripeInfo: {\n    stripeCustomerId?: string;\n    stripeSubscriptionId?: string;\n    subscriptionPlan?: string;\n    subscriptionStatus?: string;\n    subscriptionExpiresAt?: Date | null;\n  }) {\n    const [user] = await db\n      .update(users)\n      .set({ ...stripeInfo, updatedAt: new Date() })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  // Get user by Stripe customer ID\n  async getUserByStripeCustomerId(stripeCustomerId: string) {\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(eq(users.stripeCustomerId, stripeCustomerId));\n    return user;\n  }\n\n  // Query products from stripe schema\n  async listProducts() {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.products WHERE active = true`\n    );\n    return result.rows;\n  }\n\n  // Query products with prices (deduplicated - only the newest product per plan key)\n  async listProductsWithPrices() {\n    const result = await db.execute(\n      sql`\n        WITH ranked_products AS (\n          SELECT \n            p.id,\n            p.name,\n            p.description,\n            p.active,\n            p.metadata,\n            p.created,\n            ROW_NUMBER() OVER (\n              PARTITION BY p.metadata->>'plan' \n              ORDER BY p.created DESC\n            ) as rn\n          FROM stripe.products p\n          WHERE p.active = true\n            AND p.metadata->>'app' = 'goldpredict'\n        )\n        SELECT \n          rp.id as product_id,\n          rp.name as product_name,\n          rp.description as product_description,\n          rp.active as product_active,\n          rp.metadata as product_metadata,\n          pr.id as price_id,\n          pr.unit_amount,\n          pr.currency,\n          pr.recurring,\n          pr.active as price_active,\n          pr.metadata as price_metadata\n        FROM ranked_products rp\n        LEFT JOIN stripe.prices pr ON pr.product = rp.id AND pr.active = true\n        WHERE rp.rn = 1\n        ORDER BY pr.unit_amount ASC\n      `\n    );\n    return result.rows;\n  }\n\n  // Get subscription from stripe schema\n  async getSubscription(subscriptionId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.subscriptions WHERE id = ${subscriptionId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  // Get price by ID\n  async getPrice(priceId: string) {\n    const result = await db.execute(\n      sql`SELECT * FROM stripe.prices WHERE id = ${priceId}`\n    );\n    return result.rows[0] || null;\n  }\n\n  // Map price to plan name based on metadata or amount\n  getPlanFromPrice(priceMetadata: any, unitAmount: number): string {\n    if (priceMetadata?.plan) {\n      return priceMetadata.plan;\n    }\n    // Fallback based on price amount (in cents)\n    if (unitAmount <= 999) return 'basic';\n    if (unitAmount <= 1999) return 'pro';\n    return 'premium';\n  }\n}\n\nexport const stripeService = new StripeService();\n","path":null,"size_bytes":9747,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/pages/Pricing.tsx":{"content":"import { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { useSubscription, useSubscriptionPlans, useCheckout, PLAN_FEATURES } from \"@/hooks/use-subscription\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, Loader2, Crown, Zap, TrendingUp } from \"lucide-react\";\n\nconst PLAN_DISPLAY = {\n  basic: {\n    name: \"Basic\",\n    icon: TrendingUp,\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n    description: \"Essential gold market analysis for beginners\",\n    highlights: [\n      \"Real-time XAU/USD price tracking\",\n      \"Basic price chart with zoom controls\",\n      \"RSI technical indicator\",\n      \"3 AI predictions per day\",\n    ],\n  },\n  pro: {\n    name: \"Pro\",\n    icon: Zap,\n    color: \"text-primary\",\n    bgColor: \"bg-primary/10\",\n    description: \"Advanced tools for serious traders\",\n    highlights: [\n      \"Everything in Basic, plus:\",\n      \"MACD and SMA indicators\",\n      \"10 AI predictions per day\",\n      \"Full trading signals access\",\n      \"Weekly market analysis reports\",\n    ],\n    popular: true,\n  },\n  premium: {\n    name: \"Premium\",\n    icon: Crown,\n    color: \"text-amber-500\",\n    bgColor: \"bg-amber-500/10\",\n    description: \"Complete suite for professional traders\",\n    highlights: [\n      \"Everything in Pro, plus:\",\n      \"All technical indicators\",\n      \"Unlimited AI predictions\",\n      \"Priority trading signals\",\n      \"Premium AI market reports\",\n      \"Real-time email alerts\",\n    ],\n  },\n};\n\nfunction formatPrice(amount: number, currency: string) {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currency.toUpperCase(),\n  }).format(amount / 100);\n}\n\nexport default function Pricing() {\n  const { subscription, plan: currentPlan, isActive, isLoading: subLoading } = useSubscription();\n  const { data: plansData, isLoading: plansLoading } = useSubscriptionPlans();\n  const checkout = useCheckout();\n\n  const isLoading = subLoading || plansLoading;\n\n  const handleSubscribe = (priceId: string) => {\n    checkout.mutate(priceId);\n  };\n\n  // Sort plans by price\n  const plans = plansData?.plans?.sort((a, b) => {\n    const priceA = a.prices[0]?.unitAmount || 0;\n    const priceB = b.prices[0]?.unitAmount || 0;\n    return priceA - priceB;\n  }) || [];\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-8 max-w-6xl mx-auto\">\n        <div className=\"text-center\">\n          <h1 className=\"text-4xl font-display font-bold mb-3\">\n            Choose Your Plan\n          </h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Unlock powerful gold market analysis tools and AI-powered predictions.\n            Choose the plan that fits your trading style.\n          </p>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n          </div>\n        ) : plans.length === 0 ? (\n          <Card className=\"text-center py-12\">\n            <CardContent>\n              <p className=\"text-muted-foreground\">\n                Subscription plans are being set up. Please check back soon.\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"grid md:grid-cols-3 gap-6\">\n            {plans.map((plan) => {\n              const planKey = plan.metadata?.plan as keyof typeof PLAN_DISPLAY || 'basic';\n              const display = PLAN_DISPLAY[planKey] || PLAN_DISPLAY.basic;\n              const price = plan.prices[0];\n              const isCurrentPlan = currentPlan === planKey && isActive;\n              const Icon = display.icon;\n\n              return (\n                <Card \n                  key={plan.id} \n                  className={`relative flex flex-col ${display.popular ? 'border-primary shadow-lg shadow-primary/10' : 'border-white/5'}`}\n                  data-testid={`card-plan-${planKey}`}\n                >\n                  {display.popular && (\n                    <Badge \n                      className=\"absolute -top-3 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground\"\n                    >\n                      Most Popular\n                    </Badge>\n                  )}\n                  \n                  <CardHeader className=\"text-center pb-2\">\n                    <div className={`w-12 h-12 mx-auto rounded-full ${display.bgColor} flex items-center justify-center mb-3`}>\n                      <Icon className={`w-6 h-6 ${display.color}`} />\n                    </div>\n                    <CardTitle className=\"text-2xl\">{display.name}</CardTitle>\n                    <CardDescription>{display.description}</CardDescription>\n                  </CardHeader>\n\n                  <CardContent className=\"flex-1 space-y-6\">\n                    <div className=\"text-center\">\n                      {price ? (\n                        <>\n                          <span className=\"text-4xl font-bold\">\n                            {formatPrice(price.unitAmount, price.currency)}\n                          </span>\n                          <span className=\"text-muted-foreground\">/month</span>\n                        </>\n                      ) : (\n                        <span className=\"text-2xl text-muted-foreground\">Price not set</span>\n                      )}\n                    </div>\n\n                    <ul className=\"space-y-3\">\n                      {display.highlights.map((feature, idx) => (\n                        <li key={idx} className=\"flex items-start gap-2\">\n                          <Check className=\"w-5 h-5 text-green-500 shrink-0 mt-0.5\" />\n                          <span className=\"text-sm text-foreground\">{feature}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </CardContent>\n\n                  <CardFooter>\n                    {isCurrentPlan ? (\n                      <Button \n                        className=\"w-full\" \n                        variant=\"outline\" \n                        disabled\n                        data-testid={`button-current-plan-${planKey}`}\n                      >\n                        Current Plan\n                      </Button>\n                    ) : (\n                      <Button\n                        className=\"w-full\"\n                        variant={display.popular ? \"default\" : \"outline\"}\n                        onClick={() => price && handleSubscribe(price.id)}\n                        disabled={!price || checkout.isPending}\n                        data-testid={`button-subscribe-${planKey}`}\n                      >\n                        {checkout.isPending ? (\n                          <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                        ) : null}\n                        {isActive ? 'Switch Plan' : 'Subscribe'}\n                      </Button>\n                    )}\n                  </CardFooter>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Feature Comparison */}\n        <Card className=\"border-white/5\">\n          <CardHeader>\n            <CardTitle>Feature Comparison</CardTitle>\n            <CardDescription>See what's included in each plan</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead>\n                  <tr className=\"border-b border-white/10\">\n                    <th className=\"text-left py-3 px-4 font-medium text-foreground\">Feature</th>\n                    <th className=\"text-center py-3 px-4 font-medium text-foreground\">Basic</th>\n                    <th className=\"text-center py-3 px-4 font-medium text-primary\">Pro</th>\n                    <th className=\"text-center py-3 px-4 font-medium text-amber-500\">Premium</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">Daily Predictions</td>\n                    <td className=\"text-center py-3 px-4\">3</td>\n                    <td className=\"text-center py-3 px-4\">10</td>\n                    <td className=\"text-center py-3 px-4\">Unlimited</td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">RSI Indicator</td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">MACD Indicator</td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">SMA Indicator</td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">Trading Signals</td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">AI Market Analysis</td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                  <tr className=\"border-b border-white/5\">\n                    <td className=\"py-3 px-4 text-muted-foreground\">Real-time Email Alerts</td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><X className=\"w-4 h-4 text-muted-foreground mx-auto\" /></td>\n                    <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* FAQ or Notice */}\n        <Card className=\"border-white/5 bg-primary/5\">\n          <CardContent className=\"py-6\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              All plans include a 7-day money-back guarantee. Cancel anytime from your account settings.\n              Payments are securely processed by Stripe.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":12168,"size_tokens":null},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --font-body: 'DM Sans', sans-serif;\n  --font-display: 'Space Grotesk', sans-serif;\n  --font-mono: 'JetBrains Mono', monospace;\n\n  /* Light Theme Base */\n  --background: 0 0% 100%;\n  --foreground: 224 71.4% 4.1%;\n  --card: 0 0% 100%;\n  --card-foreground: 224 71.4% 4.1%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 224 71.4% 4.1%;\n  --primary: 45 93% 47%;\n  --primary-foreground: 210 40% 98%;\n  --secondary: 210 40% 96.1%;\n  --secondary-foreground: 222.2 47.4% 11.2%;\n  --muted: 210 40% 96.1%;\n  --muted-foreground: 215.4 16.3% 46.9%;\n  --accent: 45 93% 47%;\n  --accent-foreground: 222.2 47.4% 11.2%;\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 210 40% 98%;\n  --border: 214.3 31.8% 91.4%;\n  --input: 214.3 31.8% 91.4%;\n  --ring: 45 93% 47%;\n  --radius: 0.75rem;\n}\n\n.dark {\n  /* Dark Theme Base - Deep Blue/Black */\n  --background: 224 71% 4%;\n  --foreground: 210 40% 98%;\n\n  /* Card / Surface - Slightly lighter */\n  --card: 222 47% 11%;\n  --card-foreground: 210 40% 98%;\n\n  /* Popover */\n  --popover: 222 47% 11%;\n  --popover-foreground: 210 40% 98%;\n\n  /* Primary - Gold/Amber for financial prestige */\n  --primary: 45 93% 47%;\n  --primary-foreground: 224 71% 4%;\n\n  /* Secondary - Muted Blue/Slate */\n  --secondary: 217 19% 27%;\n  --secondary-foreground: 210 40% 98%;\n\n  /* Muted */\n  --muted: 217 19% 27%;\n  --muted-foreground: 215 20.2% 65.1%;\n\n  /* Accent - Deep Gold/Bronze */\n  --accent: 45 93% 47%;\n  --accent-foreground: 224 71% 4%;\n\n  /* Destructive/Bearish - Red */\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 210 40% 98%;\n\n  /* Constructive/Bullish - Green */\n  --success: 142 71% 45%;\n  --success-foreground: 210 40% 98%;\n\n  --border: 217 19% 27%;\n  --input: 217 19% 27%;\n  --ring: 45 93% 47%;\n}\n\n@layer base {\n  body {\n    @apply bg-background text-foreground antialiased selection:bg-primary/20 selection:text-primary;\n    font-family: var(--font-body);\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    font-family: var(--font-display);\n    @apply font-bold tracking-tight text-foreground;\n  }\n\n  /* Trading-specific utility classes */\n  .text-bullish {\n    @apply text-emerald-400;\n  }\n\n  .text-bearish {\n    @apply text-rose-500;\n  }\n  \n  .bg-bullish-gradient {\n    background: linear-gradient(180deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0) 100%);\n  }\n\n  .bg-bearish-gradient {\n    background: linear-gradient(180deg, rgba(244, 63, 94, 0.2) 0%, rgba(244, 63, 94, 0) 100%);\n  }\n}\n\n/* Custom Scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  @apply bg-background;\n}\n\n::-webkit-scrollbar-thumb {\n  @apply bg-secondary rounded-full hover:bg-muted-foreground/50 transition-colors;\n}\n\n/* Glassmorphism utilities */\n.glass-panel {\n  @apply bg-card/80 backdrop-blur-md border border-white/5 shadow-xl;\n}\n\n.gold-glow {\n  box-shadow: 0 0 20px -5px rgba(251, 191, 36, 0.3);\n}\n\n/* ============================================\n   Page Transitions\n   ============================================ */\n.page-transition {\n  width: 100%;\n  min-height: 100vh;\n  will-change: opacity, transform;\n}\n\n.page-enter {\n  animation: pageEnter 0.35s cubic-bezier(0.22, 1, 0.36, 1) forwards;\n}\n\n.page-exit {\n  animation: pageExit 0.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;\n}\n\n@keyframes pageEnter {\n  from {\n    opacity: 0;\n    transform: translateY(6px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes pageExit {\n  from {\n    opacity: 1;\n    transform: translateY(0);\n  }\n  to {\n    opacity: 0;\n    transform: translateY(-4px);\n  }\n}\n\n/* ============================================\n   Bloom / Glow Hover Effects\n   ============================================ */\n\n/* Subtle gold bloom on interactive elements */\n.bloom-hover {\n  transition: box-shadow 0.3s ease, filter 0.3s ease;\n}\n\n.bloom-hover:hover {\n  box-shadow: 0 0 16px -2px hsl(var(--primary) / 0.35),\n              0 0 6px -1px hsl(var(--primary) / 0.2);\n}\n\n/* Stronger bloom for primary/gold elements */\n.bloom-gold {\n  transition: box-shadow 0.3s ease, filter 0.3s ease;\n}\n\n.bloom-gold:hover {\n  box-shadow: 0 0 24px -4px hsl(var(--primary) / 0.5),\n              0 0 10px -2px hsl(var(--primary) / 0.3);\n}\n\n/* Card bloom - softer, wider glow */\n.bloom-card {\n  transition: box-shadow 0.35s ease, transform 0.35s ease;\n}\n\n.bloom-card:hover {\n  box-shadow: 0 4px 30px -8px hsl(var(--primary) / 0.15),\n              0 0 15px -5px hsl(var(--primary) / 0.1);\n}\n\n/* Nav item bloom */\n.bloom-nav {\n  position: relative;\n  transition: background-color 0.2s ease;\n}\n\n.bloom-nav::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  border-radius: inherit;\n  opacity: 0;\n  box-shadow: 0 0 12px -2px hsl(var(--primary) / 0.3);\n  transition: opacity 0.3s ease;\n  pointer-events: none;\n}\n\n.bloom-nav:hover::after {\n  opacity: 1;\n}\n\n/* Subtle content fade-in for staggered elements */\n.fade-in-up {\n  animation: fadeInUp 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;\n  opacity: 0;\n}\n\n.fade-in-up-delay-1 { animation-delay: 0.05s; }\n.fade-in-up-delay-2 { animation-delay: 0.1s; }\n.fade-in-up-delay-3 { animation-delay: 0.15s; }\n.fade-in-up-delay-4 { animation-delay: 0.2s; }\n\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/* Pulse glow for live/active indicators */\n.pulse-glow {\n  animation: pulseGlow 2s ease-in-out infinite;\n}\n\n@keyframes pulseGlow {\n  0%, 100% {\n    box-shadow: 0 0 5px hsl(var(--primary) / 0.2);\n  }\n  50% {\n    box-shadow: 0 0 15px hsl(var(--primary) / 0.4),\n                0 0 5px hsl(var(--primary) / 0.2);\n  }\n}\n","path":null,"size_bytes":5838,"size_tokens":null},"client/src/components/PageTransition.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\n\ninterface PageTransitionProps {\n  children: React.ReactNode;\n}\n\nexport function PageTransition({ children }: PageTransitionProps) {\n  const [location] = useLocation();\n  const [displayChildren, setDisplayChildren] = useState(children);\n  const [transitionStage, setTransitionStage] = useState<\"enter\" | \"exit\">(\"enter\");\n  const previousLocation = useRef(location);\n\n  useEffect(() => {\n    if (location !== previousLocation.current) {\n      setTransitionStage(\"exit\");\n      const timeout = setTimeout(() => {\n        previousLocation.current = location;\n        setDisplayChildren(children);\n        setTransitionStage(\"enter\");\n      }, 200);\n      return () => clearTimeout(timeout);\n    } else {\n      setDisplayChildren(children);\n    }\n  }, [location, children]);\n\n  return (\n    <div\n      className={`page-transition ${transitionStage === \"enter\" ? \"page-enter\" : \"page-exit\"}`}\n      data-testid=\"page-transition-wrapper\"\n    >\n      {displayChildren}\n    </div>\n  );\n}\n","path":null,"size_bytes":1072,"size_tokens":null},"client/replit_integrations/audio/useAudioPlayback.ts":{"content":"/**\n * React hook for streaming audio playback using AudioWorklet.\n * Supports real-time PCM16 audio streaming from SSE responses.\n * Includes sequence buffer for reordering out-of-order chunks.\n */\nimport { useRef, useCallback, useState } from \"react\";\nimport { decodePCM16ToFloat32 } from \"./audio-utils\";\n\nexport type PlaybackState = \"idle\" | \"playing\" | \"ended\";\n\n/**\n * Reorders audio chunks that may arrive out of sequence.\n * Buffers chunks until they can be played in correct order.\n *\n * Example: If chunks arrive as seq 2, seq 0, seq 1:\n * - seq 2 arrives  buffered (waiting for seq 0)\n * - seq 0 arrives  played immediately, then check buffer\n * - seq 1 arrives  played immediately (seq 0 done), seq 2 now plays\n */\nclass SequenceBuffer {\n  private pending = new Map<number, string[]>();\n  private nextSeq = 0;\n\n  /** Add chunk with sequence number, returns chunks ready to play in order */\n  push(seq: number, data: string): string[] {\n    // Store the chunk under its sequence number\n    if (!this.pending.has(seq)) {\n      this.pending.set(seq, []);\n    }\n    this.pending.get(seq)!.push(data);\n\n    // Drain consecutive ready sequences\n    const ready: string[] = [];\n    while (this.pending.has(this.nextSeq)) {\n      ready.push(...this.pending.get(this.nextSeq)!);\n      this.pending.delete(this.nextSeq);\n      this.nextSeq++;\n    }\n    return ready;\n  }\n\n  reset() {\n    this.pending.clear();\n    this.nextSeq = 0;\n  }\n}\n\nexport function useAudioPlayback(workletPath = \"/audio-playback-worklet.js\") {\n  const [state, setState] = useState<PlaybackState>(\"idle\");\n  const ctxRef = useRef<AudioContext | null>(null);\n  const workletRef = useRef<AudioWorkletNode | null>(null);\n  const readyRef = useRef(false);\n  const seqBufferRef = useRef(new SequenceBuffer());\n\n  const init = useCallback(async () => {\n    if (readyRef.current) return;\n\n    const ctx = new AudioContext({ sampleRate: 24000 });\n    await ctx.audioWorklet.addModule(workletPath);\n    const worklet = new AudioWorkletNode(ctx, \"audio-playback-processor\");\n    worklet.connect(ctx.destination);\n\n    worklet.port.onmessage = (e) => {\n      if (e.data.type === \"ended\") setState(\"idle\");\n    };\n\n    ctxRef.current = ctx;\n    workletRef.current = worklet;\n    readyRef.current = true;\n  }, [workletPath]);\n\n  /** Push audio directly (no sequencing) - for simple streaming */\n  const pushAudio = useCallback((base64Audio: string) => {\n    if (!workletRef.current) return;\n    const samples = decodePCM16ToFloat32(base64Audio);\n    workletRef.current.port.postMessage({ type: \"audio\", samples });\n    setState(\"playing\");\n  }, []);\n\n  /** Push audio with sequence number - reorders before playback */\n  const pushSequencedAudio = useCallback((seq: number, base64Audio: string) => {\n    if (!workletRef.current) return;\n\n    const readyChunks = seqBufferRef.current.push(seq, base64Audio);\n    for (const chunk of readyChunks) {\n      const samples = decodePCM16ToFloat32(chunk);\n      workletRef.current.port.postMessage({ type: \"audio\", samples });\n    }\n    if (readyChunks.length > 0) {\n      setState(\"playing\");\n    }\n  }, []);\n\n  const signalComplete = useCallback(() => {\n    workletRef.current?.port.postMessage({ type: \"streamComplete\" });\n  }, []);\n\n  const clear = useCallback(() => {\n    workletRef.current?.port.postMessage({ type: \"clear\" });\n    seqBufferRef.current.reset();\n    setState(\"idle\");\n  }, []);\n\n  return { state, init, pushAudio, pushSequencedAudio, signalComplete, clear };\n}\n","path":null,"size_bytes":3495,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"shared/models/chat.ts":{"content":"import { pgTable, serial, integer, text, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { sql } from \"drizzle-orm\";\n\nexport const conversations = pgTable(\"conversations\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  conversationId: integer(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`).notNull(),\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Conversation = typeof conversations.$inferSelect;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n\n","path":null,"size_bytes":1229,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/services/emailService.ts":{"content":"// Email service for sending automated emails via Gmail\nimport { getGmailClient } from './gmail';\n\ninterface SendEmailOptions {\n  to: string;\n  subject: string;\n  htmlContent: string;\n}\n\nexport async function sendEmail(options: SendEmailOptions): Promise<boolean> {\n  try {\n    const gmail = await getGmailClient();\n    \n    const emailLines = [\n      `To: ${options.to}`,\n      'Content-Type: text/html; charset=utf-8',\n      'MIME-Version: 1.0',\n      `Subject: ${options.subject}`,\n      '',\n      options.htmlContent\n    ];\n    \n    const email = emailLines.join('\\r\\n');\n    const encodedEmail = Buffer.from(email).toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n    \n    await gmail.users.messages.send({\n      userId: 'me',\n      requestBody: {\n        raw: encodedEmail\n      }\n    });\n    \n    console.log(`Email sent successfully to ${options.to}`);\n    return true;\n  } catch (error) {\n    console.error('Failed to send email:', error);\n    return false;\n  }\n}\n\nexport async function sendWelcomeEmail(userEmail: string, userName?: string, nickname?: string): Promise<boolean> {\n  const displayName = nickname || userName || userEmail.split('@')[0];\n  \n  const htmlContent = `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Welcome to Gold Predict</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0a0a0f; color: #e5e5e5;\">\n  <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse;\">\n    <tr>\n      <td style=\"padding: 40px 20px;\">\n        <table role=\"presentation\" style=\"max-width: 600px; margin: 0 auto; background-color: #141419; border-radius: 12px; overflow: hidden; border: 1px solid #2a2a35;\">\n          \n          <!-- Header -->\n          <tr>\n            <td style=\"padding: 40px 40px 20px 40px; text-align: center; background: linear-gradient(135deg, #1a1a22 0%, #0f0f14 100%);\">\n              <div style=\"display: inline-flex; align-items: center; gap: 12px;\">\n                <div style=\"width: 50px; height: 50px; background: linear-gradient(135deg, #D4AF37 0%, #F4C430 50%, #B8860B 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;\">\n                  <span style=\"font-size: 24px; color: #000;\">AU</span>\n                </div>\n                <h1 style=\"margin: 0; font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #D4AF37 0%, #F4C430 50%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;\">Gold Predict</h1>\n              </div>\n            </td>\n          </tr>\n          \n          <!-- Welcome Message -->\n          <tr>\n            <td style=\"padding: 30px 40px;\">\n              <h2 style=\"margin: 0 0 20px 0; font-size: 24px; color: #D4AF37;\">Welcome to Gold Predict, ${displayName}!</h2>\n              <p style=\"margin: 0 0 20px 0; font-size: 16px; line-height: 1.6; color: #b0b0b0;\">\n                Congratulations on joining the premier XAUUSD market analysis platform! You now have access to powerful tools designed to help you make informed trading decisions in the gold market.\n              </p>\n            </td>\n          </tr>\n          \n          <!-- Getting Started Guide -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <h3 style=\"margin: 0 0 20px 0; font-size: 20px; color: #ffffff; border-bottom: 2px solid #D4AF37; padding-bottom: 10px;\">Getting Started Guide</h3>\n              \n              <!-- Step 1 -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">1. Dashboard Overview</h4>\n                <p style=\"margin: 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Your dashboard displays real-time XAU/USD price data, including the current price, 24-hour change, and market status. The price chart shows historical data with interactive zoom controls for different timeframes (1m, 5m, 15m, 30m, 1H, 4H, 1D, 1W, 1M).\n                </p>\n              </div>\n              \n              <!-- Step 2 - All 10 Technical Indicators -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">2. Technical Indicators (10 Available)</h4>\n                <p style=\"margin: 0 0 10px 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Access powerful technical analysis tools based on your subscription plan:\n                </p>\n                <ul style=\"margin: 10px 0 0 0; padding-left: 20px; color: #b0b0b0; font-size: 13px; line-height: 1.9;\">\n                  <li><strong style=\"color: #ffffff;\">RSI (Relative Strength Index)</strong> - Identifies overbought/oversold conditions (0-100 scale)</li>\n                  <li><strong style=\"color: #ffffff;\">MACD (Moving Average Convergence Divergence)</strong> - Shows momentum and trend direction</li>\n                  <li><strong style=\"color: #ffffff;\">SMA (Simple Moving Average)</strong> - Reveals price trends over time</li>\n                  <li><strong style=\"color: #ffffff;\">EMA (Exponential Moving Average)</strong> - More responsive to recent price changes</li>\n                  <li><strong style=\"color: #ffffff;\">Bollinger Bands</strong> - Measures volatility and potential breakouts</li>\n                  <li><strong style=\"color: #ffffff;\">Stochastic Oscillator</strong> - Compares closing price to price range</li>\n                  <li><strong style=\"color: #ffffff;\">Williams %R</strong> - Identifies momentum and reversal points</li>\n                  <li><strong style=\"color: #ffffff;\">CCI (Commodity Channel Index)</strong> - Measures price deviation from average</li>\n                  <li><strong style=\"color: #ffffff;\">Pivot Points</strong> - Key support and resistance levels</li>\n                  <li><strong style=\"color: #ffffff;\">AI Prediction</strong> - Machine learning-based price forecasts</li>\n                </ul>\n              </div>\n              \n              <!-- Step 3 -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">3. AI-Powered Predictions</h4>\n                <p style=\"margin: 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Our advanced prediction system uses statistical models to forecast price movements. Navigate to the <strong style=\"color: #ffffff;\">Predictions</strong> page to generate forecasts for different timeframes and view prediction confidence levels. Daily prediction limits vary by plan (Basic: 3/day, Pro: 10/day, Premium: Unlimited).\n                </p>\n              </div>\n              \n              <!-- Step 4 -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">4. Trading Signals</h4>\n                <p style=\"margin: 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  The <strong style=\"color: #ffffff;\">Signals</strong> page provides actionable trading signals with entry prices, target levels, and stop-loss recommendations. Each signal includes confidence ratings and relevant market analysis. Available for Pro and Premium plans.\n                </p>\n              </div>\n              \n              <!-- Step 5 -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">5. AI Market Analysis</h4>\n                <p style=\"margin: 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Access AI-generated market insights via the notification bell icon. Our AI analyzes current market conditions, provides trading suggestions, and identifies key market trends in real-time. Premium AI reports available for Premium subscribers.\n                </p>\n              </div>\n              \n              <!-- Step 6 - Subscription Plans -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">6. Subscription Plans</h4>\n                <p style=\"margin: 0 0 10px 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Choose the plan that fits your trading needs:\n                </p>\n                <ul style=\"margin: 10px 0 0 0; padding-left: 20px; color: #b0b0b0; font-size: 13px; line-height: 1.9;\">\n                  <li><strong style=\"color: #D4AF37;\">Basic ($9.99/mo)</strong> - RSI indicator, 3 predictions/day</li>\n                  <li><strong style=\"color: #D4AF37;\">Pro ($19.99/mo)</strong> - RSI/MACD/SMA, 10 predictions/day, trading signals, weekly alerts</li>\n                  <li><strong style=\"color: #D4AF37;\">Premium ($49.99/mo)</strong> - All 10 indicators, unlimited predictions, priority signals, AI reports, real-time alerts</li>\n                </ul>\n              </div>\n              \n              <!-- Step 7 - Profile -->\n              <div style=\"margin-bottom: 25px; padding: 20px; background-color: #1a1a22; border-radius: 8px; border-left: 4px solid #D4AF37;\">\n                <h4 style=\"margin: 0 0 10px 0; font-size: 16px; color: #D4AF37;\">7. Personalize Your Profile</h4>\n                <p style=\"margin: 0; font-size: 14px; line-height: 1.6; color: #b0b0b0;\">\n                  Click your profile icon in the top-right corner to set a custom nickname. This nickname will be displayed throughout the app and used in email communications. You can also manage your subscription and billing from the Settings page.\n                </p>\n              </div>\n            </td>\n          </tr>\n          \n          <!-- Pro Tips Section -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <h3 style=\"margin: 0 0 20px 0; font-size: 20px; color: #ffffff; border-bottom: 2px solid #22c55e; padding-bottom: 10px;\">Pro Tips for Success</h3>\n              \n              <div style=\"padding: 20px; background: linear-gradient(135deg, #0f2b1a 0%, #0a1f12 100%); border-radius: 8px; border: 1px solid #22c55e33;\">\n                <ul style=\"margin: 0; padding-left: 20px; color: #b0b0b0; font-size: 14px; line-height: 2;\">\n                  <li><strong style=\"color: #22c55e;\">Always use stop-loss orders</strong> - Protect your capital by setting clear exit points</li>\n                  <li><strong style=\"color: #22c55e;\">Combine multiple indicators</strong> - Use RSI with MACD and Bollinger Bands for stronger confirmation signals</li>\n                  <li><strong style=\"color: #22c55e;\">Check market status</strong> - Gold markets have specific trading hours; be aware of session times</li>\n                  <li><strong style=\"color: #22c55e;\">Start with longer timeframes</strong> - 4H and 1D charts provide clearer trend signals</li>\n                  <li><strong style=\"color: #22c55e;\">Review AI predictions</strong> - Our AI updates analysis in real-time; check notifications regularly</li>\n                  <li><strong style=\"color: #22c55e;\">Use dark/light mode</strong> - Toggle theme in the header for comfortable viewing</li>\n                  <li><strong style=\"color: #22c55e;\">Monitor Pivot Points</strong> - Key levels for entry/exit decisions</li>\n                </ul>\n              </div>\n            </td>\n          </tr>\n          \n          <!-- Important Notice -->\n          <tr>\n            <td style=\"padding: 0 40px 30px 40px;\">\n              <div style=\"padding: 20px; background: linear-gradient(135deg, #2b1f0f 0%, #1f170a 100%); border-radius: 8px; border: 1px solid #D4AF3733;\">\n                <p style=\"margin: 0; font-size: 13px; line-height: 1.6; color: #b0b0b0;\">\n                  <strong style=\"color: #D4AF37;\">Important:</strong> Gold Predict provides market analysis and predictions for educational and informational purposes only. This is not financial advice. Always conduct your own research and consider consulting a financial advisor before making trading decisions. Past performance does not guarantee future results.\n                </p>\n              </div>\n            </td>\n          </tr>\n          \n          <!-- CTA Button -->\n          <tr>\n            <td style=\"padding: 0 40px 40px 40px; text-align: center;\">\n              <a href=\"${process.env.REPLIT_DEV_DOMAIN ? `https://${process.env.REPLIT_DEV_DOMAIN}` : 'https://goldpredict.replit.app'}\" style=\"display: inline-block; padding: 16px 40px; background: linear-gradient(135deg, #D4AF37 0%, #B8860B 100%); color: #000000; text-decoration: none; font-size: 16px; font-weight: 600; border-radius: 8px;\">\n                Open Gold Predict Dashboard\n              </a>\n            </td>\n          </tr>\n          \n          <!-- Footer -->\n          <tr>\n            <td style=\"padding: 30px 40px; background-color: #0a0a0f; text-align: center; border-top: 1px solid #2a2a35;\">\n              <p style=\"margin: 0 0 10px 0; font-size: 14px; color: #666666;\">\n                Thank you for choosing Gold Predict\n              </p>\n              <p style=\"margin: 0; font-size: 12px; color: #444444;\">\n                2026 Gold Predict. All rights reserved.\n              </p>\n            </td>\n          </tr>\n          \n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  `;\n  \n  return sendEmail({\n    to: userEmail,\n    subject: 'Welcome to Gold Predict - Your Complete Getting Started Guide',\n    htmlContent: htmlContent\n  });\n}\n","path":null,"size_bytes":14173,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/replit_integrations/audio/useVoiceStream.ts":{"content":"/**\n * React hook for handling SSE voice streaming responses.\n * Converts audio blob to base64 and sends as JSON to match server expectations.\n */\nimport { useCallback } from \"react\";\nimport { useAudioPlayback } from \"./useAudioPlayback\";\n\ninterface StreamCallbacks {\n  onUserTranscript?: (text: string) => void;\n  onTranscript?: (text: string, full: string) => void;\n  onComplete?: (transcript: string) => void;\n  onError?: (error: Error) => void;\n}\n\nexport function useVoiceStream(callbacks: StreamCallbacks = {}) {\n  const playback = useAudioPlayback();\n\n  const streamVoiceResponse = useCallback(\n    async (url: string, audioBlob: Blob) => {\n      await playback.init();\n      playback.clear();\n\n      // Convert blob to base64 for JSON body (server expects express.json())\n      const base64Audio = await new Promise<string>((resolve) => {\n        const fileReader = new FileReader();\n        fileReader.onload = () => {\n          const result = fileReader.result as string;\n          resolve(result.split(\",\")[1]); // Remove data URL prefix\n        };\n        fileReader.readAsDataURL(audioBlob);\n      });\n\n      const response = await fetch(url, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ audio: base64Audio }),\n      });\n      if (!response.ok) throw new Error(\"Voice request failed\");\n\n      const streamReader = response.body?.getReader();\n      if (!streamReader) throw new Error(\"No response body\");\n\n      const decoder = new TextDecoder();\n      let buffer = \"\";\n      let fullTranscript = \"\";\n\n      while (true) {\n        const { done, value } = await streamReader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() || \"\";\n\n        for (const line of lines) {\n          if (!line.startsWith(\"data: \")) continue;\n\n          try {\n            const event = JSON.parse(line.slice(6));\n\n            switch (event.type) {\n              case \"user_transcript\":\n                callbacks.onUserTranscript?.(event.data);\n                break;\n              case \"transcript\":\n                fullTranscript += event.data;\n                callbacks.onTranscript?.(event.data, fullTranscript);\n                break;\n              case \"audio\":\n                playback.pushAudio(event.data);\n                break;\n              case \"done\":\n                playback.signalComplete();\n                callbacks.onComplete?.(fullTranscript);\n                break;\n              case \"error\":\n                throw new Error(event.error);\n            }\n          } catch (e) {\n            if (!(e instanceof SyntaxError)) {\n              callbacks.onError?.(e as Error);\n            }\n          }\n        }\n      }\n    },\n    [playback, callbacks]\n  );\n\n  return { streamVoiceResponse, playbackState: playback.state };\n}\n","path":null,"size_bytes":2914,"size_tokens":null},"client/src/pages/SubscriptionRequired.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Crown, \n  LineChart, \n  TrendingUp, \n  Zap, \n  BarChart3,\n  ArrowLeft,\n  AlertCircle\n} from \"lucide-react\";\n\nexport default function SubscriptionRequired() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-background font-body flex flex-col\">\n      <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm\">\n        <div className=\"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 bloom-gold\">\n              <LineChart className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <div className=\"flex flex-col\">\n              <h1 className=\"text-2xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight\">\n                Gold Predict\n              </h1>\n            </div>\n          </div>\n          <Button \n            variant=\"ghost\" \n            onClick={() => setLocation('/')}\n            data-testid=\"button-back-home\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Home\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex items-center justify-center p-6\">\n        <div className=\"max-w-lg w-full space-y-6\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-primary/20 to-amber-500/20 flex items-center justify-center border border-primary/30 pulse-glow\">\n              <Crown className=\"w-10 h-10 text-primary\" />\n            </div>\n            <h2 className=\"text-3xl font-display font-bold\">Subscription Required</h2>\n            <p className=\"text-muted-foreground text-lg\">\n              Choose a plan to access the Gold Predict dashboard and start analyzing gold markets\n            </p>\n          </div>\n\n          <Alert className=\"border-primary/30 bg-primary/5\">\n            <AlertCircle className=\"h-4 w-4 text-primary\" />\n            <AlertDescription className=\"text-foreground\">\n              <strong>No active subscription found.</strong> Select a plan below to create your account and get instant access to premium features.\n            </AlertDescription>\n          </Alert>\n\n          <Card className=\"border-border/50\">\n            <CardContent className=\"pt-6\">\n              <p className=\"text-sm text-muted-foreground mb-4 text-center\">What you'll get with a subscription:</p>\n              <div className=\"grid grid-cols-3 gap-4 text-center\">\n                <div className=\"space-y-2\">\n                  <div className=\"w-12 h-12 mx-auto rounded-xl bg-green-500/10 flex items-center justify-center\">\n                    <TrendingUp className=\"w-6 h-6 text-green-500\" />\n                  </div>\n                  <p className=\"text-xs font-medium\">Live Price Data</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <div className=\"w-12 h-12 mx-auto rounded-xl bg-blue-500/10 flex items-center justify-center\">\n                    <Zap className=\"w-6 h-6 text-blue-500\" />\n                  </div>\n                  <p className=\"text-xs font-medium\">AI Predictions</p>\n                </div>\n                <div className=\"space-y-2\">\n                  <div className=\"w-12 h-12 mx-auto rounded-xl bg-purple-500/10 flex items-center justify-center\">\n                    <BarChart3 className=\"w-6 h-6 text-purple-500\" />\n                  </div>\n                  <p className=\"text-xs font-medium\">Pro Signals</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Button \n            size=\"lg\" \n            className=\"w-full bg-gradient-to-r from-primary to-amber-600\"\n            onClick={() => setLocation('/')}\n            data-testid=\"button-view-plans\"\n          >\n            <Crown className=\"w-4 h-4 mr-2\" />\n            View Subscription Plans\n          </Button>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":4394,"size_tokens":null},"client/src/components/PredictionChart.tsx":{"content":"import { \n  ResponsiveContainer, \n  ComposedChart, \n  Line, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ReferenceLine,\n  Cell\n} from \"recharts\";\nimport { format } from \"date-fns\";\nimport { useState } from \"react\";\nimport type { PredictionResponse } from \"@shared/schema\";\nimport { Loader2, TrendingUp, ZoomIn, ZoomOut } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface PredictionChartProps {\n  data?: PredictionResponse;\n  isLoading: boolean;\n}\n\nexport function PredictionChart({ data, isLoading }: PredictionChartProps) {\n  const [zoom, setZoom] = useState(1);\n\n  if (isLoading) {\n    return (\n      <div className=\"w-full h-[500px] flex items-center justify-center bg-card/30 rounded-2xl border border-white/5 backdrop-blur-sm\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <div className=\"relative\">\n            <Loader2 className=\"w-12 h-12 text-primary animate-spin\" />\n            <div className=\"absolute inset-0 bg-primary/20 blur-xl rounded-full\" />\n          </div>\n          <p className=\"text-muted-foreground text-sm font-medium tracking-widest uppercase animate-pulse\">Analyzing Market Data...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!data) return null;\n\n  // Combine historical candles and forecast into one dataset for charting\n  const fullChartData = [\n    ...data.candles.map(c => ({\n      ...c,\n      price: c.high, // Use HIGH price for the line\n      timestamp: new Date(c.time).getTime(),\n      displayDate: format(new Date(c.time), 'HH:mm'),\n      isForecast: false\n    })),\n    // Add forecast points\n    ...data.forecast.map(f => ({\n      time: f.time,\n      price: f.price,\n      timestamp: new Date(f.time).getTime(),\n      displayDate: format(new Date(f.time), 'HH:mm'),\n      isForecast: true\n    }))\n  ];\n\n  // Apply zoom by slicing the data\n  const dataPoints = Math.max(10, Math.floor(fullChartData.length / zoom));\n  const chartData = fullChartData.slice(-dataPoints);\n\n  const prices = chartData.map(d => d.price);\n  const minPrice = Math.min(...prices);\n  const maxPrice = Math.max(...prices);\n  const padding = (maxPrice - minPrice) * 0.1;\n\n  const handleZoomIn = () => setZoom(prev => Math.min(prev + 0.5, 4));\n  const handleZoomOut = () => setZoom(prev => Math.max(prev - 0.5, 1));\n\n  return (\n    <div className=\"w-full h-[500px] glass-panel p-6 rounded-2xl relative border border-white/5 shadow-2xl overflow-hidden\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between mb-8 gap-4\">\n        <div>\n          <h3 className=\"font-display font-bold text-xl text-foreground tracking-tight flex items-center gap-2\">\n            XAUUSD Market Trend\n            <span className=\"text-[10px] bg-primary/10 text-primary border border-primary/20 px-2 py-0.5 rounded-full font-mono uppercase tracking-tighter\">\n              High Price Line\n            </span>\n          </h3>\n          <p className=\"text-xs text-muted-foreground mt-1\">Real-time gold spot analysis & AI forecast</p>\n        </div>\n        \n        <div className=\"flex items-center gap-6\">\n          <div className=\"flex items-center gap-2 bg-muted p-1 rounded-xl border border-border\">\n            <Button \n              size=\"icon\" \n              variant=\"ghost\" \n              onClick={handleZoomIn}\n              className=\"h-8 w-8\"\n              data-testid=\"button-zoom-in\"\n            >\n              <ZoomIn className=\"w-4 h-4 text-muted-foreground\" />\n            </Button>\n            <Button \n              size=\"icon\" \n              variant=\"ghost\" \n              onClick={handleZoomOut}\n              className=\"h-8 w-8\"\n              data-testid=\"button-zoom-out\"\n            >\n              <ZoomOut className=\"w-4 h-4 text-muted-foreground\" />\n            </Button>\n          </div>\n          <div className=\"hidden lg:flex flex-col items-end\">\n            <span className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">Current Price</span>\n            <span className=\"text-lg font-mono font-bold text-primary\">${data.currentPrice.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"h-[350px] w-full mt-4\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <ComposedChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n            <defs>\n              <linearGradient id=\"lineGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3}/>\n                <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0}/>\n              </linearGradient>\n            </defs>\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"currentColor\" opacity={0.1} vertical={false} />\n            <XAxis \n              dataKey=\"displayDate\" \n              stroke=\"currentColor\"\n              opacity={0.5}\n              fontSize={10}\n              tickLine={false}\n              axisLine={false}\n              minTickGap={30}\n              padding={{ left: 10, right: 10 }}\n              height={50}\n            />\n            <YAxis \n              domain={[minPrice - padding, maxPrice + padding]}\n              orientation=\"right\"\n              stroke=\"currentColor\"\n              opacity={0.5}\n              fontSize={10}\n              tickLine={false}\n              axisLine={false}\n              tickFormatter={(val) => `$${val.toFixed(0)}`}\n            />\n            <Tooltip\n              content={({ active, payload }) => {\n                if (active && payload && payload.length) {\n                  const data = payload[0].payload;\n                  return (\n                    <div className=\"glass-panel border border-border p-3 shadow-xl backdrop-blur-md\">\n                      <p className=\"text-[10px] text-muted-foreground mb-1 uppercase tracking-wider\">{format(data.timestamp, 'MMM dd, HH:mm')}</p>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm font-mono font-bold text-foreground\">${data.price.toFixed(2)}</span>\n                        {data.isForecast && (\n                          <span className=\"text-[8px] bg-primary/20 text-primary px-1.5 py-0.5 rounded uppercase font-bold\">Forecast</span>\n                        )}\n                      </div>\n                    </div>\n                  );\n                }\n                return null;\n              }}\n            />\n            \n            <Line \n              type=\"monotone\" \n              dataKey=\"price\" \n              stroke=\"hsl(var(--primary))\" \n              strokeWidth={3} \n              dot={false}\n              activeDot={{ r: 6, stroke: 'hsl(var(--primary))', strokeWidth: 2, fill: '#fff' }}\n              animationDuration={1000}\n            />\n            \n            <ReferenceLine \n              y={data.currentPrice} \n              stroke=\"currentColor\" \n              opacity={0.2}\n              strokeDasharray=\"3 3\"\n              label={{ \n                value: 'Live', \n                position: 'right', \n                fill: 'currentColor',\n                fontSize: 10,\n                offset: 10\n              }} \n            />\n          </ComposedChart>\n        </ResponsiveContainer>\n      </div>\n\n      <div className=\"absolute bottom-4 left-6 flex items-center gap-2\">\n        <div className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\n        <span className=\"text-[10px] text-muted-foreground uppercase font-bold tracking-widest\">Market Live</span>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7564,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"server/services/stripeClient.ts":{"content":"import Stripe from 'stripe';\n\nlet cachedCredentials: { publishableKey: string; secretKey: string } | null = null;\n\nasync function getCredentials() {\n  if (cachedCredentials) return cachedCredentials;\n\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n      ? 'depl ' + process.env.WEB_REPL_RENEWAL\n      : null;\n\n  if (hostname && xReplitToken) {\n    const isProduction = process.env.REPLIT_DEPLOYMENT === '1';\n    const targetEnvironment = isProduction ? 'production' : 'development';\n\n    const url = new URL(`https://${hostname}/api/v2/connection`);\n    url.searchParams.set('include_secrets', 'true');\n    url.searchParams.set('connector_names', 'stripe');\n    url.searchParams.set('environment', targetEnvironment);\n\n    try {\n      const response = await fetch(url.toString(), {\n        headers: {\n          'Accept': 'application/json',\n          'X_REPLIT_TOKEN': xReplitToken\n        }\n      });\n\n      const data = await response.json();\n      const connectionSettings = data.items?.[0];\n\n      if (connectionSettings?.settings?.publishable && connectionSettings?.settings?.secret) {\n        cachedCredentials = {\n          publishableKey: connectionSettings.settings.publishable,\n          secretKey: connectionSettings.settings.secret,\n        };\n        console.log('Stripe credentials loaded from Replit connection');\n        return cachedCredentials;\n      }\n    } catch (err) {\n      console.warn('Failed to fetch Stripe credentials from Replit connection:', err);\n    }\n  }\n\n  const publishableKey = process.env.STRIPE_PUBLISHABLE_KEY;\n  const secretKey = process.env.STRIPE_SECRET_KEY;\n\n  if (!publishableKey || !secretKey) {\n    throw new Error(\n      'Stripe credentials not found. Please connect Stripe via Replit integrations or set STRIPE_PUBLISHABLE_KEY and STRIPE_SECRET_KEY.'\n    );\n  }\n\n  cachedCredentials = { publishableKey, secretKey };\n  console.log('Stripe credentials loaded from environment variables');\n  return cachedCredentials;\n}\n\nexport async function getUncachableStripeClient() {\n  const { secretKey } = await getCredentials();\n\n  return new Stripe(secretKey, {\n    apiVersion: '2025-08-27.basil' as any,\n  });\n}\n\nexport async function getStripePublishableKey() {\n  const { publishableKey } = await getCredentials();\n  return publishableKey;\n}\n\nexport async function getStripeSecretKey() {\n  const { secretKey } = await getCredentials();\n  return secretKey;\n}\n\nlet stripeSync: any = null;\n\nexport async function getStripeSync() {\n  if (!stripeSync) {\n    const { StripeSync } = await import('stripe-replit-sync');\n    const secretKey = await getStripeSecretKey();\n\n    stripeSync = new StripeSync({\n      poolConfig: {\n        connectionString: process.env.DATABASE_URL!,\n        max: 2,\n      },\n      stripeSecretKey: secretKey,\n    });\n  }\n  return stripeSync;\n}\n","path":null,"size_bytes":2942,"size_tokens":null},"server/replit_integrations/chat/index.ts":{"content":"export { registerChatRoutes } from \"./routes\";\nexport { chatStorage, type IChatStorage } from \"./storage\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/SubscriptionSuccess.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle, Loader2 } from \"lucide-react\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useSubscription } from \"@/hooks/use-subscription\";\n\nexport default function SubscriptionSuccess() {\n  const [, setLocation] = useLocation();\n  const { subscription, isLoading } = useSubscription();\n\n  useEffect(() => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/subscription/status\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n  }, []);\n\n  return (\n    <DashboardLayout>\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <Card className=\"max-w-md w-full text-center\" data-testid=\"card-subscription-success\">\n          <CardContent className=\"py-10 space-y-6\">\n            {isLoading ? (\n              <>\n                <Loader2 className=\"w-16 h-16 animate-spin text-primary mx-auto\" />\n                <p className=\"text-muted-foreground\">Processing your subscription...</p>\n              </>\n            ) : (\n              <>\n                <div className=\"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto\">\n                  <CheckCircle className=\"w-10 h-10 text-green-500\" />\n                </div>\n                <h1 className=\"text-2xl font-bold\">Welcome to {subscription?.plan || 'Premium'}!</h1>\n                <p className=\"text-muted-foreground\">\n                  Your subscription is now active. You have full access to all the features\n                  included in your plan.\n                </p>\n                <div className=\"flex flex-col gap-3 pt-4\">\n                  <Button \n                    onClick={() => setLocation(\"/\")} \n                    data-testid=\"button-go-dashboard\"\n                  >\n                    Go to Dashboard\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => setLocation(\"/analysis\")}\n                    data-testid=\"button-start-analysis\"\n                  >\n                    Start Analyzing Gold\n                  </Button>\n                </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":2461,"size_tokens":null},"client/src/lib/auth-utils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\n// Redirect to login with a toast notification\nexport function redirectToLogin(toast?: (options: { title: string; description: string; variant: string }) => void) {\n  if (toast) {\n    toast({\n      title: \"Unauthorized\",\n      description: \"You are logged out. Logging in again...\",\n      variant: \"destructive\",\n    });\n  }\n  setTimeout(() => {\n    window.location.href = \"/api/login\";\n  }, 500);\n}\n","path":null,"size_bytes":517,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"server/replit_integrations/auth/index.ts":{"content":"export { setupAuth, isAuthenticated, getSession, hashPassword, verifyPassword } from \"./replitAuth\";\nexport { authStorage, type IAuthStorage } from \"./storage\";\nexport { registerAuthRoutes } from \"./routes\";\n","path":null,"size_bytes":208,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"server/services/webhookHandlers.ts":{"content":"// Stripe webhook handlers with subscription lifecycle management\nimport { getStripeSync, getUncachableStripeClient } from './stripeClient';\nimport { stripeService } from './stripeService';\n\nexport class WebhookHandlers {\n  static async processWebhook(payload: Buffer, signature: string): Promise<void> {\n    if (!Buffer.isBuffer(payload)) {\n      throw new Error(\n        'STRIPE WEBHOOK ERROR: Payload must be a Buffer. ' +\n        'Received type: ' + typeof payload + '. ' +\n        'This usually means express.json() parsed the body before reaching this handler. ' +\n        'FIX: Ensure webhook route is registered BEFORE app.use(express.json()).'\n      );\n    }\n\n    // First, let stripe-replit-sync process the webhook to sync data\n    const sync = await getStripeSync();\n    await sync.processWebhook(payload, signature);\n\n    // Then, handle specific events to update user subscription status\n    try {\n      const stripe = await getUncachableStripeClient();\n      const event = stripe.webhooks.constructEvent(\n        payload,\n        signature,\n        process.env.STRIPE_WEBHOOK_SECRET || ''\n      );\n\n      await WebhookHandlers.handleStripeEvent(event);\n    } catch (err: any) {\n      // If we don't have a webhook secret, try to parse the event directly\n      // This is less secure but allows the system to work without manual webhook secret setup\n      try {\n        const eventData = JSON.parse(payload.toString());\n        await WebhookHandlers.handleStripeEvent(eventData);\n      } catch (parseErr) {\n        console.log('Webhook event handling skipped (no webhook secret configured)');\n      }\n    }\n  }\n\n  static async handleStripeEvent(event: any): Promise<void> {\n    const eventType = event.type;\n    const data = event.data?.object;\n\n    console.log(`Processing Stripe event: ${eventType}`);\n\n    switch (eventType) {\n      // Subscription created or updated\n      case 'customer.subscription.created':\n      case 'customer.subscription.updated':\n        await WebhookHandlers.handleSubscriptionUpdate(data);\n        break;\n\n      // Subscription renewed successfully (invoice paid)\n      case 'invoice.payment_succeeded':\n        if (data.subscription) {\n          await WebhookHandlers.handleSubscriptionRenewal(data);\n        }\n        break;\n\n      // Payment failed (subscription may be at risk)\n      case 'invoice.payment_failed':\n        if (data.subscription) {\n          await WebhookHandlers.handlePaymentFailed(data);\n        }\n        break;\n\n      // Subscription canceled or expired\n      case 'customer.subscription.deleted':\n        await WebhookHandlers.handleSubscriptionCanceled(data);\n        break;\n\n      default:\n        // Log other events for debugging\n        console.log(`Unhandled event type: ${eventType}`);\n    }\n  }\n\n  // Handle subscription create/update events\n  static async handleSubscriptionUpdate(subscription: any): Promise<void> {\n    try {\n      const customerId = subscription.customer;\n      const user = await stripeService.getUserByStripeCustomerId(customerId);\n\n      if (!user) {\n        // Try to find user from subscription metadata\n        const userId = subscription.metadata?.userId;\n        if (userId) {\n          await WebhookHandlers.updateUserSubscription(userId, subscription);\n        }\n        return;\n      }\n\n      await WebhookHandlers.updateUserSubscription(user.id, subscription);\n    } catch (error) {\n      console.error('Error handling subscription update:', error);\n    }\n  }\n\n  // Handle successful subscription renewal\n  static async handleSubscriptionRenewal(invoice: any): Promise<void> {\n    try {\n      const customerId = invoice.customer;\n      const user = await stripeService.getUserByStripeCustomerId(customerId);\n\n      if (!user) {\n        console.log('No user found for customer:', customerId);\n        return;\n      }\n\n      // Get the subscription to update expiry date\n      const stripe = await getUncachableStripeClient();\n      const subscription = await stripe.subscriptions.retrieve(invoice.subscription) as any;\n\n      // Determine plan from price\n      const priceId = subscription.items.data[0]?.price.id;\n      const price = await stripe.prices.retrieve(priceId);\n      const plan = stripeService.getPlanFromPrice(price.metadata, price.unit_amount || 0);\n\n      await stripeService.updateUserStripeInfo(user.id, {\n        stripeSubscriptionId: subscription.id,\n        subscriptionPlan: plan,\n        subscriptionStatus: 'active',\n        subscriptionExpiresAt: new Date(subscription.current_period_end * 1000),\n      });\n\n      console.log(`Subscription renewed for user ${user.id}, new expiry: ${new Date(subscription.current_period_end * 1000)}`);\n    } catch (error) {\n      console.error('Error handling subscription renewal:', error);\n    }\n  }\n\n  // Handle failed payment\n  static async handlePaymentFailed(invoice: any): Promise<void> {\n    try {\n      const customerId = invoice.customer;\n      const user = await stripeService.getUserByStripeCustomerId(customerId);\n\n      if (!user) {\n        return;\n      }\n\n      // Mark subscription as past_due (Stripe will retry payment)\n      await stripeService.updateUserStripeInfo(user.id, {\n        subscriptionStatus: 'past_due',\n      });\n\n      console.log(`Payment failed for user ${user.id}, subscription marked as past_due`);\n      \n      // TODO: Send email notification about failed payment\n    } catch (error) {\n      console.error('Error handling payment failure:', error);\n    }\n  }\n\n  // Handle subscription cancellation\n  static async handleSubscriptionCanceled(subscription: any): Promise<void> {\n    try {\n      const customerId = subscription.customer;\n      const user = await stripeService.getUserByStripeCustomerId(customerId);\n\n      if (!user) {\n        return;\n      }\n\n      await stripeService.updateUserStripeInfo(user.id, {\n        subscriptionStatus: 'canceled',\n        subscriptionExpiresAt: subscription.ended_at \n          ? new Date(subscription.ended_at * 1000) \n          : new Date(),\n      });\n\n      console.log(`Subscription canceled for user ${user.id}`);\n    } catch (error) {\n      console.error('Error handling subscription cancellation:', error);\n    }\n  }\n\n  // Helper to update user subscription from subscription object\n  static async updateUserSubscription(userId: string, subscription: any): Promise<void> {\n    const stripe = await getUncachableStripeClient();\n    \n    // Get plan from price\n    const priceId = subscription.items?.data?.[0]?.price?.id;\n    let plan = 'basic';\n    \n    if (priceId) {\n      try {\n        const price = await stripe.prices.retrieve(priceId);\n        plan = stripeService.getPlanFromPrice(price.metadata, price.unit_amount || 0);\n      } catch (e) {\n        console.log('Could not retrieve price, using default plan');\n      }\n    }\n\n    // Map Stripe status to our status\n    // active/trialing = full access, past_due = grace period, canceled/unpaid/incomplete_expired = no access\n    let status = 'inactive';\n    if (subscription.status === 'active' || subscription.status === 'trialing') {\n      status = 'active';\n    } else if (subscription.status === 'past_due') {\n      status = 'past_due';\n    } else if (subscription.status === 'canceled' || subscription.status === 'unpaid' || subscription.status === 'incomplete_expired') {\n      status = 'canceled';\n    }\n\n    await stripeService.updateUserStripeInfo(userId, {\n      stripeSubscriptionId: subscription.id,\n      subscriptionPlan: plan,\n      subscriptionStatus: status,\n      subscriptionExpiresAt: subscription.current_period_end \n        ? new Date(subscription.current_period_end * 1000) \n        : null,\n    });\n\n    console.log(`Updated subscription for user ${userId}: plan=${plan}, status=${status}`);\n  }\n}\n","path":null,"size_bytes":7736,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"client/src/components/MetricCard.tsx":{"content":"import { ReactNode } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface MetricCardProps {\n  title: string;\n  value: string | number;\n  subValue?: string;\n  trend?: \"up\" | \"down\" | \"neutral\";\n  trendValue?: string;\n  icon?: ReactNode;\n  className?: string;\n  delay?: number;\n}\n\nexport function MetricCard({ \n  title, \n  value, \n  subValue, \n  trend, \n  trendValue, \n  icon, \n  className \n}: MetricCardProps) {\n  return (\n    <div className={cn(\n      \"glass-panel rounded-2xl p-6 relative overflow-hidden group hover:border-primary/30 transition-all duration-300\",\n      className\n    )}>\n      <div className=\"absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500\">\n        {icon}\n      </div>\n      \n      <h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider mb-2\">{title}</h3>\n      \n      <div className=\"flex items-baseline gap-2\">\n        <span className=\"text-3xl font-display font-bold text-foreground tracking-tight\">\n          {value}\n        </span>\n        {subValue && (\n          <span className=\"text-sm text-muted-foreground\">{subValue}</span>\n        )}\n      </div>\n\n      {trendValue && (\n        <div className={cn(\n          \"mt-4 flex items-center gap-1.5 text-sm font-medium w-fit px-2.5 py-1 rounded-full border\",\n          trend === \"up\" ? \"bg-emerald-500/10 text-emerald-400 border-emerald-500/20\" :\n          trend === \"down\" ? \"bg-rose-500/10 text-rose-400 border-rose-500/20\" :\n          \"bg-white/5 text-muted-foreground border-white/10\"\n        )}>\n          {trend === \"up\" ? \"\" : trend === \"down\" ? \"\" : \"\"} {trendValue}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":1712,"size_tokens":null},"client/requirements.md":{"content":"## Packages\nrecharts | For candlestick and trend charts\nframer-motion | For smooth animations and transitions\ndate-fns | For date formatting\n\n## Notes\nTailwind Config - extend fontFamily:\nfontFamily: {\n  display: [\"var(--font-display)\"],\n  body: [\"var(--font-body)\"],\n  mono: [\"var(--font-mono)\"],\n}\n","path":null,"size_bytes":300,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"server/replit_integrations/batch/index.ts":{"content":"export {\n  batchProcess,\n  batchProcessWithSSE,\n  isRateLimitError,\n  type BatchOptions,\n} from \"./utils\";\n\n","path":null,"size_bytes":108,"size_tokens":null},"server/replit_integrations/auth/storage.ts":{"content":"import { users, type User, type UpsertUser, type UserResponse } from \"@shared/models/auth\";\nimport { db } from \"../../db\";\nimport { eq } from \"drizzle-orm\";\n\nexport interface IAuthStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: UpsertUser): Promise<User>;\n  updateNickname(id: string, nickname: string): Promise<User | undefined>;\n  getUserResponse(user: User): UserResponse;\n}\n\nclass AuthStorage implements IAuthStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .returning();\n    return user;\n  }\n\n  async updateNickname(id: string, nickname: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ nickname, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  getUserResponse(user: User): UserResponse {\n    const { password, ...userWithoutPassword } = user;\n    return userWithoutPassword;\n  }\n}\n\nexport const authStorage = new AuthStorage();\n","path":null,"size_bytes":1447,"size_tokens":null},"client/src/pages/LandingPricing.tsx":{"content":"import { useSubscriptionPlans } from \"@/hooks/use-subscription\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Check, Loader2, Crown, Zap, TrendingUp, LineChart, LogIn, AlertCircle } from \"lucide-react\";\nimport { useLocation, useSearch } from \"wouter\";\n\nconst PLAN_DISPLAY: Record<string, { \n  name: string; \n  icon: any; \n  color: string; \n  bgColor: string; \n  description: string; \n  highlights: string[]; \n  popular?: boolean \n}> = {\n  basic: {\n    name: \"Basic\",\n    icon: TrendingUp,\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n    description: \"Essential gold market analysis for beginners\",\n    highlights: [\n      \"Real-time XAU/USD price tracking\",\n      \"Basic price chart with zoom controls\",\n      \"RSI technical indicator\",\n      \"3 AI predictions per day\",\n    ],\n  },\n  pro: {\n    name: \"Pro\",\n    icon: Zap,\n    color: \"text-primary\",\n    bgColor: \"bg-primary/10\",\n    description: \"Advanced tools for serious traders\",\n    highlights: [\n      \"Everything in Basic, plus:\",\n      \"MACD and SMA indicators\",\n      \"10 AI predictions per day\",\n      \"Full trading signals access\",\n      \"Weekly market analysis reports\",\n    ],\n    popular: true,\n  },\n  premium: {\n    name: \"Premium\",\n    icon: Crown,\n    color: \"text-amber-500\",\n    bgColor: \"bg-amber-500/10\",\n    description: \"Complete suite for professional traders\",\n    highlights: [\n      \"Everything in Pro, plus:\",\n      \"All technical indicators\",\n      \"Unlimited AI predictions\",\n      \"Priority trading signals\",\n      \"Premium AI market reports\",\n      \"Real-time email alerts\",\n    ],\n  },\n};\n\nfunction formatPrice(amount: number, currency: string) {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currency.toUpperCase(),\n  }).format(amount / 100);\n}\n\nexport default function LandingPricing() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const params = new URLSearchParams(searchString);\n  const signupRequired = params.get('signup') === 'required';\n  \n  const { data: plansData, isLoading: plansLoading } = useSubscriptionPlans();\n\n  const handleSelectPlan = (planKey: string) => {\n    setLocation(`/checkout?plan=${planKey}`);\n  };\n\n  const plans = plansData?.plans?.sort((a, b) => {\n    const priceA = a.prices[0]?.unitAmount || 0;\n    const priceB = b.prices[0]?.unitAmount || 0;\n    return priceA - priceB;\n  }) || [];\n\n  return (\n    <div className=\"min-h-screen bg-background font-body\">\n      {/* Header */}\n      <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 bloom-gold\">\n              <LineChart className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <div className=\"flex flex-col\">\n              <h1 className=\"text-2xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight\">\n                Gold Predict\n              </h1>\n              <div className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-primary/10 border border-primary/20 w-fit -mt-0.5\">\n                <span className=\"w-1 h-1 rounded-full bg-primary animate-pulse\" />\n                <span className=\"text-[9px] uppercase font-bold tracking-widest text-primary leading-none\">\n                  By Furlan Mattia\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-6xl mx-auto px-6 py-12\">\n        <div className=\"space-y-8\">\n          {/* Hero Section */}\n          <div className=\"text-center space-y-4 mb-12\">\n            <Badge className=\"bg-primary/10 text-primary border-primary/20 px-4 py-1\">\n              <Crown className=\"w-3 h-3 mr-1\" />\n              Premium Gold Market Intelligence\n            </Badge>\n            <h1 className=\"text-4xl md:text-5xl font-display font-bold\">\n              Master the Gold Market with\n              <span className=\"bg-clip-text text-transparent bg-gradient-to-r from-primary to-amber-500\"> AI-Powered</span> Analysis\n            </h1>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Get real-time XAU/USD predictions, advanced technical indicators, and professional trading signals. \n              Start your journey to smarter gold trading today.\n            </p>\n          </div>\n\n          {/* Signup Required Alert */}\n          {signupRequired && (\n            <Alert className=\"border-primary/30 bg-primary/5 max-w-2xl mx-auto\">\n              <AlertCircle className=\"h-4 w-4 text-primary\" />\n              <AlertDescription className=\"text-foreground\">\n                <strong>Account not found.</strong> You need to subscribe first to create your account and access Gold Predict.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          {/* Pricing Cards */}\n          <div className=\"text-center mb-8\">\n            <h2 className=\"text-3xl font-display font-bold mb-2\">Choose Your Plan</h2>\n            <p className=\"text-muted-foreground\">Select the plan that fits your trading needs</p>\n          </div>\n\n          {plansLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n            </div>\n          ) : plans.length === 0 ? (\n            <Card className=\"text-center py-12\">\n              <CardContent>\n                <p className=\"text-muted-foreground\">\n                  Subscription plans are being set up. Please check back soon.\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              {plans.map((plan) => {\n                const planKey = plan.metadata?.plan as keyof typeof PLAN_DISPLAY || 'basic';\n                const display = PLAN_DISPLAY[planKey] || PLAN_DISPLAY.basic;\n                const price = plan.prices[0];\n                const Icon = display.icon;\n\n                return (\n                  <Card \n                    key={plan.id} \n                    className={`relative flex flex-col bloom-card transition-transform duration-300 ${display.popular ? 'border-primary shadow-lg shadow-primary/10' : 'border-white/5'}`}\n                    data-testid={`card-plan-${planKey}`}\n                  >\n                    {display.popular && (\n                      <Badge \n                        className=\"absolute -top-3 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground\"\n                      >\n                        Most Popular\n                      </Badge>\n                    )}\n                    \n                    <CardHeader className=\"text-center pb-2\">\n                      <div className={`w-12 h-12 mx-auto rounded-full ${display.bgColor} flex items-center justify-center mb-3`}>\n                        <Icon className={`w-6 h-6 ${display.color}`} />\n                      </div>\n                      <CardTitle className=\"text-2xl\">{display.name}</CardTitle>\n                      <CardDescription>{display.description}</CardDescription>\n                    </CardHeader>\n\n                    <CardContent className=\"flex-1 space-y-6\">\n                      <div className=\"text-center\">\n                        {price ? (\n                          <>\n                            <span className=\"text-4xl font-bold\">\n                              {formatPrice(price.unitAmount, price.currency)}\n                            </span>\n                            <span className=\"text-muted-foreground\">/month</span>\n                          </>\n                        ) : (\n                          <span className=\"text-2xl text-muted-foreground\">Price not set</span>\n                        )}\n                      </div>\n\n                      <ul className=\"space-y-3\">\n                        {display.highlights.map((feature, idx) => (\n                          <li key={idx} className=\"flex items-start gap-2\">\n                            <Check className=\"w-5 h-5 text-green-500 shrink-0 mt-0.5\" />\n                            <span className=\"text-sm text-foreground\">{feature}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </CardContent>\n\n                    <CardFooter>\n                      <Button\n                        className=\"w-full\"\n                        variant={display.popular ? \"default\" : \"outline\"}\n                        onClick={() => handleSelectPlan(planKey)}\n                        disabled={!price}\n                        data-testid={`button-subscribe-${planKey}`}\n                      >\n                        Get Started\n                      </Button>\n                    </CardFooter>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Feature Comparison */}\n          <Card className=\"border-white/5 mt-12\">\n            <CardHeader>\n              <CardTitle>Feature Comparison</CardTitle>\n              <CardDescription>See what's included in each plan</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full text-sm\">\n                  <thead>\n                    <tr className=\"border-b border-white/10\">\n                      <th className=\"text-left py-3 px-4 font-medium text-foreground\">Feature</th>\n                      <th className=\"text-center py-3 px-4 font-medium text-foreground\">Basic</th>\n                      <th className=\"text-center py-3 px-4 font-medium text-primary\">Pro</th>\n                      <th className=\"text-center py-3 px-4 font-medium text-amber-500\">Premium</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">Daily Predictions</td>\n                      <td className=\"text-center py-3 px-4\">3</td>\n                      <td className=\"text-center py-3 px-4\">10</td>\n                      <td className=\"text-center py-3 px-4\">Unlimited</td>\n                    </tr>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">RSI Indicator</td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    </tr>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">MACD & SMA Indicators</td>\n                      <td className=\"text-center py-3 px-4 text-muted-foreground\">-</td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    </tr>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">Trading Signals</td>\n                      <td className=\"text-center py-3 px-4 text-muted-foreground\">-</td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    </tr>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">AI Market Analysis</td>\n                      <td className=\"text-center py-3 px-4 text-muted-foreground\">-</td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    </tr>\n                    <tr className=\"border-b border-white/5\">\n                      <td className=\"py-3 px-4 text-muted-foreground\">Real-time Email Alerts</td>\n                      <td className=\"text-center py-3 px-4 text-muted-foreground\">-</td>\n                      <td className=\"text-center py-3 px-4 text-muted-foreground\">-</td>\n                      <td className=\"text-center py-3 px-4\"><Check className=\"w-4 h-4 text-green-500 mx-auto\" /></td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Login Button for Existing Members */}\n          <Card className=\"border-primary/20 bg-primary/5 mt-8\">\n            <CardContent className=\"py-6\">\n              <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n                <div className=\"text-center md:text-left\">\n                  <h3 className=\"font-semibold text-lg text-foreground\">Already a subscriber?</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    If your plan is activated, login to access your dashboard\n                  </p>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setLocation('/login')}\n                  className=\"min-w-[140px]\"\n                  data-testid=\"button-login-member\"\n                >\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                  Login\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Disclaimer */}\n          <Card className=\"border-amber-500/20 bg-amber-500/5\">\n            <CardContent className=\"py-6\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-8 h-8 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0 mt-0.5\">\n                  <span className=\"text-amber-500 text-lg font-bold\">!</span>\n                </div>\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-semibold text-foreground\">Important Disclaimer</h4>\n                  <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                    <strong>This is not financial advice.</strong> Gold Predict provides market analysis tools and AI-powered predictions for educational and informational purposes only. \n                    We cannot guarantee the accuracy of any prediction or analysis. Markets are inherently unpredictable and anything can happen at any time. \n                    You are solely responsible for your trading decisions. Past performance is not indicative of future results. \n                    Never invest more than you can afford to lose. Please consult with a qualified financial advisor before making any investment decisions.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Footer Note */}\n          <Card className=\"border-white/5 bg-card/50\">\n            <CardContent className=\"py-6\">\n              <p className=\"text-sm text-muted-foreground text-center\">\n                All plans include a 7-day money-back guarantee. Cancel anytime.\n                Payments are securely processed by Stripe.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":16252,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { usePrediction, usePredictionUsage } from \"@/hooks/use-prediction\";\nimport { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { MetricCard } from \"@/components/MetricCard\";\nimport { PredictionChart } from \"@/components/PredictionChart\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  TrendingUp, \n  TrendingDown, \n  DollarSign, \n  Activity, \n  Target, \n  BarChart2, \n  Clock, \n  RefreshCw,\n  Zap,\n  AlertTriangle\n} from \"lucide-react\";\nimport { type Timeframe } from \"@shared/schema\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useLocation } from \"wouter\";\n\nexport default function Home() {\n  const [timeframe, setTimeframe] = useState<Timeframe>(\"1h\");\n  const [, setLocation] = useLocation();\n  const { mutate, isPending, data, error } = usePrediction();\n  const { data: usage, isLoading: usageLoading } = usePredictionUsage();\n\n  // Check if limit is reached\n  const isLimitReached = usage && usage.limit !== 'unlimited' && usage.used >= usage.limit;\n  const remainingPredictions = usage?.remaining;\n\n  const [hasInitialized, setHasInitialized] = useState(false);\n\n  // Initial load - wait for usage data before attempting prediction\n  useEffect(() => {\n    if (!usageLoading && usage && !hasInitialized) {\n      setHasInitialized(true);\n      if (usage.limit === 'unlimited' || usage.used < usage.limit) {\n        mutate({ symbol: \"XAUUSD=X\", timeframe });\n      }\n    }\n  }, [usageLoading, usage]);\n\n  const handleAnalyze = () => {\n    if (isLimitReached) return;\n    mutate({ symbol: \"XAUUSD=X\", timeframe });\n  };\n\n  const isUp = data?.direction === \"UP\";\n  const isDown = data?.direction === \"DOWN\";\n  const signalColor = isUp ? \"text-emerald-400\" : isDown ? \"text-rose-400\" : \"text-yellow-400\";\n  const signalBg = isUp ? \"bg-emerald-500/10 border-emerald-500/20\" : isDown ? \"bg-rose-500/10 border-rose-500/20\" : \"bg-yellow-500/10 border-yellow-500/20\";\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-8\">\n        {/* Header & Controls */}\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-display font-bold text-foreground mb-1\">Market Overview</h2>\n            <p className=\"text-muted-foreground flex items-center gap-2\">\n              <span>XAU/USD Gold Spot US Dollar</span>\n              <span className=\"w-1 h-1 bg-muted-foreground rounded-full\" />\n              <span className=\"font-mono text-primary text-xs\">REAL-TIME</span>\n            </p>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {/* Prediction Usage Badge */}\n            {usage && (\n              <Badge \n                variant={isLimitReached ? \"destructive\" : \"secondary\"}\n                className=\"h-10 px-3 flex items-center gap-2\"\n                data-testid=\"badge-prediction-usage\"\n              >\n                <Zap className=\"w-3 h-3\" />\n                {usage.limit === 'unlimited' ? (\n                  <span>Unlimited</span>\n                ) : isLimitReached ? (\n                  <span className=\"flex items-center gap-1\">\n                    <AlertTriangle className=\"w-3 h-3\" />\n                    Limit Reached ({usage.used}/{usage.limit})\n                  </span>\n                ) : (\n                  <span>{usage.remaining} predictions left</span>\n                )}\n              </Badge>\n            )}\n\n            <Select \n              value={timeframe} \n              onValueChange={(val) => {\n                setTimeframe(val as Timeframe);\n                if (!isLimitReached) {\n                  setTimeout(() => mutate({ symbol: \"XAUUSD=X\", timeframe: val as Timeframe }), 0);\n                }\n              }}\n              disabled={isPending || isLimitReached}\n            >\n              <SelectTrigger className=\"w-[120px] bg-card border-white/10 text-white h-10 rounded-xl\">\n                <SelectValue placeholder=\"Timeframe\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"1m\">1 Minute</SelectItem>\n                <SelectItem value=\"5m\">5 Minutes</SelectItem>\n                <SelectItem value=\"15m\">15 Minutes</SelectItem>\n                <SelectItem value=\"30m\">30 Minutes</SelectItem>\n                <SelectItem value=\"1h\">1 Hour</SelectItem>\n                <SelectItem value=\"4h\">4 Hours</SelectItem>\n                <SelectItem value=\"1d\">1 Day</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <button\n              onClick={handleAnalyze}\n              disabled={isPending || isLimitReached}\n              className=\"h-10 px-6 rounded-xl font-semibold bg-primary text-primary-foreground hover:bg-primary/90 active:scale-95 transition-all flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n              data-testid=\"button-analyze\"\n            >\n              {isPending ? (\n                <RefreshCw className=\"w-4 h-4 animate-spin\" />\n              ) : (\n                <RefreshCw className=\"w-4 h-4\" />\n              )}\n              {isLimitReached ? 'Upgrade Plan' : 'Analyze'}\n            </button>\n\n            {/* Upgrade button when limit reached */}\n            {isLimitReached && (\n              <button\n                onClick={() => setLocation('/')}\n                className=\"h-10 px-4 rounded-xl font-semibold bg-gradient-to-r from-primary to-amber-600 text-primary-foreground hover:opacity-90 transition-all flex items-center gap-2\"\n                data-testid=\"button-upgrade-plan\"\n              >\n                Upgrade Plan\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Prediction Results Section */}\n        {error ? (\n          <div className=\"p-8 rounded-2xl bg-red-500/5 border border-red-500/20 text-center\">\n            <p className=\"text-red-400 mb-2 font-medium\">Failed to load prediction data</p>\n            <p className=\"text-sm text-red-400/60 mb-4\">{error.message}</p>\n            <button \n              onClick={handleAnalyze} \n              className=\"px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-sm transition-colors\"\n            >\n              Try Again\n            </button>\n          </div>\n        ) : !data && !isPending ? (\n           <div className=\"h-[400px] flex items-center justify-center border border-dashed border-white/10 rounded-2xl\">\n             <p className=\"text-muted-foreground\">Select a timeframe and click Analyze to begin.</p>\n           </div>\n        ) : (\n          <>\n            {/* Top Metrics Grid */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <MetricCard\n                title=\"Current Price\"\n                value={`$${data ? data.currentPrice.toFixed(2) : \"0.00\"}`}\n                icon={<DollarSign className=\"w-8 h-8 text-primary\" />}\n                className=\"border-l-4 border-l-primary\"\n              />\n              \n              <MetricCard\n                title=\"Predicted Price\"\n                value={`$${data ? data.predictedPrice.toFixed(2) : \"0.00\"}`}\n                trend={data?.direction === \"UP\" ? \"up\" : data?.direction === \"DOWN\" ? \"down\" : \"neutral\"}\n                trendValue={data ? `${data.changePercent.toFixed(2)}%` : \"0%\"}\n                icon={<Target className=\"w-8 h-8 text-blue-400\" />}\n              />\n\n              <div className=\"glass-panel rounded-2xl p-6 relative overflow-hidden flex flex-col justify-center\">\n                <div className=\"absolute top-0 right-0 p-6 opacity-10\">\n                  <Activity className=\"w-8 h-8 text-foreground\" />\n                </div>\n                <h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider mb-2\">Signal</h3>\n                <div className={`text-3xl font-display font-bold ${signalColor} dark:text-inherit`}>\n                  {isPending ? \"...\" : data?.signal}\n                </div>\n                <div className={`mt-2 inline-flex px-2 py-0.5 text-xs font-bold rounded uppercase border ${signalBg} ${signalColor}`}>\n                  Confidence: {data ? data.confidence.toFixed(1) : 0}%\n                </div>\n              </div>\n\n              <div className=\"glass-panel rounded-2xl p-6 relative overflow-hidden flex flex-col justify-between\">\n                 <div>\n                   <h3 className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider mb-2\">Accuracy Metrics</h3>\n                   <div className=\"flex justify-between items-end\">\n                     <div>\n                       <div className=\"text-xs text-muted-foreground\">RMSE</div>\n                       <div className=\"text-xl font-mono font-bold\">{data?.metrics.rmse.toFixed(3) || \"0.00\"}</div>\n                     </div>\n                     <div className=\"text-right\">\n                       <div className=\"text-xs text-muted-foreground\">MAE</div>\n                       <div className=\"text-xl font-mono font-bold\">{data?.metrics.mae.toFixed(3) || \"0.00\"}</div>\n                     </div>\n                   </div>\n                 </div>\n                 <div className=\"w-full bg-white/5 h-1.5 rounded-full mt-4 overflow-hidden\">\n                   <div \n                     className=\"bg-primary h-full rounded-full transition-all duration-1000 ease-out\" \n                     style={{ width: `${data ? data.confidence : 0}%` }}\n                   />\n                 </div>\n              </div>\n            </div>\n\n            {/* Main Chart Area */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full\">\n              <div className=\"lg:col-span-2 space-y-6\">\n                <PredictionChart data={data} isLoading={isPending} />\n                \n                {/* Technical Indicators Summary */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div className=\"p-4 rounded-xl bg-card border border-white/5\">\n                    <div className=\"text-xs text-muted-foreground mb-1\">RSI (14)</div>\n                    <div className=\"font-mono text-lg font-bold\">\n                      {data?.analysis.rsi?.toFixed(2) || \"N/A\"}\n                    </div>\n                  </div>\n                  <div className=\"p-4 rounded-xl bg-card border border-white/5\">\n                    <div className=\"text-xs text-muted-foreground mb-1\">MACD</div>\n                    <div className={`font-mono text-lg font-bold ${\n                      (data?.analysis.macd?.histogram || 0) > 0 ? \"text-emerald-400\" : \"text-rose-400\"\n                    }`}>\n                      {data?.analysis.macd?.histogram.toFixed(4) || \"N/A\"}\n                    </div>\n                  </div>\n                   <div className=\"p-4 rounded-xl bg-card border border-white/5\">\n                    <div className=\"text-xs text-muted-foreground mb-1\">SMA (20)</div>\n                    <div className=\"font-mono text-lg font-bold\">\n                      {data?.analysis.sma?.toFixed(2) || \"N/A\"}\n                    </div>\n                  </div>\n                  <div className=\"p-4 rounded-xl bg-card border border-white/5\">\n                    <div className=\"text-xs text-muted-foreground mb-1\">EMA (20)</div>\n                    <div className=\"font-mono text-lg font-bold\">\n                      {data?.analysis.ema?.toFixed(2) || \"N/A\"}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Analysis Panel */}\n              <div className=\"glass-panel p-6 rounded-2xl h-full\">\n                <h3 className=\"font-display font-semibold text-lg mb-6 flex items-center gap-2\">\n                  <BarChart2 className=\"w-5 h-5 text-primary\" />\n                  Technical Analysis\n                </h3>\n                \n                <div className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Market Trend</span>\n                      <span className={`font-bold ${isUp ? \"text-emerald-400\" : isDown ? \"text-rose-400\" : \"text-foreground\"}`}>\n                        {data?.direction === \"UP\" ? \"BULLISH\" : data?.direction === \"DOWN\" ? \"BEARISH\" : \"NEUTRAL\"}\n                      </span>\n                    </div>\n                    <div className=\"w-full h-2 bg-white/5 rounded-full overflow-hidden flex\">\n                      <div className={`h-full ${isUp ? 'bg-emerald-500 w-3/4' : 'bg-emerald-500/20 w-1/2'}`}></div>\n                      <div className={`h-full ${isDown ? 'bg-rose-500 w-3/4' : 'bg-rose-500/20 w-1/2'}`}></div>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-4 pt-4 border-t border-white/5\">\n                    <h4 className=\"text-sm font-medium text-foreground\">Price Targets</h4>\n                    <div className=\"space-y-3\">\n                       <div className=\"flex justify-between items-center p-3 rounded-lg bg-emerald-500/5 border border-emerald-500/10\">\n                         <span className=\"text-xs text-emerald-200\">Resistance</span>\n                         <span className=\"font-mono font-bold text-emerald-400\">\n                           {data ? (data.currentPrice * 1.005).toFixed(2) : \"---\"}\n                         </span>\n                       </div>\n                       <div className=\"flex justify-between items-center p-3 rounded-lg bg-white/5 border border-white/5\">\n                         <span className=\"text-xs text-muted-foreground\">Current</span>\n                         <span className=\"font-mono font-bold text-foreground\">\n                            {data ? data.currentPrice.toFixed(2) : \"---\"}\n                         </span>\n                       </div>\n                       <div className=\"flex justify-between items-center p-3 rounded-lg bg-rose-500/5 border border-rose-500/10\">\n                         <span className=\"text-xs text-rose-200\">Support</span>\n                         <span className=\"font-mono font-bold text-rose-400\">\n                            {data ? (data.currentPrice * 0.995).toFixed(2) : \"---\"}\n                         </span>\n                       </div>\n                    </div>\n                  </div>\n\n                  <div className=\"pt-4 border-t border-white/5\">\n                    <div className=\"flex items-start gap-3 text-sm text-muted-foreground bg-white/5 p-4 rounded-xl\">\n                      <Clock className=\"w-4 h-4 mt-0.5 shrink-0\" />\n                      <p>\n                        Prediction valid for the next <span className=\"text-foreground font-medium\">{timeframe}</span> based on current volatility and momentum indicators.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":15039,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/Settings.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { UserSettings, Timeframe } from \"@shared/schema\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSubscription, useCustomerPortal } from \"@/hooks/use-subscription\";\nimport { useLocation } from \"wouter\";\nimport { \n  Settings as SettingsIcon, \n  Clock, \n  Moon, \n  RefreshCw,\n  Palette,\n  Gauge,\n  CreditCard,\n  Crown,\n  Loader2,\n  ExternalLink\n} from \"lucide-react\";\n\nexport default function Settings() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const { subscription, plan, isActive, isLoading: subLoading } = useSubscription();\n  const customerPortal = useCustomerPortal();\n\n  const { data: settings, isLoading } = useQuery<UserSettings>({\n    queryKey: ['/api/settings'],\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (updates: Partial<UserSettings>) => {\n      const res = await apiRequest('PUT', '/api/settings', updates);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/settings'] });\n      toast({\n        title: \"Settings Updated\",\n        description: \"Your preferences have been saved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleUpdate = (key: keyof UserSettings, value: any) => {\n    updateMutation.mutate({ [key]: value });\n  };\n\n  if (isLoading) {\n    return (\n      <DashboardLayout>\n        <div className=\"flex items-center justify-center h-96\">\n          <RefreshCw className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6 max-w-3xl\">\n        <div>\n          <h2 className=\"text-3xl font-display font-bold mb-1\">Settings</h2>\n          <p className=\"text-muted-foreground\">\n            Configure your trading preferences and application settings\n          </p>\n        </div>\n\n        {/* Trading Preferences */}\n        <Card className=\"border-white/5\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Gauge className=\"w-5 h-5 text-primary\" />\n              Trading Preferences\n            </CardTitle>\n            <CardDescription>\n              Configure default settings for market analysis\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-base\">Default Timeframe</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  The default timeframe used for analysis\n                </p>\n              </div>\n              <Select \n                value={settings?.defaultTimeframe} \n                onValueChange={(val) => handleUpdate('defaultTimeframe', val as Timeframe)}\n                data-testid=\"select-default-timeframe\"\n              >\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Select\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"1m\">1 Minute</SelectItem>\n                  <SelectItem value=\"5m\">5 Minutes</SelectItem>\n                  <SelectItem value=\"15m\">15 Minutes</SelectItem>\n                  <SelectItem value=\"30m\">30 Minutes</SelectItem>\n                  <SelectItem value=\"1h\">1 Hour</SelectItem>\n                  <SelectItem value=\"4h\">4 Hours</SelectItem>\n                  <SelectItem value=\"1d\">1 Day</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Auto Refresh Settings */}\n        <Card className=\"border-white/5\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-primary\" />\n              Auto Refresh\n            </CardTitle>\n            <CardDescription>\n              Configure automatic data refresh settings\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-base\">Enable Auto Refresh</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Automatically refresh price and analysis data\n                </p>\n              </div>\n              <Switch \n                checked={settings?.autoRefresh}\n                onCheckedChange={(checked) => handleUpdate('autoRefresh', checked)}\n                data-testid=\"switch-auto-refresh\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-base\">Refresh Interval</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  How often to refresh data (in seconds)\n                </p>\n              </div>\n              <Select \n                value={String(settings?.refreshInterval)} \n                onValueChange={(val) => handleUpdate('refreshInterval', Number(val))}\n                disabled={!settings?.autoRefresh}\n                data-testid=\"select-refresh-interval\"\n              >\n                <SelectTrigger className=\"w-[140px]\">\n                  <SelectValue placeholder=\"Select\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"10\">10 seconds</SelectItem>\n                  <SelectItem value=\"30\">30 seconds</SelectItem>\n                  <SelectItem value=\"60\">1 minute</SelectItem>\n                  <SelectItem value=\"120\">2 minutes</SelectItem>\n                  <SelectItem value=\"300\">5 minutes</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Appearance */}\n        <Card className=\"border-white/5\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Palette className=\"w-5 h-5 text-primary\" />\n              Appearance\n            </CardTitle>\n            <CardDescription>\n              Customize the look and feel of the application\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-base flex items-center gap-2\">\n                  <Moon className=\"w-4 h-4\" />\n                  Dark Mode\n                </Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Use dark theme for the interface\n                </p>\n              </div>\n              <Switch \n                checked={settings?.darkMode}\n                onCheckedChange={(checked) => handleUpdate('darkMode', checked)}\n                data-testid=\"switch-dark-mode\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Subscription Management */}\n        <Card className=\"border-white/5\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CreditCard className=\"w-5 h-5 text-primary\" />\n              Subscription\n            </CardTitle>\n            <CardDescription>\n              Manage your subscription plan and billing\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"space-y-1\">\n                <Label className=\"text-base flex items-center gap-2\">\n                  Current Plan\n                  {isActive && plan !== 'free' && (\n                    <Badge variant=\"secondary\" className=\"bg-primary/10 text-primary\">\n                      <Crown className=\"w-3 h-3 mr-1\" />\n                      {plan.charAt(0).toUpperCase() + plan.slice(1)}\n                    </Badge>\n                  )}\n                </Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  {isActive && plan !== 'free' \n                    ? `Your ${plan} subscription is active` \n                    : 'You are on the free tier with limited access'}\n                </p>\n                {subscription?.expiresAt && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    Renews on {new Date(subscription.expiresAt).toLocaleDateString()}\n                  </p>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                {isActive && plan !== 'free' ? (\n                  <Button \n                    variant=\"outline\"\n                    onClick={() => customerPortal.mutate()}\n                    disabled={customerPortal.isPending}\n                    data-testid=\"button-manage-subscription\"\n                  >\n                    {customerPortal.isPending ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                    ) : (\n                      <ExternalLink className=\"w-4 h-4 mr-2\" />\n                    )}\n                    Manage Billing\n                  </Button>\n                ) : (\n                  <Button \n                    onClick={() => setLocation('/pricing')}\n                    data-testid=\"button-upgrade-subscription\"\n                  >\n                    <Crown className=\"w-4 h-4 mr-2\" />\n                    Upgrade Plan\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* About Section */}\n        <Card className=\"border-white/5 bg-primary/5\">\n          <CardContent className=\"py-6\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center\">\n                <SettingsIcon className=\"w-6 h-6 text-primary\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-foreground\">\n                  Gold Predict {plan === 'premium' ? 'Premium' : plan === 'pro' ? 'Pro' : plan === 'basic' ? 'Basic' : 'Free'}\n                </h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Version 1.0.0 - Real-time XAUUSD Analysis & Predictions\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":11320,"size_tokens":null},"client/src/hooks/use-subscription.ts":{"content":"// Hook for managing user subscription status and features\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport type SubscriptionPlan = \"free\" | \"basic\" | \"pro\" | \"premium\";\nexport type SubscriptionStatus = \"active\" | \"canceled\" | \"past_due\" | \"trialing\" | \"inactive\";\n\nexport interface SubscriptionInfo {\n  plan: SubscriptionPlan;\n  status: SubscriptionStatus;\n  expiresAt: string | null;\n  isActive: boolean;\n  stripeCustomerId: string | null;\n  stripeSubscriptionId: string | null;\n}\n\nexport interface PlanPrice {\n  id: string;\n  unitAmount: number;\n  currency: string;\n  recurring: { interval: string } | null;\n  metadata: Record<string, string>;\n}\n\nexport interface SubscriptionPlanInfo {\n  id: string;\n  name: string;\n  description: string;\n  metadata: Record<string, string>;\n  prices: PlanPrice[];\n}\n\n// Feature limits per plan\n// Basic: RSI indicator, 3 predictions/day\n// Pro: RSI/MACD/SMA indicators, 10 predictions/day, trading signals, weekly alerts\n// Premium: All indicators, unlimited predictions, priority signals, premium AI reports, real-time email alerts\nexport const PLAN_FEATURES = {\n  free: {\n    predictions: 0,\n    indicators: [] as readonly string[],\n    signals: false,\n    analysis: false,\n    alerts: false,\n    alertFrequency: null as \"weekly\" | \"realtime\" | null,\n  },\n  basic: {\n    predictions: 3,\n    indicators: [\"rsi\"] as readonly string[],\n    signals: false,\n    analysis: false,\n    alerts: false,\n    alertFrequency: null as \"weekly\" | \"realtime\" | null,\n  },\n  pro: {\n    predictions: 10,\n    indicators: [\"rsi\", \"macd\", \"sma\"] as readonly string[],\n    signals: true,\n    analysis: false,\n    alerts: true,\n    alertFrequency: \"weekly\" as \"weekly\" | \"realtime\" | null,\n  },\n  premium: {\n    predictions: Infinity,\n    indicators: [\"rsi\", \"macd\", \"sma\", \"ema\", \"bollinger\", \"stochastic\", \"williams\", \"cci\", \"pivot\", \"ai\"] as readonly string[],\n    signals: true,\n    analysis: true,\n    alerts: true,\n    alertFrequency: \"realtime\" as \"weekly\" | \"realtime\" | null,\n  },\n} as const;\n\nexport function useSubscription() {\n  const { data: subscription, isLoading, error } = useQuery<SubscriptionInfo>({\n    queryKey: [\"/api/subscription/status\"],\n    retry: false,\n  });\n\n  const plan = subscription?.plan || \"free\";\n  const isActive = subscription?.isActive || false;\n  const features = PLAN_FEATURES[plan as keyof typeof PLAN_FEATURES] || PLAN_FEATURES.free;\n\n  // Check if a feature is available for the current plan\n  const hasFeature = (feature: keyof typeof PLAN_FEATURES.premium) => {\n    if (!isActive && plan !== \"free\") return false;\n    const planFeatures = PLAN_FEATURES[plan as keyof typeof PLAN_FEATURES];\n    if (!planFeatures) return false;\n    \n    const value = planFeatures[feature];\n    if (typeof value === \"boolean\") return value;\n    if (typeof value === \"number\") return value > 0;\n    if (Array.isArray(value)) return value.length > 0;\n    return false;\n  };\n\n  // Check if a specific indicator is available\n  const hasIndicator = (indicator: string) => {\n    if (!isActive && plan !== \"free\") return false;\n    return (features.indicators as readonly string[]).includes(indicator);\n  };\n\n  // Check remaining predictions for today\n  const canMakePrediction = (usedToday: number) => {\n    if (!isActive && plan !== \"free\") return false;\n    return usedToday < features.predictions;\n  };\n\n  return {\n    subscription,\n    plan,\n    isActive,\n    isLoading,\n    error,\n    features,\n    hasFeature,\n    hasIndicator,\n    canMakePrediction,\n    requiresSubscription: !isActive,\n  };\n}\n\nexport function useSubscriptionPlans() {\n  return useQuery<{ plans: SubscriptionPlanInfo[] }>({\n    queryKey: [\"/api/subscription/plans\"],\n  });\n}\n\nexport function useCheckout() {\n  return useMutation({\n    mutationFn: async (priceId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/subscription/checkout\", { priceId });\n      return res.json();\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n  });\n}\n\n// Create subscription with embedded payment (returns client_secret for Stripe Elements)\nexport function useCreateSubscription() {\n  return useMutation({\n    mutationFn: async (priceId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/subscription/create-subscription\", { priceId });\n      return res.json() as Promise<{ subscriptionId: string; clientSecret: string; status: string }>;\n    },\n  });\n}\n\n// Combined checkout + registration (creates account and subscription in one step)\nexport function useCheckoutRegister() {\n  return useMutation({\n    mutationFn: async (data: { email: string; password: string; firstName?: string; lastName?: string; priceId: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/subscription/checkout-register\", data);\n      return res.json() as Promise<{ subscriptionId: string; clientSecret: string; status: string; userId: string; isNewUser: boolean }>;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    },\n  });\n}\n\n// Confirm subscription after successful payment\nexport function useConfirmSubscription() {\n  return useMutation({\n    mutationFn: async (subscriptionId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/subscription/confirm\", { subscriptionId });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/subscription/status\"] });\n    },\n  });\n}\n\n// Fetch Stripe publishable key\nexport function useStripePublishableKey() {\n  return useQuery<{ publishableKey: string }>({\n    queryKey: [\"/api/stripe/publishable-key\"],\n  });\n}\n\nexport function useCustomerPortal() {\n  return useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/subscription/portal\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      if (data.url) {\n        window.location.href = data.url;\n      }\n    },\n  });\n}\n","path":null,"size_bytes":6037,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport helmet from \"helmet\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { runMigrations } from 'stripe-replit-sync';\nimport { getStripeSync } from './services/stripeClient';\nimport { WebhookHandlers } from './services/webhookHandlers';\n\nconst app = express();\n\napp.use(helmet({\n  contentSecurityPolicy: false,\n  crossOriginEmbedderPolicy: false,\n}));\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\n// Initialize Stripe schema and sync data on startup\nasync function initStripe() {\n  const databaseUrl = process.env.DATABASE_URL;\n  if (!databaseUrl) {\n    console.log('DATABASE_URL not set, skipping Stripe initialization');\n    return;\n  }\n\n  try {\n    console.log('Initializing Stripe schema...');\n    await runMigrations({ databaseUrl });\n    console.log('Stripe schema ready');\n\n    const stripeSync = await getStripeSync();\n\n    // Set up managed webhook\n    const webhookBaseUrl = `https://${process.env.REPLIT_DOMAINS?.split(',')[0]}`;\n    if (webhookBaseUrl && webhookBaseUrl !== 'https://undefined') {\n      try {\n        console.log('Setting up managed webhook...');\n        const result = await stripeSync.findOrCreateManagedWebhook(\n          `${webhookBaseUrl}/api/stripe/webhook`\n        );\n        if (result?.webhook?.url) {\n          console.log(`Webhook configured: ${result.webhook.url}`);\n        } else {\n          console.log('Webhook setup completed (no URL returned)');\n        }\n      } catch (webhookError) {\n        console.log('Webhook setup skipped (may already exist or require manual setup)');\n      }\n    }\n\n    // Sync all existing Stripe data in background\n    console.log('Syncing Stripe data...');\n    stripeSync.syncBackfill()\n      .then(() => console.log('Stripe data synced'))\n      .catch((err: any) => console.error('Error syncing Stripe data:', err));\n  } catch (error) {\n    console.error('Failed to initialize Stripe:', error);\n  }\n}\n\n// Initialize Stripe before setting up routes\nawait initStripe();\n\n// CRITICAL: Register Stripe webhook route BEFORE express.json()\n// Webhook needs raw Buffer, not parsed JSON\napp.post(\n  '/api/stripe/webhook',\n  express.raw({ type: 'application/json' }),\n  async (req, res) => {\n    const signature = req.headers['stripe-signature'];\n\n    if (!signature) {\n      return res.status(400).json({ error: 'Missing stripe-signature' });\n    }\n\n    try {\n      const sig = Array.isArray(signature) ? signature[0] : signature;\n\n      if (!Buffer.isBuffer(req.body)) {\n        console.error('STRIPE WEBHOOK ERROR: req.body is not a Buffer');\n        return res.status(500).json({ error: 'Webhook processing error' });\n      }\n\n      await WebhookHandlers.processWebhook(req.body as Buffer, sig);\n      res.status(200).json({ received: true });\n    } catch (error: any) {\n      console.error('Webhook error:', error.message);\n      res.status(400).json({ error: 'Webhook processing error' });\n    }\n  }\n);\n\n// Now apply JSON middleware for all other routes\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    console.error(\"Internal Server Error:\", err);\n\n    if (res.headersSent) {\n      return next(err);\n    }\n\n    return res.status(status).json({ message });\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":5481,"size_tokens":null},"server/subscriptionRoutes.ts":{"content":"// Subscription routes for Stripe integration\nimport type { Express } from \"express\";\nimport rateLimit from \"express-rate-limit\";\nimport { stripeService } from \"./services/stripeService\";\nimport { getStripePublishableKey } from \"./services/stripeClient\";\nimport { isAuthenticated, hashPassword, verifyPassword } from \"./replit_integrations/auth/replitAuth\";\nimport { authStorage } from \"./replit_integrations/auth/storage\";\nimport { sendWelcomeEmail } from \"./services/emailService\";\n\nexport function registerSubscriptionRoutes(app: Express): void {\n  // Get Stripe publishable key for frontend\n  app.get(\"/api/stripe/publishable-key\", async (req, res) => {\n    try {\n      const publishableKey = await getStripePublishableKey();\n      res.json({ publishableKey });\n    } catch (error) {\n      console.error(\"Failed to get publishable key:\", error);\n      res.status(500).json({ error: \"Failed to get Stripe configuration\" });\n    }\n  });\n\n  // Get available subscription plans (products with prices)\n  app.get(\"/api/subscription/plans\", async (req, res) => {\n    try {\n      const rows = await stripeService.listProductsWithPrices();\n      \n      // Group prices by product\n      const productsMap = new Map();\n      for (const row of rows as any[]) {\n        if (!productsMap.has(row.product_id)) {\n          productsMap.set(row.product_id, {\n            id: row.product_id,\n            name: row.product_name,\n            description: row.product_description,\n            metadata: row.product_metadata,\n            prices: []\n          });\n        }\n        if (row.price_id) {\n          productsMap.get(row.product_id).prices.push({\n            id: row.price_id,\n            unitAmount: row.unit_amount,\n            currency: row.currency,\n            recurring: row.recurring,\n            metadata: row.price_metadata,\n          });\n        }\n      }\n\n      res.json({ plans: Array.from(productsMap.values()) });\n    } catch (error) {\n      console.error(\"Failed to list plans:\", error);\n      res.status(500).json({ error: \"Failed to get subscription plans\" });\n    }\n  });\n\n  // Get current user's subscription status\n  app.get(\"/api/subscription/status\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const user = await stripeService.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // TEMPORARY PREVIEW BYPASS: Grant free access to admin email for dashboard preview\n      const PREVIEW_EMAIL = \"furlan27.mattia@gmail.com\";\n      if (user.email === PREVIEW_EMAIL) {\n        return res.json({\n          plan: 'premium',\n          status: 'active',\n          expiresAt: null,\n          isActive: true,\n          stripeCustomerId: user.stripeCustomerId,\n          stripeSubscriptionId: user.stripeSubscriptionId,\n        });\n      }\n\n      // Check if subscription is still valid\n      // active or trialing = full access\n      // past_due = grace period access (Stripe is retrying payment)\n      // canceled/inactive/expired = no access\n      const hasActiveStatus = user.subscriptionStatus === 'active' || \n        user.subscriptionStatus === 'trialing' || \n        user.subscriptionStatus === 'past_due';\n      const notExpired = !user.subscriptionExpiresAt || new Date(user.subscriptionExpiresAt) > new Date();\n      const isActive = hasActiveStatus && notExpired;\n\n      res.json({\n        plan: isActive ? (user.subscriptionPlan || 'free') : 'free',\n        status: user.subscriptionStatus || 'inactive',\n        expiresAt: user.subscriptionExpiresAt,\n        isActive,\n        stripeCustomerId: user.stripeCustomerId,\n        stripeSubscriptionId: user.stripeSubscriptionId,\n      });\n    } catch (error) {\n      console.error(\"Failed to get subscription status:\", error);\n      res.status(500).json({ error: \"Failed to get subscription status\" });\n    }\n  });\n\n  // Create checkout session for subscription (legacy redirect flow)\n  app.post(\"/api/subscription/checkout\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { priceId } = req.body;\n\n      if (!priceId) {\n        return res.status(400).json({ error: \"Price ID is required\" });\n      }\n\n      const user = await stripeService.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Create or get Stripe customer\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripeService.createCustomer(user.email, user.id);\n        await stripeService.updateUserStripeInfo(user.id, { stripeCustomerId: customer.id });\n        customerId = customer.id;\n      }\n\n      // Create checkout session\n      const baseUrl = `https://${process.env.REPLIT_DOMAINS?.split(',')[0]}`;\n      const session = await stripeService.createCheckoutSession(\n        customerId,\n        priceId,\n        userId,\n        `${baseUrl}/subscription/success?session_id={CHECKOUT_SESSION_ID}`,\n        `${baseUrl}/pricing`\n      );\n\n      res.json({ url: session.url });\n    } catch (error) {\n      console.error(\"Checkout session error:\", error);\n      res.status(500).json({ error: \"Failed to create checkout session\" });\n    }\n  });\n\n  // Create subscription with embedded payment (returns client_secret for Elements)\n  app.post(\"/api/subscription/create-subscription\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { priceId } = req.body;\n\n      if (!priceId) {\n        return res.status(400).json({ error: \"Price ID is required\" });\n      }\n\n      const user = await stripeService.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Create or get Stripe customer\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripeService.createCustomer(user.email, user.id);\n        await stripeService.updateUserStripeInfo(user.id, { stripeCustomerId: customer.id });\n        customerId = customer.id;\n      }\n\n      // Create subscription with incomplete payment\n      const result = await stripeService.createSubscriptionWithPaymentIntent(\n        customerId,\n        priceId,\n        userId\n      );\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"Create subscription error:\", error);\n      res.status(500).json({ error: \"Failed to create subscription\" });\n    }\n  });\n\n  // Confirm subscription after payment success\n  app.post(\"/api/subscription/confirm\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { subscriptionId } = req.body;\n\n      if (!subscriptionId) {\n        return res.status(400).json({ error: \"Subscription ID is required\" });\n      }\n\n      const subscription = await stripeService.confirmSubscription(subscriptionId, userId);\n\n      const user = await stripeService.getUser(userId);\n      if (user) {\n        const userName = user.firstName || undefined;\n        sendWelcomeEmail(user.email, userName).catch(err => {\n          console.error(\"Failed to send welcome email:\", err);\n        });\n      }\n\n      res.json({ success: true, status: subscription.status });\n    } catch (error) {\n      console.error(\"Confirm subscription error:\", error);\n      res.status(500).json({ error: \"Failed to confirm subscription\" });\n    }\n  });\n\n  // Create customer portal session for managing subscription\n  app.post(\"/api/subscription/portal\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const user = await stripeService.getUser(userId);\n      \n      if (!user?.stripeCustomerId) {\n        return res.status(400).json({ error: \"No active subscription found\" });\n      }\n\n      const baseUrl = `https://${process.env.REPLIT_DOMAINS?.split(',')[0]}`;\n      const session = await stripeService.createCustomerPortalSession(\n        user.stripeCustomerId,\n        `${baseUrl}/settings`\n      );\n\n      res.json({ url: session.url });\n    } catch (error) {\n      console.error(\"Portal session error:\", error);\n      res.status(500).json({ error: \"Failed to create portal session\" });\n    }\n  });\n\n  const checkoutRegisterLimiter = rateLimit({\n    windowMs: 60 * 60 * 1000,\n    max: 10,\n    message: { error: \"Too many checkout attempts. Please try again later.\" },\n    standardHeaders: true,\n    legacyHeaders: false,\n  });\n\n  app.post(\"/api/subscription/checkout-register\", checkoutRegisterLimiter, async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, priceId } = req.body;\n\n      if (!email || !password || !priceId) {\n        return res.status(400).json({ error: \"Email, password, and plan are required\" });\n      }\n\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(email) || email.length > 255) {\n        return res.status(400).json({ error: \"Please enter a valid email address\" });\n      }\n\n      if (password.length < 6 || password.length > 128) {\n        return res.status(400).json({ error: \"Password must be between 6 and 128 characters\" });\n      }\n\n      if (firstName && firstName.length > 100) {\n        return res.status(400).json({ error: \"First name is too long\" });\n      }\n      if (lastName && lastName.length > 100) {\n        return res.status(400).json({ error: \"Last name is too long\" });\n      }\n\n      const normalizedEmail = email.toLowerCase().trim();\n      let user = await authStorage.getUserByEmail(normalizedEmail);\n      let isNewUser = false;\n\n      if (user) {\n        const isValid = await verifyPassword(password, user.password);\n        if (!isValid) {\n          return res.status(401).json({ error: \"An account with this email already exists. Please use the correct password or log in from the login page.\" });\n        }\n      } else {\n        const hashedPassword = await hashPassword(password);\n        user = await authStorage.createUser({\n          email: normalizedEmail,\n          password: hashedPassword,\n          firstName: firstName?.trim() || undefined,\n          lastName: lastName?.trim() || undefined,\n        });\n        isNewUser = true;\n      }\n\n      req.session.userId = user.id;\n\n      let customerId = user.stripeCustomerId;\n      if (!customerId) {\n        const customer = await stripeService.createCustomer(user.email, user.id);\n        await stripeService.updateUserStripeInfo(user.id, { stripeCustomerId: customer.id });\n        customerId = customer.id;\n      }\n\n      const result = await stripeService.createSubscriptionWithPaymentIntent(\n        customerId,\n        priceId,\n        user.id\n      );\n\n      res.json({\n        ...result,\n        userId: user.id,\n        isNewUser,\n      });\n    } catch (error: any) {\n      console.error(\"Checkout register error:\", error);\n      res.status(500).json({ error: error.message || \"Failed to process checkout\" });\n    }\n  });\n\n  // Webhook handler for subscription events (called internally only)\n  // Protected: requires valid internal sync secret to prevent unauthorized subscription modifications\n  app.post(\"/api/subscription/sync\", async (req, res) => {\n    const syncSecret = req.headers['x-sync-secret'];\n    const expectedSecret = process.env.SYNC_SECRET;\n    \n    if (!expectedSecret || syncSecret !== expectedSecret) {\n      return res.status(403).json({ error: \"Forbidden\" });\n    }\n    \n    try {\n      const { customerId, subscriptionId, status, plan, currentPeriodEnd } = req.body;\n      \n      const user = await stripeService.getUserByStripeCustomerId(customerId);\n      if (user) {\n        await stripeService.updateUserStripeInfo(user.id, {\n          stripeSubscriptionId: subscriptionId,\n          subscriptionStatus: status,\n          subscriptionPlan: plan,\n          subscriptionExpiresAt: currentPeriodEnd ? new Date(currentPeriodEnd * 1000) : null,\n        });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Subscription sync error:\", error);\n      res.status(500).json({ error: \"Failed to sync subscription\" });\n    }\n  });\n}\n","path":null,"size_bytes":12108,"size_tokens":null},"client/src/hooks/use-auth.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport type { UserResponse, LoginInput, RegisterInput, UpdateProfileInput } from \"@shared/models/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nasync function fetchUser(): Promise<UserResponse | null> {\n  const response = await fetch(\"/api/auth/user\", {\n    credentials: \"include\",\n  });\n\n  if (response.status === 401) {\n    return null;\n  }\n\n  if (!response.ok) {\n    throw new Error(`${response.status}: ${response.statusText}`);\n  }\n\n  return response.json();\n}\n\nexport function useAuth() {\n  const queryClient = useQueryClient();\n  \n  const { data: user, isLoading } = useQuery<UserResponse | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: fetchUser,\n    retry: false,\n    staleTime: 1000 * 60 * 5,\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginInput) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData([\"/api/auth/user\"], data);\n      // Refresh subscription status after login\n      queryClient.invalidateQueries({ queryKey: [\"/api/subscription/status\"] });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: RegisterInput) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/register\", data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData([\"/api/auth/user\"], data);\n      // Refresh subscription status after registration\n      queryClient.invalidateQueries({ queryKey: [\"/api/subscription/status\"] });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\", {});\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/auth/user\"], null);\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: UpdateProfileInput) => {\n      const res = await apiRequest(\"PUT\", \"/api/auth/profile\", data);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData([\"/api/auth/user\"], data);\n    },\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    login: loginMutation.mutateAsync,\n    register: registerMutation.mutateAsync,\n    logout: logoutMutation.mutate,\n    updateProfile: updateProfileMutation.mutateAsync,\n    isLoggingIn: loginMutation.isPending,\n    isRegistering: registerMutation.isPending,\n    isLoggingOut: logoutMutation.isPending,\n    isUpdatingProfile: updateProfileMutation.isPending,\n    loginError: loginMutation.error,\n    registerError: registerMutation.error,\n    updateProfileError: updateProfileMutation.error,\n  };\n}\n","path":null,"size_bytes":2744,"size_tokens":null},"server/prediction.ts":{"content":"import { RSI, MACD, SMA, EMA, BollingerBands, Stochastic, WilliamsR, CCI, ATR } from 'technicalindicators';\nimport * as ss from 'simple-statistics';\nimport OpenAI from \"openai\";\nimport type { PredictRequest, PredictionResponse } from '@shared/schema';\nimport { fetchLiveXAUUSD } from './livePrice';\n\nlet openai: OpenAI | null = null;\n\nfunction getOpenAI(): OpenAI {\n  if (!openai) {\n    openai = new OpenAI({\n      apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || 'dummy-key',\n      baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n    });\n  }\n  return openai;\n}\n\ninterface Candle {\n  time: string;\n  open: number;\n  high: number;\n  low: number;\n  close: number;\n}\n\ninterface IndicatorSignal {\n  name: string;\n  signal: 'BUY' | 'SELL' | 'NEUTRAL';\n  strength: number;\n  weight: number;\n  value?: number;\n  description?: string;\n}\n\ninterface MultiTimeframeResult {\n  timeframe: string;\n  direction: 'UP' | 'DOWN' | 'NEUTRAL';\n  strength: number;\n}\n\nconst INTERVAL_MS: Record<string, number> = {\n  \"1m\": 60000,\n  \"5m\": 300000,\n  \"15m\": 900000,\n  \"30m\": 1800000,\n  \"1h\": 3600000,\n  \"4h\": 14400000,\n  \"1d\": 86400000,\n};\n\nfunction mapTimeframeToYahoo(timeframe: string): { interval: string, range: string } {\n  switch (timeframe) {\n    case '1m': return { interval: '1m', range: '1d' };\n    case '5m': return { interval: '5m', range: '5d' };\n    case '15m': return { interval: '15m', range: '5d' };\n    case '30m': return { interval: '30m', range: '5d' };\n    case '1h': return { interval: '1h', range: '1mo' };\n    case '4h': return { interval: '1h', range: '3mo' };\n    case '1d': return { interval: '1d', range: '1y' };\n    default: return { interval: '1h', range: '1mo' };\n  }\n}\n\nexport async function analyzeMarket(request: PredictRequest): Promise<PredictionResponse> {\n  const symbol = 'XAUUSD';\n  const timeframe = request.timeframe || '1h';\n  \n  const livePrice = await fetchLiveXAUUSD();\n  \n  let candles = await fetchHistoricalCandles(timeframe);\n  \n  if (candles.length === 0) {\n    console.log('Using generated candles as fallback');\n    candles = generateRealisticCandles(livePrice.price, timeframe, 100);\n  }\n  \n  const lastCandle = candles[candles.length - 1];\n  if (Math.abs(lastCandle.close - livePrice.price) / livePrice.price > 0.05) {\n    candles.push({\n      time: new Date().toISOString(),\n      open: lastCandle.close,\n      high: Math.max(lastCandle.close, livePrice.price),\n      low: Math.min(lastCandle.close, livePrice.price),\n      close: livePrice.price\n    });\n  }\n\n  // Get multi-timeframe analysis for higher confidence\n  const mtfAnalysis = await getMultiTimeframeAnalysis(timeframe);\n\n  return calculateAdvancedPrediction(candles, symbol, timeframe, livePrice.price, mtfAnalysis);\n}\n\nasync function getMultiTimeframeAnalysis(currentTimeframe: string): Promise<MultiTimeframeResult[]> {\n  const results: MultiTimeframeResult[] = [];\n  \n  // Define related timeframes for confluence\n  const timeframeHierarchy: Record<string, string[]> = {\n    '1m': ['5m', '15m'],\n    '5m': ['15m', '1h'],\n    '15m': ['1h', '4h'],\n    '30m': ['1h', '4h'],\n    '1h': ['4h', '1d'],\n    '4h': ['1d'],\n    '1d': [],\n  };\n  \n  const relatedTimeframes = timeframeHierarchy[currentTimeframe] || [];\n  \n  for (const tf of relatedTimeframes) {\n    try {\n      const candles = await fetchHistoricalCandles(tf);\n      if (candles.length >= 20) {\n        const closes = candles.map(c => c.close);\n        const trend = analyzeTrendFromCloses(closes);\n        results.push({\n          timeframe: tf,\n          direction: trend.direction,\n          strength: trend.strength\n        });\n      }\n    } catch (e) {\n      console.error(`Failed to fetch ${tf} for MTF analysis`);\n    }\n  }\n  \n  return results;\n}\n\nfunction analyzeTrendFromCloses(closes: number[]): { direction: 'UP' | 'DOWN' | 'NEUTRAL', strength: number } {\n  if (closes.length < 10) return { direction: 'NEUTRAL', strength: 0 };\n  \n  const recent = closes.slice(-20);\n  const sma10 = SMA.calculate({ period: 10, values: recent });\n  const sma20 = SMA.calculate({ period: 20, values: closes });\n  \n  const lastClose = closes[closes.length - 1];\n  const lastSMA10 = sma10.length > 0 ? sma10[sma10.length - 1] : lastClose;\n  const lastSMA20 = sma20.length > 0 ? sma20[sma20.length - 1] : lastClose;\n  \n  let direction: 'UP' | 'DOWN' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  \n  if (lastClose > lastSMA10 && lastSMA10 > lastSMA20) {\n    direction = 'UP';\n    strength = 70 + Math.min(25, ((lastClose - lastSMA20) / lastSMA20) * 1000);\n  } else if (lastClose < lastSMA10 && lastSMA10 < lastSMA20) {\n    direction = 'DOWN';\n    strength = 70 + Math.min(25, ((lastSMA20 - lastClose) / lastSMA20) * 1000);\n  }\n  \n  return { direction, strength: Math.min(95, strength) };\n}\n\nasync function fetchHistoricalCandles(timeframe: string): Promise<Candle[]> {\n  const { interval, range } = mapTimeframeToYahoo(timeframe);\n  const symbol = 'GC=F';\n  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=${interval}&range=${range}`;\n  \n  try {\n    const response = await fetch(url, {\n      headers: { 'User-Agent': 'Mozilla/5.0' }\n    });\n    \n    if (!response.ok) return [];\n    \n    const data = await response.json();\n    if (!data.chart || !data.chart.result || data.chart.result.length === 0) return [];\n    \n    const result = data.chart.result[0];\n    const timestamps = result.timestamp;\n    const quote = result.indicators.quote[0];\n    \n    const candles: Candle[] = [];\n    \n    for (let i = 0; i < timestamps.length; i++) {\n      if (quote.open[i] === null || quote.close[i] === null) continue;\n      \n      candles.push({\n        time: new Date(timestamps[i] * 1000).toISOString(),\n        open: quote.open[i],\n        high: quote.high[i],\n        low: quote.low[i],\n        close: quote.close[i]\n      });\n    }\n    \n    return candles;\n  } catch (e) {\n    console.error('Failed to fetch historical candles:', e);\n    return [];\n  }\n}\n\nfunction generateRealisticCandles(currentPrice: number, timeframe: string, count: number): Candle[] {\n  const intervalMs = INTERVAL_MS[timeframe] || 3600000;\n  const now = Date.now();\n  const candles: Candle[] = [];\n  \n  let price = currentPrice;\n  \n  const pricesReverse: number[] = [price];\n  for (let i = 1; i < count; i++) {\n    const volatility = timeframe === '1m' ? 0.05 : timeframe === '1d' ? 0.5 : 0.15;\n    const change = (Math.random() - 0.5) * volatility * 0.01 * price;\n    price = price - change;\n    pricesReverse.push(price);\n  }\n  \n  const prices = pricesReverse.reverse();\n  \n  for (let i = 0; i < count; i++) {\n    const candleTime = new Date(now - (count - 1 - i) * intervalMs);\n    const closePrice = prices[i];\n    const openPrice = i > 0 ? prices[i - 1] : closePrice * (1 + (Math.random() - 0.5) * 0.001);\n    \n    const range = Math.abs(closePrice - openPrice) + closePrice * 0.0005;\n    const high = Math.max(openPrice, closePrice) + Math.random() * range;\n    const low = Math.min(openPrice, closePrice) - Math.random() * range;\n    \n    candles.push({\n      time: candleTime.toISOString(),\n      open: Math.round(openPrice * 100) / 100,\n      high: Math.round(high * 100) / 100,\n      low: Math.round(low * 100) / 100,\n      close: Math.round(closePrice * 100) / 100,\n    });\n  }\n  \n  return candles;\n}\n\n// Enhanced indicator analysis functions\nfunction analyzeRSI(rsiValue: number): IndicatorSignal {\n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  if (rsiValue <= 20) {\n    signal = 'BUY';\n    strength = 95;\n    description = 'Extreme oversold - Strong buy signal';\n  } else if (rsiValue <= 30) {\n    signal = 'BUY';\n    strength = 85;\n    description = 'Oversold territory - Buy signal';\n  } else if (rsiValue <= 40) {\n    signal = 'BUY';\n    strength = 70;\n    description = 'Approaching oversold - Weak buy';\n  } else if (rsiValue >= 80) {\n    signal = 'SELL';\n    strength = 95;\n    description = 'Extreme overbought - Strong sell signal';\n  } else if (rsiValue >= 70) {\n    signal = 'SELL';\n    strength = 85;\n    description = 'Overbought territory - Sell signal';\n  } else if (rsiValue >= 60) {\n    signal = 'SELL';\n    strength = 70;\n    description = 'Approaching overbought - Weak sell';\n  } else {\n    strength = 50;\n    description = 'Neutral zone';\n  }\n  \n  return { name: 'RSI', signal, strength, weight: 1.8, value: rsiValue, description };\n}\n\nfunction analyzeMACD(macd: any): IndicatorSignal {\n  if (!macd || macd.histogram === undefined) {\n    return { name: 'MACD', signal: 'NEUTRAL', strength: 0, weight: 1.8 };\n  }\n  \n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  const histogram = macd.histogram;\n  const macdLine = macd.MACD || 0;\n  const signalLine = macd.signal || 0;\n  \n  // Strong signal when MACD crosses signal line with momentum\n  if (macdLine > signalLine && histogram > 0) {\n    signal = 'BUY';\n    strength = Math.min(95, 65 + Math.abs(histogram) * 8);\n    description = histogram > 2 ? 'Strong bullish momentum' : 'Bullish crossover';\n  } else if (macdLine < signalLine && histogram < 0) {\n    signal = 'SELL';\n    strength = Math.min(95, 65 + Math.abs(histogram) * 8);\n    description = histogram < -2 ? 'Strong bearish momentum' : 'Bearish crossover';\n  }\n  \n  // Check for divergence\n  if (Math.abs(histogram) > 3) {\n    strength = Math.min(95, strength + 10);\n    description += ' with strong divergence';\n  }\n  \n  return { name: 'MACD', signal, strength, weight: 1.8, value: histogram, description };\n}\n\nfunction analyzeSMAEMA(price: number, sma: number, ema: number): IndicatorSignal {\n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  const smaDistance = ((price - sma) / sma) * 100;\n  const emaDistance = ((price - ema) / ema) * 100;\n  \n  if (price > sma && price > ema && ema > sma) {\n    signal = 'BUY';\n    strength = Math.min(90, 70 + Math.abs(smaDistance) * 3);\n    description = 'Price above MAs, bullish alignment';\n  } else if (price < sma && price < ema && ema < sma) {\n    signal = 'SELL';\n    strength = Math.min(90, 70 + Math.abs(smaDistance) * 3);\n    description = 'Price below MAs, bearish alignment';\n  } else if (price > sma && price > ema) {\n    signal = 'BUY';\n    strength = 65;\n    description = 'Price above MAs';\n  } else if (price < sma && price < ema) {\n    signal = 'SELL';\n    strength = 65;\n    description = 'Price below MAs';\n  }\n  \n  return { name: 'SMA/EMA', signal, strength, weight: 1.4, description };\n}\n\nfunction analyzeBollingerBands(price: number, bb: any): IndicatorSignal {\n  if (!bb) {\n    return { name: 'Bollinger', signal: 'NEUTRAL', strength: 0, weight: 1.5 };\n  }\n  \n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  const bandwidth = ((bb.upper - bb.lower) / bb.middle) * 100;\n  const pricePosition = (price - bb.lower) / (bb.upper - bb.lower);\n  \n  if (price <= bb.lower) {\n    signal = 'BUY';\n    strength = 92;\n    description = 'Price at lower band - Strong buy';\n  } else if (pricePosition <= 0.15) {\n    signal = 'BUY';\n    strength = 82;\n    description = 'Price near lower band - Buy';\n  } else if (pricePosition <= 0.3) {\n    signal = 'BUY';\n    strength = 70;\n    description = 'Price in lower zone';\n  } else if (price >= bb.upper) {\n    signal = 'SELL';\n    strength = 92;\n    description = 'Price at upper band - Strong sell';\n  } else if (pricePosition >= 0.85) {\n    signal = 'SELL';\n    strength = 82;\n    description = 'Price near upper band - Sell';\n  } else if (pricePosition >= 0.7) {\n    signal = 'SELL';\n    strength = 70;\n    description = 'Price in upper zone';\n  }\n  \n  // Squeeze detection\n  if (bandwidth < 2) {\n    strength = Math.min(95, strength + 8);\n    description += ' (squeeze detected)';\n  }\n  \n  return { name: 'Bollinger', signal, strength, weight: 1.5, description };\n}\n\nfunction analyzeStochastic(stoch: any): IndicatorSignal {\n  if (!stoch) {\n    return { name: 'Stochastic', signal: 'NEUTRAL', strength: 0, weight: 1.6 };\n  }\n  \n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  const k = stoch.k;\n  const d = stoch.d;\n  \n  if (k <= 20 && d <= 20) {\n    signal = 'BUY';\n    strength = k > d ? 95 : 88;\n    description = k > d ? 'Bullish crossover in oversold' : 'Oversold zone';\n  } else if (k <= 30) {\n    signal = 'BUY';\n    strength = 75;\n    description = 'Approaching oversold';\n  } else if (k >= 80 && d >= 80) {\n    signal = 'SELL';\n    strength = k < d ? 95 : 88;\n    description = k < d ? 'Bearish crossover in overbought' : 'Overbought zone';\n  } else if (k >= 70) {\n    signal = 'SELL';\n    strength = 75;\n    description = 'Approaching overbought';\n  }\n  \n  return { name: 'Stochastic', signal, strength, weight: 1.6, value: k, description };\n}\n\nfunction analyzeWilliamsR(williamsR: number): IndicatorSignal {\n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  // Williams %R ranges from -100 to 0\n  if (williamsR <= -80) {\n    signal = 'BUY';\n    strength = williamsR <= -90 ? 92 : 80;\n    description = williamsR <= -90 ? 'Extreme oversold' : 'Oversold';\n  } else if (williamsR <= -60) {\n    signal = 'BUY';\n    strength = 65;\n    description = 'Lower zone';\n  } else if (williamsR >= -20) {\n    signal = 'SELL';\n    strength = williamsR >= -10 ? 92 : 80;\n    description = williamsR >= -10 ? 'Extreme overbought' : 'Overbought';\n  } else if (williamsR >= -40) {\n    signal = 'SELL';\n    strength = 65;\n    description = 'Upper zone';\n  }\n  \n  return { name: 'Williams %R', signal, strength, weight: 1.4, value: williamsR, description };\n}\n\nfunction analyzeCCI(cci: number): IndicatorSignal {\n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  if (cci <= -200) {\n    signal = 'BUY';\n    strength = 95;\n    description = 'Extreme oversold';\n  } else if (cci <= -100) {\n    signal = 'BUY';\n    strength = 85;\n    description = 'Oversold';\n  } else if (cci <= -50) {\n    signal = 'BUY';\n    strength = 70;\n    description = 'Bearish momentum weakening';\n  } else if (cci >= 200) {\n    signal = 'SELL';\n    strength = 95;\n    description = 'Extreme overbought';\n  } else if (cci >= 100) {\n    signal = 'SELL';\n    strength = 85;\n    description = 'Overbought';\n  } else if (cci >= 50) {\n    signal = 'SELL';\n    strength = 70;\n    description = 'Bullish momentum weakening';\n  }\n  \n  return { name: 'CCI', signal, strength, weight: 1.3, value: cci, description };\n}\n\nfunction analyzePivotPoints(price: number, high: number, low: number, close: number): IndicatorSignal {\n  // Calculate pivot points\n  const pivot = (high + low + close) / 3;\n  const r1 = (2 * pivot) - low;\n  const s1 = (2 * pivot) - high;\n  const r2 = pivot + (high - low);\n  const s2 = pivot - (high - low);\n  \n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  if (price <= s2) {\n    signal = 'BUY';\n    strength = 90;\n    description = 'At S2 support - Strong buy zone';\n  } else if (price <= s1) {\n    signal = 'BUY';\n    strength = 80;\n    description = 'At S1 support - Buy zone';\n  } else if (price < pivot && price > s1) {\n    signal = 'BUY';\n    strength = 65;\n    description = 'Below pivot - Mild bullish';\n  } else if (price >= r2) {\n    signal = 'SELL';\n    strength = 90;\n    description = 'At R2 resistance - Strong sell zone';\n  } else if (price >= r1) {\n    signal = 'SELL';\n    strength = 80;\n    description = 'At R1 resistance - Sell zone';\n  } else if (price > pivot && price < r1) {\n    signal = 'SELL';\n    strength = 65;\n    description = 'Above pivot - Mild bearish';\n  }\n  \n  return { name: 'Pivot Points', signal, strength, weight: 1.2, description };\n}\n\nfunction analyzeTrendStrength(candles: Candle[]): { direction: 'UP' | 'DOWN' | 'NEUTRAL', strength: number } {\n  if (candles.length < 20) {\n    return { direction: 'NEUTRAL', strength: 0 };\n  }\n  \n  const closes = candles.slice(-20).map(c => c.close);\n  const highs = candles.slice(-20).map(c => c.high);\n  const lows = candles.slice(-20).map(c => c.low);\n  \n  let plusDM = 0;\n  let minusDM = 0;\n  let tr = 0;\n  \n  for (let i = 1; i < closes.length; i++) {\n    const highDiff = highs[i] - highs[i-1];\n    const lowDiff = lows[i-1] - lows[i];\n    \n    if (highDiff > lowDiff && highDiff > 0) plusDM += highDiff;\n    if (lowDiff > highDiff && lowDiff > 0) minusDM += lowDiff;\n    \n    tr += Math.max(\n      highs[i] - lows[i],\n      Math.abs(highs[i] - closes[i-1]),\n      Math.abs(lows[i] - closes[i-1])\n    );\n  }\n  \n  const plusDI = tr > 0 ? (plusDM / tr) * 100 : 0;\n  const minusDI = tr > 0 ? (minusDM / tr) * 100 : 0;\n  const dx = (plusDI + minusDI) > 0 ? Math.abs(plusDI - minusDI) / (plusDI + minusDI) * 100 : 0;\n  \n  let direction: 'UP' | 'DOWN' | 'NEUTRAL' = 'NEUTRAL';\n  if (plusDI > minusDI && dx > 20) direction = 'UP';\n  else if (minusDI > plusDI && dx > 20) direction = 'DOWN';\n  \n  return { direction, strength: Math.min(100, dx * 1.5) };\n}\n\nfunction detectCandlePatterns(candles: Candle[]): IndicatorSignal {\n  if (candles.length < 5) {\n    return { name: 'Patterns', signal: 'NEUTRAL', strength: 0, weight: 1.2 };\n  }\n  \n  const recent = candles.slice(-5);\n  const last = recent[recent.length - 1];\n  const prev = recent[recent.length - 2];\n  const prev2 = recent[recent.length - 3];\n  \n  let signal: 'BUY' | 'SELL' | 'NEUTRAL' = 'NEUTRAL';\n  let strength = 50;\n  let description = '';\n  \n  const lastBody = Math.abs(last.close - last.open);\n  const lastRange = last.high - last.low;\n  const lastUpperWick = last.high - Math.max(last.open, last.close);\n  const lastLowerWick = Math.min(last.open, last.close) - last.low;\n  \n  // Hammer (bullish reversal)\n  if (lastLowerWick > lastBody * 2 && lastUpperWick < lastBody * 0.3 && last.close > last.open) {\n    signal = 'BUY';\n    strength = 85;\n    description = 'Hammer pattern';\n  }\n  // Shooting Star (bearish reversal)\n  else if (lastUpperWick > lastBody * 2 && lastLowerWick < lastBody * 0.3 && last.close < last.open) {\n    signal = 'SELL';\n    strength = 85;\n    description = 'Shooting star';\n  }\n  // Bullish Engulfing\n  else if (prev.close < prev.open && last.close > last.open && \n           last.open < prev.close && last.close > prev.open) {\n    signal = 'BUY';\n    strength = 90;\n    description = 'Bullish engulfing';\n  }\n  // Bearish Engulfing\n  else if (prev.close > prev.open && last.close < last.open && \n           last.open > prev.close && last.close < prev.open) {\n    signal = 'SELL';\n    strength = 90;\n    description = 'Bearish engulfing';\n  }\n  // Morning Star (bullish)\n  else if (prev2.close < prev2.open && \n           Math.abs(prev.close - prev.open) < lastRange * 0.3 &&\n           last.close > last.open && last.close > (prev2.open + prev2.close) / 2) {\n    signal = 'BUY';\n    strength = 88;\n    description = 'Morning star';\n  }\n  // Evening Star (bearish)\n  else if (prev2.close > prev2.open && \n           Math.abs(prev.close - prev.open) < lastRange * 0.3 &&\n           last.close < last.open && last.close < (prev2.open + prev2.close) / 2) {\n    signal = 'SELL';\n    strength = 88;\n    description = 'Evening star';\n  }\n  // Doji (indecision)\n  else if (lastBody < lastRange * 0.1) {\n    strength = 40;\n    description = 'Doji - indecision';\n  }\n  \n  // Check for consecutive candles\n  let consecutiveBullish = 0;\n  let consecutiveBearish = 0;\n  for (let i = recent.length - 1; i >= 0; i--) {\n    if (recent[i].close > recent[i].open) {\n      if (consecutiveBearish > 0) break;\n      consecutiveBullish++;\n    } else {\n      if (consecutiveBullish > 0) break;\n      consecutiveBearish++;\n    }\n  }\n  \n  if (consecutiveBullish >= 3 && signal !== 'SELL') {\n    signal = 'BUY';\n    strength = Math.max(strength, 70 + consecutiveBullish * 5);\n    description = description || `${consecutiveBullish} consecutive bullish`;\n  } else if (consecutiveBearish >= 3 && signal !== 'BUY') {\n    signal = 'SELL';\n    strength = Math.max(strength, 70 + consecutiveBearish * 5);\n    description = description || `${consecutiveBearish} consecutive bearish`;\n  }\n  \n  return { name: 'Patterns', signal, strength, weight: 1.2, description };\n}\n\nasync function getAIAnalysis(signals: IndicatorSignal[], price: number, trend: any): Promise<string> {\n  try {\n    const signalSummary = signals.map(s => \n      `${s.name}: ${s.signal} (${s.strength}%)${s.description ? ` - ${s.description}` : ''}`\n    ).join('\\n');\n    \n    const response = await getOpenAI().chat.completions.create({\n      model: \"gpt-5-nano\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an expert gold market analyst. Analyze the given technical indicators for XAUUSD and provide a brief, actionable trading insight. Be concise (2-3 sentences max). Focus on the strongest signals and key levels.`\n        },\n        {\n          role: \"user\",\n          content: `Current XAUUSD Price: $${price}\nTrend: ${trend.direction} (${trend.strength}% strength)\n\nTechnical Indicators:\n${signalSummary}\n\nProvide a brief market analysis and trading recommendation.`\n        }\n      ],\n      max_completion_tokens: 150,\n    });\n    \n    return response.choices[0]?.message?.content || '';\n  } catch (error) {\n    console.error('AI analysis failed:', error);\n    return '';\n  }\n}\n\nfunction calculateAdvancedPrediction(\n  candles: Candle[], \n  symbol: string, \n  timeframe: string, \n  currentLivePrice: number,\n  mtfAnalysis: MultiTimeframeResult[]\n): PredictionResponse {\n  const closes = candles.map(c => c.close);\n  const highs = candles.map(c => c.high);\n  const lows = candles.map(c => c.low);\n  const currentPrice = currentLivePrice;\n\n  // Calculate all technical indicators\n  const rsiValues = RSI.calculate({ values: closes, period: 14 });\n  const currentRSI = rsiValues.length > 0 ? rsiValues[rsiValues.length - 1] : 50;\n\n  const macdValues = MACD.calculate({\n    values: closes,\n    fastPeriod: 12,\n    slowPeriod: 26,\n    signalPeriod: 9,\n    SimpleMAOscillator: false,\n    SimpleMASignal: false\n  });\n  const currentMACD = macdValues.length > 0 ? macdValues[macdValues.length - 1] : undefined;\n\n  const smaValues = SMA.calculate({ period: 20, values: closes });\n  const currentSMA = smaValues.length > 0 ? smaValues[smaValues.length - 1] : currentPrice;\n\n  const emaValues = EMA.calculate({ period: 20, values: closes });\n  const currentEMA = emaValues.length > 0 ? emaValues[emaValues.length - 1] : currentPrice;\n\n  const bbValues = BollingerBands.calculate({\n    period: 20,\n    values: closes,\n    stdDev: 2\n  });\n  const currentBB = bbValues.length > 0 ? bbValues[bbValues.length - 1] : undefined;\n\n  const stochValues = Stochastic.calculate({\n    high: highs,\n    low: lows,\n    close: closes,\n    period: 14,\n    signalPeriod: 3\n  });\n  const currentStoch = stochValues.length > 0 ? stochValues[stochValues.length - 1] : undefined;\n\n  // Additional indicators\n  const williamsRValues = WilliamsR.calculate({\n    high: highs,\n    low: lows,\n    close: closes,\n    period: 14\n  });\n  const currentWilliamsR = williamsRValues.length > 0 ? williamsRValues[williamsRValues.length - 1] : -50;\n\n  const cciValues = CCI.calculate({\n    high: highs,\n    low: lows,\n    close: closes,\n    period: 20\n  });\n  const currentCCI = cciValues.length > 0 ? cciValues[cciValues.length - 1] : 0;\n\n  // Get yesterday's high/low/close for pivot points\n  const prevCandle = candles.length > 1 ? candles[candles.length - 2] : candles[candles.length - 1];\n\n  // Collect all indicator signals\n  const signals: IndicatorSignal[] = [\n    analyzeRSI(currentRSI),\n    analyzeMACD(currentMACD),\n    analyzeSMAEMA(currentPrice, currentSMA, currentEMA),\n    analyzeBollingerBands(currentPrice, currentBB),\n    analyzeStochastic(currentStoch),\n    analyzeWilliamsR(currentWilliamsR),\n    analyzeCCI(currentCCI),\n    analyzePivotPoints(currentPrice, prevCandle.high, prevCandle.low, prevCandle.close),\n    detectCandlePatterns(candles)\n  ];\n\n  // Analyze trend strength\n  const trend = analyzeTrendStrength(candles);\n\n  // Calculate weighted consensus\n  let buyScore = 0;\n  let sellScore = 0;\n  let totalWeight = 0;\n\n  for (const sig of signals) {\n    if (sig.strength === 0) continue; // Skip invalid signals\n    const effectiveWeight = sig.weight * (sig.strength / 100);\n    totalWeight += sig.weight;\n    \n    if (sig.signal === 'BUY') {\n      buyScore += effectiveWeight;\n    } else if (sig.signal === 'SELL') {\n      sellScore += effectiveWeight;\n    }\n  }\n\n  // Add trend weight\n  if (trend.direction === 'UP') {\n    buyScore += (trend.strength / 100) * 2.0;\n  } else if (trend.direction === 'DOWN') {\n    sellScore += (trend.strength / 100) * 2.0;\n  }\n  totalWeight += 2.0;\n\n  // Multi-timeframe confluence bonus\n  let mtfBonus = 0;\n  for (const mtf of mtfAnalysis) {\n    if ((trend.direction === 'UP' && mtf.direction === 'UP') ||\n        (trend.direction === 'DOWN' && mtf.direction === 'DOWN')) {\n      mtfBonus += (mtf.strength / 100) * 0.5;\n    }\n  }\n\n  // Calculate final signal and confidence\n  const netScore = buyScore - sellScore + mtfBonus * (buyScore > sellScore ? 1 : -1);\n  const normalizedScore = netScore / totalWeight;\n  \n  // Count strong signals for majority-based decision\n  const strongBuySignals = signals.filter(s => s.signal === 'BUY' && s.strength >= 65).length;\n  const strongSellSignals = signals.filter(s => s.signal === 'SELL' && s.strength >= 65).length;\n  const totalStrongSignals = strongBuySignals + strongSellSignals;\n  \n  let signal: 'BUY' | 'SELL' | 'HOLD' = 'HOLD';\n  let direction: 'UP' | 'DOWN' | 'NEUTRAL' = 'NEUTRAL';\n  \n  // Use both normalized score AND signal count majority\n  if (normalizedScore > 0.12 || (strongBuySignals >= 4 && strongBuySignals > strongSellSignals * 1.5)) {\n    signal = 'BUY';\n    direction = 'UP';\n  } else if (normalizedScore < -0.12 || (strongSellSignals >= 4 && strongSellSignals > strongBuySignals * 1.5)) {\n    signal = 'SELL';\n    direction = 'DOWN';\n  }\n\n  // Calculate confidence based on indicator agreement\n  const buySignals = signals.filter(s => s.signal === 'BUY' && s.strength >= 65);\n  const sellSignals = signals.filter(s => s.signal === 'SELL' && s.strength >= 65);\n  const veryStrongSignals = signals.filter(s => s.strength >= 85);\n  const strongSignals = signals.filter(s => s.strength >= 75);\n  \n  // Calculate agreement ratio\n  const alignedSignals = signal === 'BUY' ? buySignals.length : signal === 'SELL' ? sellSignals.length : 0;\n  const opposingSignals = signal === 'BUY' ? sellSignals.length : signal === 'SELL' ? buySignals.length : 0;\n  const agreementRatio = totalStrongSignals > 0 ? alignedSignals / totalStrongSignals : 0.5;\n  \n  let confidence = 50;\n  \n  // Base confidence from agreement ratio (more indicators agree = higher confidence)\n  if (signal !== 'HOLD') {\n    confidence += agreementRatio * 25; // Up to +25 for full agreement\n  }\n  \n  // Bonus for each aligned signal\n  if (signal === 'BUY') {\n    confidence += buySignals.length * 5;\n  } else if (signal === 'SELL') {\n    confidence += sellSignals.length * 5;\n  }\n  \n  // Strong bonus for very strong signals (85%+)\n  const alignedVeryStrong = veryStrongSignals.filter(s => s.signal === signal).length;\n  confidence += alignedVeryStrong * 6;\n  \n  // Bonus for trend alignment\n  if ((direction === 'UP' && trend.direction === 'UP') || \n      (direction === 'DOWN' && trend.direction === 'DOWN')) {\n    confidence += trend.strength * 0.15;\n  }\n  \n  // Multi-timeframe confluence bonus (big boost for higher timeframe agreement)\n  const alignedMTF = mtfAnalysis.filter(m => m.direction === direction);\n  confidence += alignedMTF.length * 10;\n  \n  // Bonus for extreme RSI levels (very reliable)\n  if ((currentRSI <= 25 && signal === 'BUY') || (currentRSI >= 75 && signal === 'SELL')) {\n    confidence += 10;\n  } else if ((currentRSI <= 35 && signal === 'BUY') || (currentRSI >= 65 && signal === 'SELL')) {\n    confidence += 5;\n  }\n  \n  // Bonus for extreme stochastic\n  if (currentStoch && ((currentStoch.k <= 20 && signal === 'BUY') || (currentStoch.k >= 80 && signal === 'SELL'))) {\n    confidence += 8;\n  }\n  \n  // Penalty for conflicting strong signals (reduced penalty)\n  const conflictingSignals = signals.filter(s => \n    s.strength >= 70 &&\n    ((s.signal === 'BUY' && signal === 'SELL') || \n    (s.signal === 'SELL' && signal === 'BUY'))\n  ).length;\n  confidence -= conflictingSignals * 4;\n  \n  // Normalize confidence\n  confidence = Math.max(50, Math.min(95, confidence));\n  \n  // If HOLD, reduce confidence to show uncertainty\n  if (signal === 'HOLD') {\n    confidence = Math.min(55, confidence);\n  }\n\n  // Calculate predicted price\n  const adjustmentFactor = normalizedScore * 0.0025;\n  let predictedPrice = currentPrice * (1 + adjustmentFactor);\n  \n  // RSI mean reversion adjustment\n  if (currentRSI > 80) {\n    predictedPrice *= 0.997;\n  } else if (currentRSI < 20) {\n    predictedPrice *= 1.003;\n  }\n\n  const change = predictedPrice - currentPrice;\n  const changePercent = (change / currentPrice) * 100;\n\n  // Calculate error metrics using regression\n  const trendPeriod = Math.min(20, closes.length);\n  const recentCloses = closes.slice(-trendPeriod);\n  const regressionData = recentCloses.map((y, x) => [x + 1, y] as [number, number]);\n  const regressionLine = ss.linearRegression(regressionData);\n  const regressionLineFn = ss.linearRegressionLine(regressionLine);\n  \n  const predictions = recentCloses.map((_, i) => regressionLineFn(i + 1));\n  const errors = recentCloses.map((actual, i) => actual - predictions[i]);\n  const rmse = Math.sqrt(ss.mean(errors.map(e => e * e)));\n  const mae = ss.mean(errors.map(e => Math.abs(e)));\n\n  // Generate forecast\n  const intervalMs = INTERVAL_MS[timeframe] || 3600000;\n  const forecastTime = new Date(Date.now() + intervalMs);\n\n  // Build indicator consensus string\n  const signalSummary = signals\n    .filter(s => s.strength >= 60)\n    .map(s => `${s.name}: ${s.signal} (${Math.round(s.strength)}%)`)\n    .join(', ');\n\n  // Get AI analysis asynchronously (don't block)\n  getAIAnalysis(signals, currentPrice, trend).then(aiInsight => {\n    // AI insight could be stored/cached for later retrieval\n  }).catch(() => {});\n\n  return {\n    symbol,\n    currentPrice: Math.round(currentPrice * 100) / 100,\n    predictedPrice: Math.round(predictedPrice * 100) / 100,\n    change: Math.round(change * 100) / 100,\n    changePercent: Math.round(changePercent * 10000) / 10000,\n    direction,\n    confidence: Math.round(confidence * 10) / 10,\n    signal,\n    metrics: {\n      rmse: Math.round(rmse * 10000) / 10000,\n      mae: Math.round(mae * 10000) / 10000,\n    },\n    analysis: {\n      rsi: Math.round(currentRSI * 10) / 10,\n      macd: currentMACD ? {\n        macd: Math.round((currentMACD.MACD || 0) * 1000) / 1000,\n        signal: Math.round((currentMACD.signal || 0) * 1000) / 1000,\n        histogram: Math.round((currentMACD.histogram || 0) * 1000) / 1000,\n      } : undefined,\n      sma: Math.round(currentSMA * 100) / 100,\n      ema: Math.round(currentEMA * 100) / 100,\n      bollingerBands: currentBB ? {\n        upper: Math.round(currentBB.upper * 100) / 100,\n        middle: Math.round(currentBB.middle * 100) / 100,\n        lower: Math.round(currentBB.lower * 100) / 100,\n      } : undefined,\n      stochastic: currentStoch ? {\n        k: Math.round(currentStoch.k * 10) / 10,\n        d: Math.round(currentStoch.d * 10) / 10,\n      } : undefined,\n      trendStrength: Math.round(trend.strength * 10) / 10,\n      trendDirection: trend.direction,\n      indicatorConsensus: signalSummary || 'Mixed signals',\n    },\n    candles,\n    forecast: [\n      { time: candles[candles.length - 1].time, price: currentPrice },\n      { time: forecastTime.toISOString(), price: Math.round(predictedPrice * 100) / 100 }\n    ]\n  };\n}\n","path":null,"size_bytes":31789,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useEffect } from \"react\";\nimport { PageTransition } from \"@/components/PageTransition\";\nimport LandingPricing from \"@/pages/LandingPricing\";\nimport Login from \"@/pages/Login\";\nimport Checkout from \"@/pages/Checkout\";\nimport Home from \"@/pages/Home\";\nimport Analysis from \"@/pages/Analysis\";\nimport Signals from \"@/pages/Signals\";\nimport Settings from \"@/pages/Settings\";\nimport SubscriptionSuccess from \"@/pages/SubscriptionSuccess\";\nimport SubscriptionRequired from \"@/pages/SubscriptionRequired\";\nimport NotFound from \"@/pages/not-found\";\nimport type { UserSettings } from \"@shared/schema\";\n\nfunction ThemeHandler() {\n  const { data: settings } = useQuery<UserSettings>({\n    queryKey: ['/api/settings'],\n  });\n\n  useEffect(() => {\n    if (settings) {\n      if (settings.darkMode) {\n        document.documentElement.classList.add('dark');\n      } else {\n        document.documentElement.classList.remove('dark');\n      }\n    } else {\n      document.documentElement.classList.add('dark');\n    }\n  }, [settings]);\n\n  return null;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Public routes - no auth required */}\n      <Route path=\"/\" component={LandingPricing} />\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/checkout\" component={Checkout} />\n      <Route path=\"/subscription/success\" component={SubscriptionSuccess} />\n      <Route path=\"/subscription/required\" component={SubscriptionRequired} />\n      \n      {/* Protected routes - require auth + subscription */}\n      <Route path=\"/dashboard\" component={Home} />\n      <Route path=\"/analysis\" component={Analysis} />\n      <Route path=\"/signals\" component={Signals} />\n      <Route path=\"/settings\" component={Settings} />\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <ThemeHandler />\n        <Toaster />\n        <PageTransition>\n          <Router />\n        </PageTransition>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":2354,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, timestamp, doublePrecision, integer, date } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const predictions = pgTable(\"predictions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\"),\n  symbol: text(\"symbol\").notNull(),\n  timeframe: text(\"timeframe\").notNull(),\n  currentPrice: doublePrecision(\"current_price\").notNull(),\n  predictedPrice: doublePrecision(\"predicted_price\").notNull(),\n  direction: text(\"direction\").notNull(),\n  confidence: doublePrecision(\"confidence\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Track daily prediction usage per user\nexport const predictionUsage = pgTable(\"prediction_usage\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull(),\n  usageDate: date(\"usage_date\").notNull(),\n  count: integer(\"count\").notNull().default(0),\n});\n\nexport const signals = pgTable(\"signals\", {\n  id: serial(\"id\").primaryKey(),\n  symbol: text(\"symbol\").notNull(),\n  timeframe: text(\"timeframe\").notNull(),\n  type: text(\"type\").notNull(), // BUY, SELL, HOLD\n  price: doublePrecision(\"price\").notNull(),\n  targetPrice: doublePrecision(\"target_price\"),\n  stopLoss: doublePrecision(\"stop_loss\"),\n  confidence: doublePrecision(\"confidence\").notNull(),\n  status: text(\"status\").notNull().default(\"ACTIVE\"), // ACTIVE, HIT_TARGET, HIT_STOP, EXPIRED\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertPredictionSchema = createInsertSchema(predictions).omit({ id: true, createdAt: true });\nexport const insertSignalSchema = createInsertSchema(signals).omit({ id: true, createdAt: true });\nexport const insertPredictionUsageSchema = createInsertSchema(predictionUsage).omit({ id: true });\n\nexport type Prediction = typeof predictions.$inferSelect;\nexport type InsertPrediction = z.infer<typeof insertPredictionSchema>;\nexport type Signal = typeof signals.$inferSelect;\nexport type InsertSignal = z.infer<typeof insertSignalSchema>;\nexport type PredictionUsage = typeof predictionUsage.$inferSelect;\nexport type InsertPredictionUsage = z.infer<typeof insertPredictionUsageSchema>;\n\n// API Types\nexport const TimeframeSchema = z.enum([\"1m\", \"5m\", \"15m\", \"30m\", \"1h\", \"4h\", \"1d\", \"1wk\", \"1mo\"]);\nexport type Timeframe = z.infer<typeof TimeframeSchema>;\n\nexport const PredictRequestSchema = z.object({\n  symbol: z.string().default(\"XAUUSD\"),\n  timeframe: TimeframeSchema.default(\"1h\"),\n});\n\nexport type PredictRequest = z.infer<typeof PredictRequestSchema>;\n\nexport const LivePriceSchema = z.object({\n  symbol: z.string(),\n  bid: z.number(),\n  ask: z.number(),\n  price: z.number(),\n  change: z.number(),\n  changePercent: z.number(),\n  high: z.number(),\n  low: z.number(),\n  timestamp: z.string(),\n  source: z.string(),\n});\n\nexport type LivePrice = z.infer<typeof LivePriceSchema>;\n\nexport const PredictionResponseSchema = z.object({\n  symbol: z.string(),\n  currentPrice: z.number(),\n  predictedPrice: z.number(),\n  change: z.number(),\n  changePercent: z.number(),\n  direction: z.enum([\"UP\", \"DOWN\", \"NEUTRAL\"]),\n  confidence: z.number(),\n  signal: z.enum([\"BUY\", \"SELL\", \"HOLD\"]),\n  metrics: z.object({\n    rmse: z.number(),\n    mae: z.number(),\n  }),\n  analysis: z.object({\n    rsi: z.number().optional(),\n    macd: z.object({\n      macd: z.number(),\n      signal: z.number(),\n      histogram: z.number()\n    }).optional(),\n    sma: z.number().optional(),\n    ema: z.number().optional(),\n    atr: z.number().optional(),\n    bollingerBands: z.object({\n      upper: z.number(),\n      middle: z.number(),\n      lower: z.number(),\n    }).optional(),\n    stochastic: z.object({\n      k: z.number(),\n      d: z.number(),\n    }).optional(),\n    trendStrength: z.number().optional(),\n    trendDirection: z.enum([\"UP\", \"DOWN\", \"NEUTRAL\"]).optional(),\n    indicatorConsensus: z.string().optional(),\n  }),\n  candles: z.array(z.object({\n    time: z.string(),\n    open: z.number(),\n    high: z.number(),\n    low: z.number(),\n    close: z.number(),\n  })),\n  forecast: z.array(z.object({\n    time: z.string(),\n    price: z.number(),\n  })),\n});\n\nexport type PredictionResponse = z.infer<typeof PredictionResponseSchema>;\n\nexport const SignalResponseSchema = z.object({\n  id: z.number(),\n  symbol: z.string(),\n  timeframe: z.string(),\n  type: z.string(),\n  price: z.number(),\n  targetPrice: z.number().nullable(),\n  stopLoss: z.number().nullable(),\n  confidence: z.number(),\n  status: z.string(),\n  createdAt: z.string(),\n  pnl: z.number().optional(),\n});\n\nexport type SignalResponse = z.infer<typeof SignalResponseSchema>;\n\nexport const UserSettingsSchema = z.object({\n  defaultTimeframe: TimeframeSchema,\n  autoRefresh: z.boolean(),\n  refreshInterval: z.number(),\n  darkMode: z.boolean(),\n  notifications: z.boolean(),\n});\n\nexport type UserSettings = z.infer<typeof UserSettingsSchema>;\n\nexport * from \"./models/chat\";\nexport * from \"./models/auth\";\n","path":null,"size_bytes":4910,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"server/replit_integrations/auth/replitAuth.ts":{"content":"import session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\nimport bcrypt from \"bcrypt\";\nimport { authStorage } from \"./storage\";\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n  }\n}\n\nexport function getSession() {\n  const sessionSecret = process.env.SESSION_SECRET;\n  if (!sessionSecret) {\n    throw new Error(\"SESSION_SECRET environment variable is required for secure session management\");\n  }\n  \n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: sessionSecret,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      sameSite: \"lax\",\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  if (req.session.userId) {\n    return next();\n  }\n  return res.status(401).json({ message: \"Unauthorized\" });\n};\n\nconst SALT_ROUNDS = 10;\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n","path":null,"size_bytes":1586,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/pages/Signals.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Timeframe, SignalResponse, LivePrice } from \"@shared/schema\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Zap, \n  TrendingUp, \n  TrendingDown, \n  Clock, \n  Target,\n  Shield,\n  Activity,\n  RefreshCw,\n  Plus,\n  X\n} from \"lucide-react\";\n\nexport default function Signals() {\n  const [timeframe, setTimeframe] = useState<Timeframe>(\"1h\");\n\n  const { data: livePrice } = useQuery<LivePrice>({\n    queryKey: ['/api/live-price'],\n    refetchInterval: 5000,\n  });\n\n  const { data: signals, isLoading } = useQuery<SignalResponse[]>({\n    queryKey: ['/api/signals'],\n    refetchInterval: 10000,\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async (tf: Timeframe) => {\n      const res = await apiRequest('POST', '/api/signals/generate', { timeframe: tf });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/signals'] });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await apiRequest('DELETE', `/api/signals/${id}`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/signals'] });\n    }\n  });\n\n  const handleGenerate = () => {\n    generateMutation.mutate(timeframe);\n  };\n\n  const handleDelete = (id: number) => {\n    deleteMutation.mutate(id);\n  };\n\n  const activeSignals = signals?.filter(s => s.status === 'ACTIVE') || [];\n  const historySignals = signals?.filter(s => s.status !== 'ACTIVE') || [];\n\n  const getSignalIcon = (type: string) => {\n    if (type === 'BUY') return <TrendingUp className=\"w-5 h-5 text-emerald-400\" />;\n    if (type === 'SELL') return <TrendingDown className=\"w-5 h-5 text-rose-400\" />;\n    return <Activity className=\"w-5 h-5 text-yellow-400\" />;\n  };\n\n  const getSignalColor = (type: string) => {\n    if (type === 'BUY') return 'border-l-emerald-500 bg-emerald-500/5';\n    if (type === 'SELL') return 'border-l-rose-500 bg-rose-500/5';\n    return 'border-l-yellow-500 bg-yellow-500/5';\n  };\n\n  const getPnLColor = (pnl: number | undefined) => {\n    if (!pnl) return 'text-muted-foreground';\n    return pnl >= 0 ? 'text-emerald-400' : 'text-rose-400';\n  };\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-display font-bold text-foreground mb-1\">Live Signals</h2>\n            <p className=\"text-muted-foreground flex items-center gap-2\">\n              <span>Real-time trading signals for XAUUSD</span>\n              <Badge variant=\"outline\" className=\"text-emerald-400 border-emerald-400/30\">\n                <span className=\"w-2 h-2 rounded-full bg-emerald-400 mr-2 animate-pulse\" />\n                LIVE\n              </Badge>\n            </p>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <Select \n              value={timeframe} \n              onValueChange={(val) => setTimeframe(val as Timeframe)}\n            >\n              <SelectTrigger className=\"w-[120px] bg-card border-border text-foreground h-10 rounded-xl\" data-testid=\"select-signal-timeframe\">\n                <SelectValue placeholder=\"Timeframe\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"1m\">1 Minute</SelectItem>\n                <SelectItem value=\"5m\">5 Minutes</SelectItem>\n                <SelectItem value=\"15m\">15 Minutes</SelectItem>\n                <SelectItem value=\"30m\">30 Minutes</SelectItem>\n                <SelectItem value=\"1h\">1 Hour</SelectItem>\n                <SelectItem value=\"4h\">4 Hours</SelectItem>\n                <SelectItem value=\"1d\">1 Day</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Button onClick={handleGenerate} disabled={generateMutation.isPending} data-testid=\"button-generate-signal\">\n              {generateMutation.isPending ? (\n                <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" />\n              ) : (\n                <Plus className=\"w-4 h-4 mr-2\" />\n              )}\n              Generate Signal\n            </Button>\n          </div>\n        </div>\n\n        {/* Live Price Card */}\n        <Card className=\"bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20\">\n          <CardContent className=\"py-4\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center\">\n                  <Activity className=\"w-6 h-6 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Current XAUUSD</p>\n                  <p className=\"text-3xl font-bold font-mono text-foreground\">\n                    ${livePrice?.price.toFixed(2) || '----.--'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex gap-6\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Active Signals</p>\n                  <p className=\"text-2xl font-bold text-primary\">{activeSignals.length}</p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Win Rate</p>\n                  <p className=\"text-2xl font-bold text-emerald-400\">\n                    {historySignals.length > 0 \n                      ? Math.round((historySignals.filter(s => s.status === 'HIT_TARGET').length / historySignals.length) * 100)\n                      : 0}%\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Active Signals */}\n        <div>\n          <h3 className=\"text-lg font-semibold text-foreground mb-4 flex items-center gap-2\">\n            <Zap className=\"w-5 h-5 text-primary\" />\n            Active Signals\n          </h3>\n          \n          {isLoading ? (\n            <div className=\"text-center py-8 text-muted-foreground\">Loading signals...</div>\n          ) : activeSignals.length === 0 ? (\n            <Card className=\"border-white/5 border-dashed\">\n              <CardContent className=\"py-8 text-center\">\n                <p className=\"text-muted-foreground mb-4\">No active signals. Generate a new signal to start trading.</p>\n                <Button onClick={handleGenerate} variant=\"outline\" data-testid=\"button-generate-first-signal\">\n                  <Plus className=\"w-4 h-4 mr-2\" /> Generate First Signal\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              {activeSignals.map(signal => (\n                <Card key={signal.id} className={`border-l-4 ${getSignalColor(signal.type)} relative`}>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute top-2 right-2 h-8 w-8 text-muted-foreground hover:text-white hover:bg-white/10\"\n                    onClick={() => handleDelete(signal.id)}\n                    disabled={deleteMutation.isPending}\n                    data-testid={`button-delete-signal-${signal.id}`}\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                  <CardContent className=\"py-4 pr-12\">\n                    <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                          signal.type === 'BUY' ? 'bg-emerald-500/20' : \n                          signal.type === 'SELL' ? 'bg-rose-500/20' : 'bg-yellow-500/20'\n                        }`}>\n                          {getSignalIcon(signal.type)}\n                        </div>\n                        <div>\n                          <div className=\"flex items-center gap-2\">\n                            <Badge variant={signal.type === 'BUY' ? 'default' : signal.type === 'SELL' ? 'destructive' : 'secondary'}>\n                              {signal.type}\n                            </Badge>\n                            <span className=\"text-sm text-muted-foreground\">{signal.timeframe}</span>\n                          </div>\n                          <p className=\"text-xl font-bold font-mono mt-1\">\n                            Entry: ${signal.price.toFixed(2)}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-6\">\n                        <div className=\"text-center\">\n                          <div className=\"flex items-center gap-1 text-xs text-emerald-400 mb-1\">\n                            <Target className=\"w-3 h-3\" /> Target\n                          </div>\n                          <p className=\"font-mono font-bold text-emerald-400\">\n                            ${signal.targetPrice?.toFixed(2) || '---'}\n                          </p>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"flex items-center gap-1 text-xs text-rose-400 mb-1\">\n                            <Shield className=\"w-3 h-3\" /> Stop Loss\n                          </div>\n                          <p className=\"font-mono font-bold text-rose-400\">\n                            ${signal.stopLoss?.toFixed(2) || '---'}\n                          </p>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-xs text-muted-foreground mb-1\">P&L</div>\n                          <p className={`font-mono font-bold ${getPnLColor(signal.pnl)}`}>\n                            {signal.pnl && signal.pnl >= 0 ? '+' : ''}{signal.pnl?.toFixed(2) || '0.00'}\n                          </p>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"text-xs text-muted-foreground mb-1\">Confidence</div>\n                          <p className=\"font-mono font-bold text-primary\">\n                            {signal.confidence.toFixed(0)}%\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Signal History */}\n        {historySignals.length > 0 && (\n          <div>\n            <h3 className=\"text-lg font-semibold text-foreground mb-4 flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-muted-foreground\" />\n              Signal History\n            </h3>\n            <Card className=\"border-white/5\">\n              <CardContent className=\"p-0\">\n                <div className=\"divide-y divide-white/5\">\n                  {historySignals.slice(0, 10).map(signal => (\n                    <div key={signal.id} className=\"p-4 flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        {getSignalIcon(signal.type)}\n                        <div>\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-medium\">{signal.type}</span>\n                            <span className=\"text-sm text-muted-foreground\">{signal.timeframe}</span>\n                          </div>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Entry: ${signal.price.toFixed(2)}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"text-right\">\n                          <Badge variant={signal.status === 'HIT_TARGET' ? 'default' : 'destructive'}>\n                            {signal.status}\n                          </Badge>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {new Date(signal.createdAt).toLocaleDateString()}\n                          </p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-muted-foreground hover:text-white hover:bg-white/10\"\n                          onClick={() => handleDelete(signal.id)}\n                          disabled={deleteMutation.isPending}\n                          data-testid={`button-delete-history-signal-${signal.id}`}\n                        >\n                          <X className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":13513,"size_tokens":null},"shared/models/auth.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { index, jsonb, pgTable, timestamp, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table for express-session\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)]\n);\n\n// Subscription plan types\nexport const SubscriptionPlanSchema = z.enum([\"free\", \"basic\", \"pro\", \"premium\"]);\nexport type SubscriptionPlan = z.infer<typeof SubscriptionPlanSchema>;\n\nexport const SubscriptionStatusSchema = z.enum([\"active\", \"canceled\", \"past_due\", \"trialing\", \"inactive\"]);\nexport type SubscriptionStatus = z.infer<typeof SubscriptionStatusSchema>;\n\n// User storage table with password for email/password auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique().notNull(),\n  password: varchar(\"password\").notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  nickname: varchar(\"nickname\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  stripeCustomerId: varchar(\"stripe_customer_id\"),\n  stripeSubscriptionId: varchar(\"stripe_subscription_id\"),\n  subscriptionPlan: varchar(\"subscription_plan\").default(\"free\"),\n  subscriptionStatus: varchar(\"subscription_status\").default(\"inactive\"),\n  subscriptionExpiresAt: timestamp(\"subscription_expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\n// Auth schemas for API validation\nexport const registerSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  firstName: z.string().optional(),\n  lastName: z.string().optional(),\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nexport const updateProfileSchema = z.object({\n  nickname: z.string().min(1, \"Nickname is required\").max(50, \"Nickname too long\"),\n});\n\nexport type RegisterInput = z.infer<typeof registerSchema>;\nexport type LoginInput = z.infer<typeof loginSchema>;\nexport type UpdateProfileInput = z.infer<typeof updateProfileSchema>;\n\n// User response (without password)\nexport type UserResponse = Omit<User, \"password\">;\n","path":null,"size_bytes":2625,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/replit_integrations/audio/client.ts":{"content":"import OpenAI, { toFile } from \"openai\";\nimport { Buffer } from \"node:buffer\";\nimport { spawn } from \"child_process\";\nimport { writeFile, unlink, readFile } from \"fs/promises\";\nimport { randomUUID } from \"crypto\";\nimport { tmpdir } from \"os\";\nimport { join } from \"path\";\n\nlet _openai: OpenAI | null = null;\n\nfunction getOpenAI(): OpenAI {\n  if (!_openai) {\n    _openai = new OpenAI({\n      apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || 'dummy-key',\n      baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n    });\n  }\n  return _openai;\n}\n\nexport type AudioFormat = \"wav\" | \"mp3\" | \"webm\" | \"mp4\" | \"ogg\" | \"unknown\";\n\n/**\n * Detect audio format from buffer magic bytes.\n * Supports: WAV, MP3, WebM (Chrome/Firefox), MP4/M4A/MOV (Safari/iOS), OGG\n */\nexport function detectAudioFormat(buffer: Buffer): AudioFormat {\n  if (buffer.length < 12) return \"unknown\";\n\n  // WAV: RIFF....WAVE\n  if (buffer[0] === 0x52 && buffer[1] === 0x49 && buffer[2] === 0x46 && buffer[3] === 0x46) {\n    return \"wav\";\n  }\n  // WebM: EBML header\n  if (buffer[0] === 0x1a && buffer[1] === 0x45 && buffer[2] === 0xdf && buffer[3] === 0xa3) {\n    return \"webm\";\n  }\n  // MP3: ID3 tag or frame sync\n  if (\n    (buffer[0] === 0xff && (buffer[1] === 0xfb || buffer[1] === 0xfa || buffer[1] === 0xf3)) ||\n    (buffer[0] === 0x49 && buffer[1] === 0x44 && buffer[2] === 0x33)\n  ) {\n    return \"mp3\";\n  }\n  // MP4/M4A/MOV: ....ftyp (Safari/iOS records in these containers)\n  if (buffer[4] === 0x66 && buffer[5] === 0x74 && buffer[6] === 0x79 && buffer[7] === 0x70) {\n    return \"mp4\";\n  }\n  // OGG: OggS\n  if (buffer[0] === 0x4f && buffer[1] === 0x67 && buffer[2] === 0x67 && buffer[3] === 0x53) {\n    return \"ogg\";\n  }\n  return \"unknown\";\n}\n\n/**\n * Convert any audio/video format to WAV using ffmpeg.\n * Uses temp files instead of pipes because video containers (MP4/MOV)\n * require seeking to find the audio track.\n */\nexport async function convertToWav(audioBuffer: Buffer): Promise<Buffer> {\n  const inputPath = join(tmpdir(), `input-${randomUUID()}`);\n  const outputPath = join(tmpdir(), `output-${randomUUID()}.wav`);\n\n  try {\n    // Write input to temp file (required for video containers that need seeking)\n    await writeFile(inputPath, audioBuffer);\n\n    // Run ffmpeg with file paths\n    await new Promise<void>((resolve, reject) => {\n      const ffmpeg = spawn(\"ffmpeg\", [\n        \"-i\", inputPath,\n        \"-vn\",              // Extract audio only (ignore video track)\n        \"-f\", \"wav\",\n        \"-ar\", \"16000\",     // 16kHz sample rate (good for speech)\n        \"-ac\", \"1\",         // Mono\n        \"-acodec\", \"pcm_s16le\",\n        \"-y\",               // Overwrite output\n        outputPath,\n      ]);\n\n      ffmpeg.stderr.on(\"data\", () => {}); // Suppress logs\n      ffmpeg.on(\"close\", (code) => {\n        if (code === 0) resolve();\n        else reject(new Error(`ffmpeg exited with code ${code}`));\n      });\n      ffmpeg.on(\"error\", reject);\n    });\n\n    // Read converted audio\n    return await readFile(outputPath);\n  } finally {\n    // Clean up temp files\n    await unlink(inputPath).catch(() => {});\n    await unlink(outputPath).catch(() => {});\n  }\n}\n\n/**\n * Auto-detect and convert audio to OpenAI-compatible format.\n * - WAV/MP3: Pass through (already compatible)\n * - WebM/MP4/OGG: Convert to WAV via ffmpeg\n */\nexport async function ensureCompatibleFormat(\n  audioBuffer: Buffer\n): Promise<{ buffer: Buffer; format: \"wav\" | \"mp3\" }> {\n  const detected = detectAudioFormat(audioBuffer);\n  if (detected === \"wav\") return { buffer: audioBuffer, format: \"wav\" };\n  if (detected === \"mp3\") return { buffer: audioBuffer, format: \"mp3\" };\n  // Convert WebM, MP4, OGG, or unknown to WAV\n  const wavBuffer = await convertToWav(audioBuffer);\n  return { buffer: wavBuffer, format: \"wav\" };\n}\n\n/**\n * Voice Chat: User speaks, LLM responds with audio (audio-in, audio-out).\n * Uses gpt-audio model via Replit AI Integrations.\n * Note: Browser records WebM/opus - convert to WAV using ffmpeg before calling this.\n */\nexport async function voiceChat(\n  audioBuffer: Buffer,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  inputFormat: \"wav\" | \"mp3\" = \"wav\",\n  outputFormat: \"wav\" | \"mp3\" = \"mp3\"\n): Promise<{ transcript: string; audioResponse: Buffer }> {\n  const audioBase64 = audioBuffer.toString(\"base64\");\n  const response = await getOpenAI().chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: outputFormat },\n    messages: [{\n      role: \"user\",\n      content: [\n        { type: \"input_audio\", input_audio: { data: audioBase64, format: inputFormat } },\n      ],\n    }],\n  });\n  const message = response.choices[0]?.message as any;\n  const transcript = message?.audio?.transcript || message?.content || \"\";\n  const audioData = message?.audio?.data ?? \"\";\n  return {\n    transcript,\n    audioResponse: Buffer.from(audioData, \"base64\"),\n  };\n}\n\n/**\n * Streaming Voice Chat: For real-time audio responses.\n * Note: Streaming only supports pcm16 output format.\n *\n * @example\n * // Converting browser WebM to WAV before calling:\n * const webmBuffer = Buffer.from(req.body.audio, \"base64\");\n * const wavBuffer = await convertWebmToWav(webmBuffer);\n * for await (const chunk of voiceChatStream(wavBuffer)) { ... }\n */\nexport async function voiceChatStream(\n  audioBuffer: Buffer,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  inputFormat: \"wav\" | \"mp3\" = \"wav\"\n): Promise<AsyncIterable<{ type: \"transcript\" | \"audio\"; data: string }>> {\n  const audioBase64 = audioBuffer.toString(\"base64\");\n  const stream = await getOpenAI().chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: \"pcm16\" },\n    messages: [{\n      role: \"user\",\n      content: [\n        { type: \"input_audio\", input_audio: { data: audioBase64, format: inputFormat } },\n      ],\n    }],\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const chunk of stream) {\n      const delta = chunk.choices?.[0]?.delta as any;\n      if (!delta) continue;\n      if (delta?.audio?.transcript) {\n        yield { type: \"transcript\", data: delta.audio.transcript };\n      }\n      if (delta?.audio?.data) {\n        yield { type: \"audio\", data: delta.audio.data };\n      }\n    }\n  })();\n}\n\n/**\n * Text-to-Speech: Converts text to speech verbatim.\n * Uses gpt-audio model via Replit AI Integrations.\n */\nexport async function textToSpeech(\n  text: string,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\",\n  format: \"wav\" | \"mp3\" | \"flac\" | \"opus\" | \"pcm16\" = \"wav\"\n): Promise<Buffer> {\n  const response = await getOpenAI().chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format },\n    messages: [\n      { role: \"system\", content: \"You are an assistant that performs text-to-speech.\" },\n      { role: \"user\", content: `Repeat the following text verbatim: ${text}` },\n    ],\n  });\n  const audioData = (response.choices[0]?.message as any)?.audio?.data ?? \"\";\n  return Buffer.from(audioData, \"base64\");\n}\n\n/**\n * Streaming Text-to-Speech: Converts text to speech with real-time streaming.\n * Uses gpt-audio model via Replit AI Integrations.\n * Note: Streaming only supports pcm16 output format.\n */\nexport async function textToSpeechStream(\n  text: string,\n  voice: \"alloy\" | \"echo\" | \"fable\" | \"onyx\" | \"nova\" | \"shimmer\" = \"alloy\"\n): Promise<AsyncIterable<string>> {\n  const stream = await getOpenAI().chat.completions.create({\n    model: \"gpt-audio\",\n    modalities: [\"text\", \"audio\"],\n    audio: { voice, format: \"pcm16\" },\n    messages: [\n      { role: \"system\", content: \"You are an assistant that performs text-to-speech.\" },\n      { role: \"user\", content: `Repeat the following text verbatim: ${text}` },\n    ],\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const chunk of stream) {\n      const delta = chunk.choices?.[0]?.delta as any;\n      if (!delta) continue;\n      if (delta?.audio?.data) {\n        yield delta.audio.data;\n      }\n    }\n  })();\n}\n\n/**\n * Speech-to-Text: Transcribes audio using dedicated transcription model.\n * Uses gpt-4o-mini-transcribe for accurate transcription.\n */\nexport async function speechToText(\n  audioBuffer: Buffer,\n  format: \"wav\" | \"mp3\" | \"webm\" = \"wav\"\n): Promise<string> {\n  const file = await toFile(audioBuffer, `audio.${format}`);\n  const response = await getOpenAI().audio.transcriptions.create({\n    file,\n    model: \"gpt-4o-mini-transcribe\",\n  });\n  return response.text;\n}\n\n/**\n * Streaming Speech-to-Text: Transcribes audio with real-time streaming.\n * Uses gpt-4o-mini-transcribe for accurate transcription.\n */\nexport async function speechToTextStream(\n  audioBuffer: Buffer,\n  format: \"wav\" | \"mp3\" | \"webm\" = \"wav\"\n): Promise<AsyncIterable<string>> {\n  const file = await toFile(audioBuffer, `audio.${format}`);\n  const stream = await getOpenAI().audio.transcriptions.create({\n    file,\n    model: \"gpt-4o-mini-transcribe\",\n    stream: true,\n  });\n\n  return (async function* () {\n    for await (const event of stream) {\n      if (event.type === \"transcript.text.delta\") {\n        yield event.delta;\n      }\n    }\n  })();\n}\n","path":null,"size_bytes":9231,"size_tokens":null},"server/replit_integrations/batch/utils.ts":{"content":"import pLimit from \"p-limit\";\nimport pRetry from \"p-retry\";\n\n/**\n * Batch Processing Utilities\n *\n * This module provides a generic batch processing function with built-in\n * rate limiting and automatic retries. Use it for any task that requires\n * processing multiple items through an LLM or external API.\n *\n * USAGE:\n * ```typescript\n * import { batchProcess, isRateLimitError } from \"./replit_integrations/batch\";\n *\n * const results = await batchProcess(\n *   artworks,\n *   async (artwork) => {\n *     // Your custom LLM logic here\n *     const response = await openai.chat.completions.create({\n *       model: \"gpt-5.1\",\n *       messages: [{ role: \"user\", content: `Categorize: ${artwork.name}` }],\n *       response_format: { type: \"json_object\" },\n *     });\n *     return JSON.parse(response.choices[0]?.message?.content || \"{}\");\n *   },\n *   { concurrency: 2, retries: 5 }\n * );\n * ```\n */\n\nexport interface BatchOptions {\n  /** Max concurrent requests (default: 2) */\n  concurrency?: number;\n  /** Max retry attempts for rate limit errors (default: 7) */\n  retries?: number;\n  /** Initial retry delay in ms (default: 2000) */\n  minTimeout?: number;\n  /** Max retry delay in ms (default: 128000) */\n  maxTimeout?: number;\n  /** Callback for progress updates */\n  onProgress?: (completed: number, total: number, item: unknown) => void;\n}\n\n/**\n * Check if an error is a rate limit or quota violation.\n * Use this in custom error handling if needed.\n */\nexport function isRateLimitError(error: unknown): boolean {\n  const errorMsg = error instanceof Error ? error.message : String(error);\n  return (\n    errorMsg.includes(\"429\") ||\n    errorMsg.includes(\"RATELIMIT_EXCEEDED\") ||\n    errorMsg.toLowerCase().includes(\"quota\") ||\n    errorMsg.toLowerCase().includes(\"rate limit\")\n  );\n}\n\n/**\n * Process items in batches with rate limiting and automatic retries.\n *\n * @param items - Array of items to process\n * @param processor - Async function to process each item (write your LLM logic here)\n * @param options - Concurrency and retry settings\n * @returns Promise resolving to array of results in the same order as input\n *\n * @example\n * // Process CSV artwork data with custom categorization\n * const categorized = await batchProcess(\n *   csvRows,\n *   async (row) => {\n *     const response = await openai.chat.completions.create({\n *       model: \"gpt-5.1\", // the newest OpenAI model\n *       messages: [{ role: \"user\", content: `Categorize artwork: ${row.name}` }],\n *       response_format: { type: \"json_object\" },\n *     });\n *     return { ...row, category: JSON.parse(response.choices[0]?.message?.content || \"{}\") };\n *   }\n * );\n */\nexport async function batchProcess<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  options: BatchOptions = {}\n): Promise<R[]> {\n  const {\n    concurrency = 2,\n    retries = 7,\n    minTimeout = 2000,\n    maxTimeout = 128000,\n    onProgress,\n  } = options;\n\n  const limit = pLimit(concurrency);\n  let completed = 0;\n\n  const promises = items.map((item, index) =>\n    limit(() =>\n      pRetry(\n        async () => {\n          try {\n            const result = await processor(item, index);\n            completed++;\n            onProgress?.(completed, items.length, item);\n            return result;\n          } catch (error: unknown) {\n            if (isRateLimitError(error)) {\n              throw error; // Rethrow to trigger p-retry\n            }\n            // For non-rate-limit errors, abort immediately\n            throw new pRetry.AbortError(\n              error instanceof Error ? error : new Error(String(error))\n            );\n          }\n        },\n        { retries, minTimeout, maxTimeout, factor: 2 }\n      )\n    )\n  );\n\n  return Promise.all(promises);\n}\n\n/**\n * Process items sequentially with SSE progress streaming.\n * Use this when you need real-time progress updates to the client.\n *\n * @param items - Array of items to process\n * @param processor - Async function to process each item\n * @param sendEvent - Function to send SSE events to the client\n * @param options - Retry settings (concurrency is always 1 for sequential)\n */\nexport async function batchProcessWithSSE<T, R>(\n  items: T[],\n  processor: (item: T, index: number) => Promise<R>,\n  sendEvent: (event: { type: string; [key: string]: unknown }) => void,\n  options: Omit<BatchOptions, \"concurrency\" | \"onProgress\"> = {}\n): Promise<R[]> {\n  const { retries = 5, minTimeout = 1000, maxTimeout = 15000 } = options;\n\n  sendEvent({ type: \"started\", total: items.length });\n\n  const results: R[] = [];\n  let errors = 0;\n\n  for (let index = 0; index < items.length; index++) {\n    const item = items[index];\n    sendEvent({ type: \"processing\", index, item });\n\n    try {\n      const result = await pRetry(\n        () => processor(item, index),\n        {\n          retries,\n          minTimeout,\n          maxTimeout,\n          factor: 2,\n          onFailedAttempt: (error) => {\n            if (!isRateLimitError(error)) {\n              throw new pRetry.AbortError(\n                error instanceof Error ? error : new Error(String(error))\n              );\n            }\n          },\n        }\n      );\n      results.push(result);\n      sendEvent({ type: \"progress\", index, result });\n    } catch (error) {\n      errors++;\n      results.push(undefined as R); // Placeholder for failed items\n      sendEvent({\n        type: \"progress\",\n        index,\n        error: error instanceof Error ? error.message : \"Processing failed\",\n      });\n    }\n  }\n\n  sendEvent({ type: \"complete\", processed: items.length, errors });\n  return results;\n}\n\n","path":null,"size_bytes":5593,"size_tokens":null},"server/replit_integrations/chat/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport OpenAI from \"openai\";\nimport { chatStorage } from \"./storage\";\nimport { isAuthenticated } from \"../auth\";\n\nlet openai: OpenAI | null = null;\n\nfunction getOpenAI(): OpenAI {\n  if (!openai) {\n    openai = new OpenAI({\n      apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || 'dummy-key',\n      baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n    });\n  }\n  return openai;\n}\n\nexport function registerChatRoutes(app: Express): void {\n  app.get(\"/api/conversations\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const conversations = await chatStorage.getAllConversations();\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversations\" });\n    }\n  });\n\n  app.get(\"/api/conversations/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { id: idParam } = req.params;\n      const id = parseInt(Array.isArray(idParam) ? idParam[0] : idParam);\n      const conversation = await chatStorage.getConversation(id);\n      if (!conversation) {\n        return res.status(404).json({ error: \"Conversation not found\" });\n      }\n      const messages = await chatStorage.getMessagesByConversation(id);\n      res.json({ ...conversation, messages });\n    } catch (error) {\n      console.error(\"Error fetching conversation:\", error);\n      res.status(500).json({ error: \"Failed to fetch conversation\" });\n    }\n  });\n\n  app.post(\"/api/conversations\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { title } = req.body;\n      const conversation = await chatStorage.createConversation(title || \"New Chat\");\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Error creating conversation:\", error);\n      res.status(500).json({ error: \"Failed to create conversation\" });\n    }\n  });\n\n  app.delete(\"/api/conversations/:id\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { id: idParam } = req.params;\n      const id = parseInt(Array.isArray(idParam) ? idParam[0] : idParam);\n      await chatStorage.deleteConversation(id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting conversation:\", error);\n      res.status(500).json({ error: \"Failed to delete conversation\" });\n    }\n  });\n\n  app.post(\"/api/conversations/:id/messages\", isAuthenticated, async (req: Request, res: Response) => {\n    try {\n      const { id: idParam } = req.params;\n      const conversationId = parseInt(Array.isArray(idParam) ? idParam[0] : idParam);\n      const { content } = req.body;\n\n      // Save user message\n      await chatStorage.createMessage(conversationId, \"user\", content);\n\n      // Get conversation history for context\n      const messages = await chatStorage.getMessagesByConversation(conversationId);\n      const chatMessages = messages.map((m) => ({\n        role: m.role as \"user\" | \"assistant\",\n        content: m.content,\n      }));\n\n      // Set up SSE\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      // Stream response from OpenAI\n      const stream = await getOpenAI().chat.completions.create({\n        model: \"gpt-5.1\",\n        messages: [\n          { role: \"system\", content: \"You are a professional gold market analyst. Provide concise, actionable insights for XAUUSD traders. Use bullet points.\" },\n          ...chatMessages\n        ],\n        stream: true,\n        max_completion_tokens: 2048,\n      });\n\n      let fullResponse = \"\";\n\n      for await (const chunk of stream) {\n        const content = chunk.choices[0]?.delta?.content || \"\";\n        if (content) {\n          fullResponse += content;\n          res.write(`data: ${JSON.stringify({ content })}\\n\\n`);\n        }\n      }\n\n      // Save assistant message\n      await chatStorage.createMessage(conversationId, \"assistant\", fullResponse);\n\n      res.write(`data: ${JSON.stringify({ done: true })}\\n\\n`);\n      res.end();\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      // Check if headers already sent (SSE streaming started)\n      if (res.headersSent) {\n        res.write(`data: ${JSON.stringify({ error: \"Failed to send message\" })}\\n\\n`);\n        res.end();\n      } else {\n        res.status(500).json({ error: \"Failed to send message\" });\n      }\n    }\n  });\n}\n\n","path":null,"size_bytes":4543,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport type { Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { api } from \"@shared/routes\";\nimport { z } from \"zod\";\nimport { analyzeMarket } from \"./prediction\";\nimport { fetchLiveXAUUSD } from \"./livePrice\";\n\nimport { registerChatRoutes } from \"./replit_integrations/chat\";\nimport { setupAuth, registerAuthRoutes, isAuthenticated, authStorage } from \"./replit_integrations/auth\";\nimport { registerSubscriptionRoutes } from \"./subscriptionRoutes\";\n\n// Prediction limits per subscription plan\nconst PLAN_PREDICTION_LIMITS: Record<string, number> = {\n  free: 0,\n  basic: 3,\n  pro: 10,\n  premium: Infinity,\n};\n\n// Developer email with permanent free access\nconst DEV_EMAIL = \"furlan27.mattia@gmail.com\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Setup authentication (MUST be before other routes)\n  await setupAuth(app);\n  registerAuthRoutes(app);\n\n  // Register AI Chat routes\n  registerChatRoutes(app);\n\n  // Register Subscription routes\n  registerSubscriptionRoutes(app);\n\n  // Live price endpoint\n  app.get(api.livePrice.get.path, async (req, res) => {\n    try {\n      const price = await fetchLiveXAUUSD();\n      res.json(price);\n    } catch (err) {\n      console.error(\"Live price error:\", err);\n      res.status(500).json({ message: \"Failed to fetch live price\" });\n    }\n  });\n\n  // Prediction endpoint with limit enforcement\n  app.post(api.prediction.analyze.path, async (req, res) => {\n    try {\n      const input = api.prediction.analyze.input.parse(req.body);\n      \n      // Check if user is authenticated - REQUIRED for predictions\n      const userId = (req.session as any)?.userId;\n      \n      if (!userId) {\n        return res.status(401).json({ \n          message: 'Authentication required to make predictions. Please log in.',\n          code: 'AUTH_REQUIRED',\n        });\n      }\n      \n      const user = await authStorage.getUser(userId);\n      \n      if (!user) {\n        return res.status(401).json({ \n          message: 'User not found. Please log in again.',\n          code: 'USER_NOT_FOUND',\n        });\n      }\n      \n      let limit = 0;\n      \n      // Developer email bypass - unlimited predictions\n      if (user.email === DEV_EMAIL) {\n        limit = Infinity;\n      } else {\n        const plan = (user as any).subscriptionPlan || 'free';\n        limit = PLAN_PREDICTION_LIMITS[plan] || 0;\n      }\n      \n      // Get today's usage\n      const usedToday = await storage.getDailyPredictionCount(userId);\n      \n      // Check if limit exceeded\n      if (usedToday >= limit) {\n        return res.status(429).json({ \n          message: `Daily prediction limit reached (${limit} per day). Upgrade your plan for more predictions.`,\n          code: 'LIMIT_EXCEEDED',\n          limit,\n          used: usedToday,\n        });\n      }\n      \n      const result = await analyzeMarket(input);\n      \n      // Store prediction with user ID and increment counter\n      await storage.createPrediction({\n        userId: userId,\n        symbol: result.symbol,\n        timeframe: input.timeframe,\n        currentPrice: result.currentPrice,\n        predictedPrice: result.predictedPrice,\n        direction: result.direction,\n        confidence: result.confidence\n      });\n      \n      // Increment user's daily counter\n      await storage.incrementPredictionCount(userId);\n\n      // Include usage info in response\n      res.json({\n        ...result,\n        usage: {\n          used: usedToday + 1,\n          limit: limit === Infinity ? 'unlimited' : limit,\n          remaining: limit === Infinity ? 'unlimited' : Math.max(0, limit - usedToday - 1),\n        },\n      });\n    } catch (err) {\n      console.error(\"Prediction Error:\", err);\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({\n          message: err.errors[0].message,\n          field: err.errors[0].path.join('.'),\n        });\n      }\n      res.status(500).json({ message: (err as Error).message || \"Internal Analysis Error\" });\n    }\n  });\n\n  // Signals endpoints (all require authentication)\n  app.get(api.signals.list.path, isAuthenticated, async (req, res) => {\n    try {\n      const signals = await storage.getSignals(50);\n      const livePrice = await fetchLiveXAUUSD();\n      \n      const signalsWithPnL = signals.map(s => ({\n        ...s,\n        createdAt: s.createdAt?.toISOString() || new Date().toISOString(),\n        pnl: s.type === 'BUY' \n          ? livePrice.price - s.price \n          : s.type === 'SELL' \n            ? s.price - livePrice.price \n            : 0\n      }));\n      \n      res.json(signalsWithPnL);\n    } catch (err) {\n      console.error(\"Signals list error:\", err);\n      res.status(500).json({ message: \"Failed to fetch signals\" });\n    }\n  });\n\n  app.post(api.signals.generate.path, isAuthenticated, async (req, res) => {\n    try {\n      const input = api.signals.generate.input.parse(req.body);\n      const prediction = await analyzeMarket({ symbol: 'XAUUSD', timeframe: input.timeframe });\n      \n      const targetMultiplier = prediction.direction === 'UP' ? 1.005 : 0.995;\n      const stopMultiplier = prediction.direction === 'UP' ? 0.997 : 1.003;\n      \n      const signal = await storage.createSignal({\n        symbol: 'XAUUSD',\n        timeframe: input.timeframe,\n        type: prediction.signal,\n        price: prediction.currentPrice,\n        targetPrice: prediction.currentPrice * targetMultiplier,\n        stopLoss: prediction.currentPrice * stopMultiplier,\n        confidence: prediction.confidence,\n        status: 'ACTIVE'\n      });\n      \n      res.json({\n        ...signal,\n        createdAt: signal.createdAt?.toISOString() || new Date().toISOString(),\n      });\n    } catch (err) {\n      console.error(\"Signal generation error:\", err);\n      res.status(500).json({ message: \"Failed to generate signal\" });\n    }\n  });\n\n  app.delete('/api/signals/:id', isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id, 10);\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid signal ID\" });\n      }\n      const deleted = await storage.deleteSignal(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Signal not found\" });\n      }\n      res.json({ success: true });\n    } catch (err) {\n      console.error(\"Signal delete error:\", err);\n      res.status(500).json({ message: \"Failed to delete signal\" });\n    }\n  });\n\n  // Prediction usage endpoint - get user's daily prediction count\n  app.get('/api/predictions/usage', async (req, res) => {\n    try {\n      const userId = (req.session as any)?.userId;\n      \n      if (!userId) {\n        return res.status(401).json({ message: 'Authentication required' });\n      }\n      \n      const user = await authStorage.getUser(userId);\n      if (!user) {\n        return res.status(401).json({ message: 'User not found' });\n      }\n      \n      // Developer email bypass\n      let limit = 0;\n      if (user.email === DEV_EMAIL) {\n        limit = Infinity;\n      } else {\n        const plan = (user as any).subscriptionPlan || 'free';\n        limit = PLAN_PREDICTION_LIMITS[plan] || 0;\n      }\n      \n      const usedToday = await storage.getDailyPredictionCount(userId);\n      \n      res.json({\n        used: usedToday,\n        limit: limit === Infinity ? 'unlimited' : limit,\n        remaining: limit === Infinity ? 'unlimited' : Math.max(0, limit - usedToday),\n        plan: (user as any).subscriptionPlan || 'free',\n      });\n    } catch (err) {\n      console.error(\"Usage check error:\", err);\n      res.status(500).json({ message: \"Failed to get usage\" });\n    }\n  });\n\n  // Settings endpoints\n  app.get(api.settings.get.path, (req, res) => {\n    res.json(storage.getSettings());\n  });\n\n  app.put(api.settings.update.path, isAuthenticated, (req, res) => {\n    try {\n      const input = api.settings.update.input.parse(req.body);\n      const updated = storage.updateSettings(input);\n      res.json(updated);\n    } catch (err) {\n      console.error(\"Settings update error:\", err);\n      if (err instanceof z.ZodError) {\n        return res.status(400).json({ message: err.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to update settings\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":8294,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/replit_integrations/audio/useVoiceRecorder.ts":{"content":"/**\n * React hook for voice recording using MediaRecorder API.\n * Records audio in WebM/Opus format for efficient streaming.\n */\nimport { useRef, useCallback, useState } from \"react\";\n\nexport type RecordingState = \"idle\" | \"recording\" | \"stopped\";\n\nexport function useVoiceRecorder() {\n  const [state, setState] = useState<RecordingState>(\"idle\");\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const chunksRef = useRef<Blob[]>([]);\n\n  const startRecording = useCallback(async (): Promise<void> => {\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    const recorder = new MediaRecorder(stream, {\n      mimeType: \"audio/webm;codecs=opus\",\n    });\n\n    mediaRecorderRef.current = recorder;\n    chunksRef.current = [];\n\n    recorder.ondataavailable = (e) => {\n      if (e.data.size > 0) chunksRef.current.push(e.data);\n    };\n\n    recorder.start(100); // Collect chunks every 100ms\n    setState(\"recording\");\n  }, []);\n\n  const stopRecording = useCallback((): Promise<Blob> => {\n    return new Promise((resolve) => {\n      const recorder = mediaRecorderRef.current;\n      if (!recorder || recorder.state !== \"recording\") {\n        resolve(new Blob());\n        return;\n      }\n\n      recorder.onstop = () => {\n        const blob = new Blob(chunksRef.current, { type: \"audio/webm\" });\n        recorder.stream.getTracks().forEach((t) => t.stop());\n        setState(\"stopped\");\n        resolve(blob);\n      };\n\n      recorder.stop();\n    });\n  }, []);\n\n  return { state, startRecording, stopRecording };\n}\n\n","path":null,"size_bytes":1550,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/Analysis.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { DashboardLayout } from \"@/components/DashboardLayout\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Timeframe, PredictionResponse, LivePrice } from \"@shared/schema\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  TrendingUp, \n  TrendingDown, \n  Activity, \n  BarChart3, \n  RefreshCw,\n  Gauge,\n  LineChart,\n  Zap\n} from \"lucide-react\";\n\nexport default function Analysis() {\n  const [timeframe, setTimeframe] = useState<Timeframe>(\"1h\");\n  \n  const { data: livePrice, refetch: refetchPrice } = useQuery<LivePrice>({\n    queryKey: ['/api/live-price'],\n    refetchInterval: 10000,\n  });\n\n  const { mutate, isPending, data } = useMutation({\n    mutationFn: async (tf: Timeframe) => {\n      const res = await apiRequest('POST', '/api/predict', { symbol: 'XAUUSD', timeframe: tf });\n      return res.json() as Promise<PredictionResponse>;\n    }\n  });\n\n  useEffect(() => {\n    mutate(timeframe);\n  }, []);\n\n  const handleAnalyze = () => {\n    mutate(timeframe);\n  };\n\n  const getRSIStatus = (rsi: number | undefined) => {\n    if (!rsi) return { label: 'N/A', color: 'bg-muted' };\n    if (rsi > 70) return { label: 'Overbought', color: 'bg-rose-500' };\n    if (rsi < 30) return { label: 'Oversold', color: 'bg-emerald-500' };\n    return { label: 'Neutral', color: 'bg-yellow-500' };\n  };\n\n  const getMACDStatus = (histogram: number | undefined) => {\n    if (histogram === undefined) return { label: 'N/A', color: 'bg-muted' };\n    if (histogram > 0) return { label: 'Bullish', color: 'bg-emerald-500' };\n    return { label: 'Bearish', color: 'bg-rose-500' };\n  };\n\n  const rsiStatus = getRSIStatus(data?.analysis.rsi);\n  const macdStatus = getMACDStatus(data?.analysis.macd?.histogram);\n\n  return (\n    <DashboardLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-3xl font-display font-bold text-foreground mb-1\">Market Analysis</h2>\n            <div className=\"text-muted-foreground flex items-center gap-2\">\n              <span>Deep Technical Analysis for XAUUSD</span>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <Select \n              value={timeframe} \n              onValueChange={(val) => setTimeframe(val as Timeframe)}\n              disabled={isPending}\n            >\n              <SelectTrigger className=\"w-[120px] bg-card border-border text-foreground h-10 rounded-xl\" data-testid=\"select-timeframe\">\n                <SelectValue placeholder=\"Timeframe\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"1m\">1 Minute</SelectItem>\n                <SelectItem value=\"5m\">5 Minutes</SelectItem>\n                <SelectItem value=\"15m\">15 Minutes</SelectItem>\n                <SelectItem value=\"30m\">30 Minutes</SelectItem>\n                <SelectItem value=\"1h\">1 Hour</SelectItem>\n                <SelectItem value=\"4h\">4 Hours</SelectItem>\n                <SelectItem value=\"1d\">1 Day</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Button onClick={handleAnalyze} disabled={isPending} data-testid=\"button-analyze\">\n              {isPending ? <RefreshCw className=\"w-4 h-4 animate-spin mr-2\" /> : <BarChart3 className=\"w-4 h-4 mr-2\" />}\n              Run Analysis\n            </Button>\n          </div>\n        </div>\n\n        {/* Live Price Banner */}\n        <Card className=\"bg-gradient-to-r from-primary/10 to-primary/5 border-primary/20\">\n          <CardContent className=\"py-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center\">\n                  <Activity className=\"w-6 h-6 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Live XAUUSD Price</p>\n                  <p className=\"text-3xl font-bold font-mono text-foreground\">\n                    ${livePrice?.price.toFixed(2) || '----.--'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className={`text-lg font-bold ${(livePrice?.change || 0) >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>\n                  {(livePrice?.change || 0) >= 0 ? '+' : ''}{livePrice?.change.toFixed(2) || '0.00'}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Bid: ${livePrice?.bid.toFixed(2) || '---'} | Ask: ${livePrice?.ask.toFixed(2) || '---'}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Technical Indicators Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {/* RSI Card */}\n          <Card className=\"border-white/5\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Gauge className=\"w-4 h-4\" />\n                RSI (14)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-end justify-between\">\n                  <span className=\"text-3xl font-bold font-mono\">\n                    {data?.analysis.rsi?.toFixed(1) || '--'}\n                  </span>\n                  <Badge className={rsiStatus.color}>{rsiStatus.label}</Badge>\n                </div>\n                <Progress value={data?.analysis.rsi || 50} className=\"h-2\" />\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                  <span>Oversold (30)</span>\n                  <span>Overbought (70)</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* MACD Card */}\n          <Card className=\"border-white/5\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <LineChart className=\"w-4 h-4\" />\n                MACD\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-end justify-between\">\n                  <span className={`text-3xl font-bold font-mono ${(data?.analysis.macd?.histogram || 0) >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>\n                    {data?.analysis.macd?.histogram.toFixed(3) || '--'}\n                  </span>\n                  <Badge className={macdStatus.color}>{macdStatus.label}</Badge>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                  <div className=\"p-2 rounded bg-white/5\">\n                    <span className=\"text-muted-foreground text-xs\">Signal</span>\n                    <p className=\"font-mono\">{data?.analysis.macd?.signal.toFixed(3) || '--'}</p>\n                  </div>\n                  <div className=\"p-2 rounded bg-white/5\">\n                    <span className=\"text-muted-foreground text-xs\">MACD Line</span>\n                    <p className=\"font-mono\">{data?.analysis.macd?.macd.toFixed(3) || '--'}</p>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* SMA Card */}\n          <Card className=\"border-white/5\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4\" />\n                SMA (20)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <span className=\"text-3xl font-bold font-mono\">\n                  ${data?.analysis.sma?.toFixed(2) || '----.--'}\n                </span>\n                <div className={`flex items-center gap-2 text-sm ${\n                  (data?.currentPrice || 0) > (data?.analysis.sma || 0) ? 'text-emerald-400' : 'text-rose-400'\n                }`}>\n                  {(data?.currentPrice || 0) > (data?.analysis.sma || 0) ? (\n                    <>\n                      <TrendingUp className=\"w-4 h-4\" />\n                      <span>Price above SMA (Bullish)</span>\n                    </>\n                  ) : (\n                    <>\n                      <TrendingDown className=\"w-4 h-4\" />\n                      <span>Price below SMA (Bearish)</span>\n                    </>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Prediction Card */}\n          <Card className=\"border-white/5 border-l-4 border-l-primary\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Zap className=\"w-4 h-4 text-primary\" />\n                AI Prediction\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-end justify-between\">\n                  <span className=\"text-3xl font-bold font-mono\">\n                    ${data?.predictedPrice.toFixed(2) || '----.--'}\n                  </span>\n                  <Badge variant={data?.signal === 'BUY' ? 'default' : data?.signal === 'SELL' ? 'destructive' : 'secondary'}>\n                    {data?.signal || 'HOLD'}\n                  </Badge>\n                </div>\n                <div className={`text-sm ${data?.direction === 'UP' ? 'text-emerald-400' : 'text-rose-400'}`}>\n                  {data?.direction === 'UP' ? '+' : ''}{data?.changePercent.toFixed(3)}% expected\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Additional Technical Indicators */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {/* EMA Card */}\n          <Card className=\"border-white/5\" data-testid=\"card-ema\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <TrendingUp className=\"w-4 h-4 text-blue-400\" />\n                EMA (20)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <span className=\"text-3xl font-bold font-mono\">\n                  ${data?.analysis.ema?.toFixed(2) || '----.--'}\n                </span>\n                <div className={`flex items-center gap-2 text-sm ${\n                  (data?.currentPrice || 0) > (data?.analysis.ema || 0) ? 'text-emerald-400' : 'text-rose-400'\n                }`}>\n                  {(data?.currentPrice || 0) > (data?.analysis.ema || 0) ? (\n                    <>\n                      <TrendingUp className=\"w-4 h-4\" />\n                      <span>Price above EMA (Bullish)</span>\n                    </>\n                  ) : (\n                    <>\n                      <TrendingDown className=\"w-4 h-4\" />\n                      <span>Price below EMA (Bearish)</span>\n                    </>\n                  )}\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Faster than SMA, more responsive to recent price changes\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Bollinger Bands Card */}\n          <Card className=\"border-white/5\" data-testid=\"card-bollinger\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Activity className=\"w-4 h-4 text-purple-400\" />\n                Bollinger Bands\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"grid grid-cols-3 gap-2 text-center\">\n                  <div>\n                    <span className=\"text-xs text-muted-foreground block\">Upper</span>\n                    <span className=\"text-sm font-mono font-bold text-rose-400\">\n                      ${data?.analysis.bollingerBands?.upper.toFixed(2) || '--'}\n                    </span>\n                  </div>\n                  <div>\n                    <span className=\"text-xs text-muted-foreground block\">Middle</span>\n                    <span className=\"text-sm font-mono font-bold\">\n                      ${data?.analysis.bollingerBands?.middle.toFixed(2) || '--'}\n                    </span>\n                  </div>\n                  <div>\n                    <span className=\"text-xs text-muted-foreground block\">Lower</span>\n                    <span className=\"text-sm font-mono font-bold text-emerald-400\">\n                      ${data?.analysis.bollingerBands?.lower.toFixed(2) || '--'}\n                    </span>\n                  </div>\n                </div>\n                {data?.analysis.bollingerBands && data?.currentPrice && (\n                  <div className={`flex items-center gap-2 text-sm ${\n                    data.currentPrice > data.analysis.bollingerBands.upper ? 'text-rose-400' :\n                    data.currentPrice < data.analysis.bollingerBands.lower ? 'text-emerald-400' : 'text-yellow-400'\n                  }`}>\n                    {data.currentPrice > data.analysis.bollingerBands.upper ? (\n                      <span>Price above upper band (Overbought)</span>\n                    ) : data.currentPrice < data.analysis.bollingerBands.lower ? (\n                      <span>Price below lower band (Oversold)</span>\n                    ) : (\n                      <span>Price within bands (Normal)</span>\n                    )}\n                  </div>\n                )}\n                <p className=\"text-xs text-muted-foreground\">\n                  20-period SMA with 2 standard deviations\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Stochastic Oscillator Card */}\n          <Card className=\"border-white/5\" data-testid=\"card-stochastic\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                <Gauge className=\"w-4 h-4 text-amber-400\" />\n                Stochastic (14)\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-end justify-between\">\n                  <div>\n                    <span className=\"text-xs text-muted-foreground block\">%K</span>\n                    <span className=\"text-2xl font-bold font-mono\">\n                      {data?.analysis.stochastic?.k.toFixed(1) || '--'}\n                    </span>\n                  </div>\n                  <div className=\"text-right\">\n                    <span className=\"text-xs text-muted-foreground block\">%D</span>\n                    <span className=\"text-2xl font-bold font-mono text-muted-foreground\">\n                      {data?.analysis.stochastic?.d.toFixed(1) || '--'}\n                    </span>\n                  </div>\n                  <Badge className={\n                    (data?.analysis.stochastic?.k || 50) > 80 ? 'bg-rose-500' :\n                    (data?.analysis.stochastic?.k || 50) < 20 ? 'bg-emerald-500' : 'bg-yellow-500'\n                  }>\n                    {(data?.analysis.stochastic?.k || 50) > 80 ? 'Overbought' :\n                     (data?.analysis.stochastic?.k || 50) < 20 ? 'Oversold' : 'Neutral'}\n                  </Badge>\n                </div>\n                <Progress value={data?.analysis.stochastic?.k || 50} className=\"h-2\" />\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                  <span>Oversold (20)</span>\n                  <span>Overbought (80)</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Market Summary */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card className=\"border-white/5\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"w-5 h-5 text-primary\" />\n                Market Summary\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"p-4 rounded-lg bg-white/5\">\n                  <p className=\"text-sm text-muted-foreground\">Daily High</p>\n                  <p className=\"text-xl font-bold font-mono text-emerald-400\">\n                    ${livePrice?.high.toFixed(2) || '----.--'}\n                  </p>\n                </div>\n                <div className=\"p-4 rounded-lg bg-white/5\">\n                  <p className=\"text-sm text-muted-foreground\">Daily Low</p>\n                  <p className=\"text-xl font-bold font-mono text-rose-400\">\n                    ${livePrice?.low.toFixed(2) || '----.--'}\n                  </p>\n                </div>\n              </div>\n              <div className=\"p-4 rounded-lg bg-white/5\">\n                <p className=\"text-sm text-muted-foreground mb-2\">Daily Range</p>\n                <div className=\"relative h-3 bg-white/10 rounded-full overflow-hidden\">\n                  <div \n                    className=\"absolute h-full bg-gradient-to-r from-rose-500 via-yellow-500 to-emerald-500\"\n                    style={{ width: '100%' }}\n                  />\n                  <div \n                    className=\"absolute w-3 h-3 bg-white rounded-full border-2 border-primary shadow-lg\"\n                    style={{ \n                      left: `${((livePrice?.price || 0) - (livePrice?.low || 0)) / ((livePrice?.high || 1) - (livePrice?.low || 1)) * 100}%`,\n                      transform: 'translateX(-50%)'\n                    }}\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-white/5\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Activity className=\"w-5 h-5 text-primary\" />\n                Confidence Metrics\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Prediction Confidence</span>\n                  <span className=\"font-bold\">{data?.confidence.toFixed(1) || 0}%</span>\n                </div>\n                <Progress value={data?.confidence || 0} className=\"h-3\" />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"p-4 rounded-lg bg-white/5\">\n                  <p className=\"text-xs text-muted-foreground\">RMSE</p>\n                  <p className=\"text-lg font-bold font-mono\">{data?.metrics.rmse.toFixed(4) || '--'}</p>\n                </div>\n                <div className=\"p-4 rounded-lg bg-white/5\">\n                  <p className=\"text-xs text-muted-foreground\">MAE</p>\n                  <p className=\"text-lg font-bold font-mono\">{data?.metrics.mae.toFixed(4) || '--'}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":20118,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/replit_integrations/audio/audio-playback-worklet.js":{"content":"/**\n * Reusable AudioWorklet for streaming PCM16 audio playback.\n * Place in public/ folder and load via audioContext.audioWorklet.addModule()\n */\nclass RingBuffer {\n  constructor(initialCapacity) {\n    this.capacity = initialCapacity;\n    this.buffer = new Float32Array(initialCapacity);\n    this.readIndex = 0;\n    this.writeIndex = 0;\n    this.availableData = 0;\n  }\n\n  push(data) {\n    const len = data.length;\n    // Auto-grow if needed\n    while (this.availableData + len > this.capacity) {\n      this.grow();\n    }\n    for (let i = 0; i < len; i++) {\n      this.buffer[this.writeIndex] = data[i];\n      this.writeIndex = (this.writeIndex + 1) % this.capacity;\n      this.availableData++;\n    }\n  }\n\n  grow() {\n    const newCapacity = this.capacity * 2;\n    const newBuffer = new Float32Array(newCapacity);\n    // Copy existing data maintaining order\n    for (let i = 0; i < this.availableData; i++) {\n      const srcIndex = (this.readIndex + i) % this.capacity;\n      newBuffer[i] = this.buffer[srcIndex];\n    }\n    this.buffer = newBuffer;\n    this.readIndex = 0;\n    this.writeIndex = this.availableData;\n    this.capacity = newCapacity;\n  }\n\n  pull(outputBuffer) {\n    const len = outputBuffer.length;\n    const available = Math.min(len, this.availableData);\n    for (let i = 0; i < available; i++) {\n      outputBuffer[i] = this.buffer[this.readIndex];\n      this.readIndex = (this.readIndex + 1) % this.capacity;\n    }\n    // Pad remaining with silence\n    for (let i = available; i < len; i++) {\n      outputBuffer[i] = 0;\n    }\n    this.availableData -= available;\n    return available > 0;\n  }\n\n  available() {\n    return this.availableData;\n  }\n\n  clear() {\n    this.readIndex = 0;\n    this.writeIndex = 0;\n    this.availableData = 0;\n  }\n}\n\nclass AudioPlaybackProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.ringBuffer = new RingBuffer(24000 * 30); // 30s initial capacity\n    this.isPlaying = false;\n    this.streamComplete = false;\n\n    this.port.onmessage = (event) => {\n      const { type, samples } = event.data;\n      if (type === \"audio\") {\n        this.ringBuffer.push(samples);\n        this.isPlaying = true;\n      } else if (type === \"clear\") {\n        this.ringBuffer.clear();\n        this.isPlaying = false;\n        this.streamComplete = false;\n      } else if (type === \"streamComplete\") {\n        this.streamComplete = true;\n      } else if (type === \"stop\") {\n        this.isPlaying = false;\n        this.streamComplete = false;\n      }\n    };\n  }\n\n  process(inputs, outputs) {\n    const output = outputs[0];\n    if (!output || output.length === 0) return true;\n\n    const channel = output[0];\n    if (this.isPlaying) {\n      this.ringBuffer.pull(channel);\n      if (this.streamComplete && this.ringBuffer.available() === 0) {\n        this.isPlaying = false;\n        this.streamComplete = false;\n        this.port.postMessage({ type: \"ended\" });\n      }\n    } else {\n      channel.fill(0);\n    }\n    return true;\n  }\n}\n\nregisterProcessor(\"audio-playback-processor\", AudioPlaybackProcessor);\n\n","path":null,"size_bytes":3058,"size_tokens":null},"client/src/components/DashboardLayout.tsx":{"content":"import { ReactNode, useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { \n  LayoutDashboard, \n  LineChart, \n  Activity, \n  Settings, \n  Bell,\n  X,\n  Send,\n  Loader2,\n  User,\n  LogOut,\n  LogIn,\n  CreditCard,\n  Pencil\n} from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useSubscription, useCustomerPortal } from \"@/hooks/use-subscription\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface DashboardLayoutProps {\n  children: ReactNode;\n}\n\nfunction NotificationPopup({ onClose }: { onClose: () => void }) {\n  const [message, setMessage] = useState(\"\");\n  const [chatId, setChatId] = useState<number | null>(null);\n\n  // Initialize conversation\n  const { data: conversation } = useQuery({\n    queryKey: [\"/api/conversations\"],\n    select: (data: any[]) => data[0],\n  });\n\n  const { data: messages = [], refetch: refetchMessages } = useQuery({\n    queryKey: [\"/api/conversations\", chatId, \"messages\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/conversations/${chatId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      const data = await res.json();\n      return data.messages || [];\n    },\n    enabled: !!chatId,\n    refetchInterval: (query: any) => {\n      const data = query?.state?.data;\n      // Force polling if messages are empty or the last message is from user\n      if (!data || data.length === 0) return 2000;\n      const lastMsg = data[data.length - 1];\n      return lastMsg?.role === 'user' ? 2000 : false;\n    }\n  });\n\n  const createConv = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/conversations\", { title: \"Gold Market Analysis\" });\n      return res.json();\n    },\n    onSuccess: (data) => setChatId(data.id),\n  });\n\n  const sendMessage = useMutation({\n    mutationFn: async (content: string) => {\n      const res = await apiRequest(\"POST\", `/api/conversations/${chatId}/messages`, { content });\n      return res.json();\n    }\n  });\n\n  useEffect(() => {\n    if (conversation) {\n      setChatId(conversation.id);\n    } else {\n      createConv.mutate();\n    }\n  }, [conversation]);\n\n  // Auto-send first message for market updates\n  useEffect(() => {\n    if (chatId && messages.length === 0 && !sendMessage.isPending && !sendMessage.isSuccess) {\n      sendMessage.mutate(\"Give me a short update and suggestions about the current gold market (XAUUSD).\");\n    }\n  }, [chatId, messages.length, sendMessage.isPending, sendMessage.isSuccess]);\n\n  return (\n    <div className=\"absolute top-16 right-6 w-80 bg-card rounded-2xl overflow-hidden z-50 border border-border shadow-2xl animate-in fade-in slide-in-from-top-2\">\n      <div className=\"p-4 border-b border-border flex items-center justify-between bg-primary/5\">\n        <h4 className=\"text-sm font-bold text-primary flex items-center gap-2\">\n          <Bell className=\"w-4 h-4\" />\n          Market AI Updates\n        </h4>\n        <button onClick={onClose} className=\"text-muted-foreground hover:text-foreground transition-colors\">\n          <X className=\"w-4 h-4\" />\n        </button>\n      </div>\n      <div className=\"p-4 max-h-96 overflow-y-auto space-y-4\">\n        {messages.length === 0 || sendMessage.isPending ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-muted-foreground italic text-sm\">\n            <div className=\"relative mb-4\">\n              <Loader2 className=\"w-10 h-10 animate-spin text-primary/60\" />\n              <div className=\"absolute inset-0 bg-primary/20 blur-xl rounded-full\" />\n            </div>\n            <span className=\"animate-pulse tracking-widest uppercase text-[10px] font-bold\">Synthesizing Alpha...</span>\n          </div>\n        ) : (\n          messages.filter((m: any) => m.role === 'assistant').map((m: any, i: number) => {\n            // Clean the content by removing markdown symbols if present for a cleaner look\n            const cleanContent = m.content.replace(/[\\*\\#\\`]/g, '');\n            return (\n              <div key={i} className=\"group relative\">\n                <div className=\"absolute -left-2 top-0 bottom-0 w-1 bg-primary/30 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\" />\n                <div className=\"text-xs leading-relaxed text-foreground bg-muted/50 p-4 rounded-xl border border-border hover:bg-muted/70 transition-colors shadow-sm\">\n                  {cleanContent}\n                </div>\n              </div>\n            );\n          })\n        )}\n      </div>\n      <div className=\"p-3 bg-muted/30 text-[10px] text-center text-muted-foreground border-t border-border\">\n        AI-generated suggestions. Trade at your own risk.\n      </div>\n    </div>\n  );\n}\n\nfunction AuthRequiredScreen() {\n  const [isRegister, setIsRegister] = useState(false);\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const { login, register, isLoggingIn, isRegistering } = useAuth();\n\n  const isLoading = isLoggingIn || isRegistering;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    \n    try {\n      if (isRegister) {\n        await register({ email, password });\n      } else {\n        await login({ email, password });\n      }\n    } catch (err: any) {\n      const message = err?.message || \"Something went wrong. Please try again.\";\n      setError(message);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"text-center mb-8\">\n          <div className=\"w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 mb-4\">\n            <LineChart className=\"w-10 h-10 text-primary-foreground\" />\n          </div>\n          <h1 className=\"text-3xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight mb-2\">\n            Gold Predict Pro\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Real-time XAUUSD market analysis and AI-powered predictions\n          </p>\n        </div>\n        \n        <div className=\"bg-card border border-border rounded-xl p-6 shadow-lg\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <User className=\"w-6 h-6 text-primary\" />\n            <h2 className=\"text-xl font-semibold text-foreground\">\n              {isRegister ? \"Create Account\" : \"Sign In\"}\n            </h2>\n          </div>\n          <p className=\"text-muted-foreground mb-6\">\n            {isRegister \n              ? \"Create an account to access live market data and AI-powered analysis.\"\n              : \"Sign in to access live market data, trading signals, and AI-powered notifications.\"}\n          </p>\n          \n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {error && (\n              <div className=\"p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-sm text-destructive\" data-testid=\"text-auth-error\">\n                {error}\n              </div>\n            )}\n            \n            <div className=\"space-y-2\">\n              <label htmlFor=\"email\" className=\"text-sm font-medium text-foreground\">\n                Email\n              </label>\n              <input\n                id=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"you@example.com\"\n                required\n                disabled={isLoading}\n                className=\"w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary disabled:opacity-50\"\n                data-testid=\"input-email\"\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <label htmlFor=\"password\" className=\"text-sm font-medium text-foreground\">\n                Password\n              </label>\n              <input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder={isRegister ? \"Choose a password (min. 6 characters)\" : \"Enter your password\"}\n                required\n                minLength={isRegister ? 6 : 1}\n                disabled={isLoading}\n                className=\"w-full px-4 py-3 rounded-lg border border-border bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary disabled:opacity-50\"\n                data-testid=\"input-password\"\n              />\n            </div>\n            \n            <Button type=\"submit\" size=\"lg\" className=\"w-full\" disabled={isLoading} data-testid=\"button-confirm\">\n              {isLoading ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                  {isRegister ? \"Creating Account...\" : \"Signing In...\"}\n                </>\n              ) : (\n                <>\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                  Confirm\n                </>\n              )}\n            </Button>\n          </form>\n          \n          <div className=\"mt-4 text-center\">\n            <button\n              type=\"button\"\n              onClick={() => { setIsRegister(!isRegister); setError(null); }}\n              className=\"text-sm text-primary hover:underline\"\n              disabled={isLoading}\n              data-testid=\"button-toggle-auth-mode\"\n            >\n              {isRegister ? \"Already have an account? Sign in\" : \"Don't have an account? Sign up\"}\n            </button>\n          </div>\n        </div>\n        \n        <div className=\"mt-8 grid grid-cols-3 gap-4 text-center\">\n          <div className=\"p-3 bg-card/50 rounded-lg border border-border/50\">\n            <div className=\"text-2xl font-bold text-primary\">Live</div>\n            <div className=\"text-xs text-muted-foreground\">Price Data</div>\n          </div>\n          <div className=\"p-3 bg-card/50 rounded-lg border border-border/50\">\n            <div className=\"text-2xl font-bold text-primary\">AI</div>\n            <div className=\"text-xs text-muted-foreground\">Analysis</div>\n          </div>\n          <div className=\"p-3 bg-card/50 rounded-lg border border-border/50\">\n            <div className=\"text-2xl font-bold text-primary\">Pro</div>\n            <div className=\"text-xs text-muted-foreground\">Signals</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction AuthLoadingScreen() {\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center\">\n      <div className=\"flex flex-col items-center gap-4\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        <p className=\"text-muted-foreground\">Loading...</p>\n      </div>\n    </div>\n  );\n}\n\nfunction SubscriptionRequiredScreen() {\n  const [, setLocation] = useLocation();\n  const { logout, isLoggingOut } = useAuth();\n  const { subscription } = useSubscription();\n  const { mutate: openPortal, isPending: isPortalLoading } = useCustomerPortal();\n\n  // Determine the subscription state for appropriate messaging\n  const status = subscription?.status;\n  const expiresAt = subscription?.expiresAt;\n  const hasStripeCustomer = !!subscription?.stripeCustomerId;\n  \n  // Format expiry date if available\n  const expiryDate = expiresAt ? new Date(expiresAt).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  }) : null;\n\n  // Determine which screen to show based on status\n  const isExpired = status === 'canceled' || (status === 'inactive' && hasStripeCustomer);\n  const isPaymentFailed = status === 'past_due';\n  const isNewUser = !hasStripeCustomer;\n\n  // Content based on subscription state\n  let title = \"Subscription Required\";\n  let subtitle = \"You need an active subscription to access the Gold Predict dashboard\";\n  let description = \"Choose a plan to unlock real-time market data, AI predictions, and professional trading signals.\";\n  let primaryButtonText = \"View Subscription Plans\";\n  let showRenewButton = false;\n  let alertType: 'expired' | 'payment' | null = null;\n\n  if (isPaymentFailed) {\n    title = \"Payment Failed\";\n    subtitle = \"We couldn't process your last payment\";\n    description = \"Please update your payment method to continue using Gold Predict. Your access will be restored immediately after successful payment.\";\n    primaryButtonText = \"Update Payment Method\";\n    showRenewButton = true;\n    alertType = 'payment';\n  } else if (isExpired) {\n    title = \"Subscription Expired\";\n    subtitle = expiryDate \n      ? `Your subscription ended on ${expiryDate}`\n      : \"Your subscription has expired\";\n    description = \"Renew your subscription to continue accessing real-time market data, AI predictions, and professional trading signals.\";\n    primaryButtonText = \"Renew Subscription\";\n    showRenewButton = true;\n    alertType = 'expired';\n  }\n\n  const handlePrimaryAction = () => {\n    if (showRenewButton && hasStripeCustomer) {\n      openPortal();\n    } else {\n      setLocation('/');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <div className=\"max-w-md w-full\">\n        <div className=\"text-center mb-8\">\n          <div className={`w-16 h-16 mx-auto rounded-2xl flex items-center justify-center shadow-lg mb-4 ${\n            alertType === 'payment' \n              ? 'bg-gradient-to-br from-red-500 to-red-600 shadow-red-500/30' \n              : alertType === 'expired'\n              ? 'bg-gradient-to-br from-amber-500 to-orange-600 shadow-amber-500/30'\n              : 'bg-gradient-to-br from-primary to-amber-600 shadow-primary/30'\n          }`}>\n            <CreditCard className=\"w-10 h-10 text-white\" />\n          </div>\n          <h1 className=\"text-3xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight mb-2\">\n            {title}\n          </h1>\n          <p className=\"text-muted-foreground\">\n            {subtitle}\n          </p>\n        </div>\n        \n        <div className=\"bg-card border border-border rounded-xl p-6 shadow-lg space-y-4\">\n          {alertType === 'payment' && (\n            <div className=\"p-4 bg-red-500/10 border border-red-500/20 rounded-lg\">\n              <p className=\"text-sm text-red-400 font-medium\">\n                Your payment method was declined. Please update your card to restore access.\n              </p>\n            </div>\n          )}\n          \n          {alertType === 'expired' && (\n            <div className=\"p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg\">\n              <p className=\"text-sm text-amber-400 font-medium\">\n                Don't miss out on market opportunities! Renew now to get back to trading.\n              </p>\n            </div>\n          )}\n          \n          <p className=\"text-sm text-muted-foreground text-center\">\n            {description}\n          </p>\n\n          {/* Features reminder */}\n          <div className=\"grid grid-cols-3 gap-2 py-3\">\n            <div className=\"text-center p-2 bg-muted/30 rounded-lg\">\n              <div className=\"text-lg font-bold text-primary\">Live</div>\n              <div className=\"text-[10px] text-muted-foreground\">Price Data</div>\n            </div>\n            <div className=\"text-center p-2 bg-muted/30 rounded-lg\">\n              <div className=\"text-lg font-bold text-primary\">AI</div>\n              <div className=\"text-[10px] text-muted-foreground\">Predictions</div>\n            </div>\n            <div className=\"text-center p-2 bg-muted/30 rounded-lg\">\n              <div className=\"text-lg font-bold text-primary\">Pro</div>\n              <div className=\"text-[10px] text-muted-foreground\">Signals</div>\n            </div>\n          </div>\n          \n          <Button \n            size=\"lg\" \n            className=\"w-full\" \n            onClick={handlePrimaryAction}\n            disabled={isPortalLoading}\n            data-testid=\"button-renew-subscription\"\n          >\n            {isPortalLoading ? (\n              <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n            ) : (\n              <CreditCard className=\"w-4 h-4 mr-2\" />\n            )}\n            {primaryButtonText}\n          </Button>\n\n          {showRenewButton && (\n            <Button \n              variant=\"outline\" \n              size=\"lg\" \n              className=\"w-full\" \n              onClick={() => setLocation('/')}\n              data-testid=\"button-view-all-plans\"\n            >\n              View All Plans\n            </Button>\n          )}\n          \n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              size=\"lg\" \n              className=\"flex-1\" \n              onClick={() => {\n                logout();\n                setLocation('/login');\n              }}\n              disabled={isLoggingOut}\n              data-testid=\"button-switch-account\"\n            >\n              {isLoggingOut ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <LogIn className=\"w-4 h-4 mr-2\" />\n              )}\n              Switch Account\n            </Button>\n            \n            <Button \n              variant=\"ghost\" \n              size=\"lg\" \n              className=\"flex-1 text-muted-foreground\" \n              onClick={() => logout()}\n              disabled={isLoggingOut}\n              data-testid=\"button-logout-subscription\"\n            >\n              {isLoggingOut ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <LogOut className=\"w-4 h-4 mr-2\" />\n              )}\n              Sign Out\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction UserProfileButton() {\n  const { user, isLoading, isAuthenticated, logout, isLoggingOut, updateProfile, isUpdatingProfile } = useAuth();\n  const [isEditingNickname, setIsEditingNickname] = useState(false);\n  const [nickname, setNickname] = useState(\"\");\n\n  // Get display name: nickname > firstName lastName > email prefix\n  const displayName = user?.nickname || (user?.firstName ? `${user.firstName} ${user.lastName || ''}`.trim() : user?.email?.split('@')[0] || 'User');\n\n  if (isLoading) {\n    return (\n      <div className=\"w-8 h-8 rounded-full bg-muted animate-pulse\" />\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  const handleLogout = () => {\n    logout();\n  };\n\n  const handleEditNickname = () => {\n    setNickname(user?.nickname || user?.email?.split('@')[0] || \"\");\n    setIsEditingNickname(true);\n  };\n\n  const handleSaveNickname = async () => {\n    if (nickname.trim()) {\n      try {\n        await updateProfile({ nickname: nickname.trim() });\n        setIsEditingNickname(false);\n      } catch (error) {\n        console.error(\"Failed to update nickname:\", error);\n      }\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setIsEditingNickname(false);\n    setNickname(\"\");\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <button className=\"w-8 h-8 rounded-full bg-gradient-to-tr from-primary to-amber-600 flex items-center justify-center border border-border focus:outline-none focus:ring-2 focus:ring-primary/50\" data-testid=\"button-user-profile\">\n          {user?.profileImageUrl ? (\n            <img src={user.profileImageUrl} alt=\"Profile\" className=\"w-full h-full rounded-full object-cover\" />\n          ) : (\n            <User className=\"w-4 h-4 text-primary-foreground\" />\n          )}\n        </button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-64\">\n        <div className=\"px-2 py-2\">\n          {isEditingNickname ? (\n            <div className=\"space-y-2\">\n              <Input\n                type=\"text\"\n                value={nickname}\n                onChange={(e) => setNickname(e.target.value)}\n                placeholder=\"Enter nickname\"\n                data-testid=\"input-nickname\"\n                autoFocus\n                className=\"h-8\"\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleSaveNickname();\n                  if (e.key === 'Escape') handleCancelEdit();\n                }}\n              />\n              <div className=\"flex gap-2\">\n                <Button \n                  size=\"sm\"\n                  onClick={handleSaveNickname}\n                  disabled={isUpdatingProfile || !nickname.trim()}\n                  data-testid=\"button-save-nickname\"\n                  className=\"flex-1\"\n                >\n                  {isUpdatingProfile ? \"Saving...\" : \"Save\"}\n                </Button>\n                <Button \n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={handleCancelEdit}\n                  data-testid=\"button-cancel-nickname\"\n                  className=\"flex-1\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <div \n              className=\"cursor-pointer hover-elevate rounded p-1 -m-1 transition-colors group\"\n              onClick={handleEditNickname}\n              data-testid=\"button-edit-nickname\"\n            >\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-sm font-medium text-foreground\">{displayName}</p>\n                <Pencil className=\"w-3 h-3 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity\" />\n              </div>\n              <p className=\"text-xs text-muted-foreground\">{user?.email || 'No email'}</p>\n              <p className=\"text-[10px] text-muted-foreground/60 mt-0.5\">Click to edit nickname</p>\n            </div>\n          )}\n        </div>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem \n          onClick={handleLogout}\n          disabled={isLoggingOut}\n          className=\"cursor-pointer text-destructive focus:text-destructive\"\n          data-testid=\"button-logout\"\n        >\n          {isLoggingOut ? (\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n          ) : (\n            <LogOut className=\"w-4 h-4 mr-2\" />\n          )}\n          Sign Out\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\nexport function DashboardLayout({ children }: DashboardLayoutProps) {\n  const [location] = useLocation();\n  const [showNotifications, setShowNotifications] = useState(false);\n  const { isAuthenticated, isLoading } = useAuth();\n\n  const { isActive, isLoading: subLoading } = useSubscription();\n\n  const navItems = [\n    { icon: LayoutDashboard, label: \"Dashboard\", href: \"/dashboard\" },\n    { icon: LineChart, label: \"Market Analysis\", href: \"/analysis\" },\n    { icon: Activity, label: \"Live Signals\", href: \"/signals\" },\n    { icon: Settings, label: \"Settings\", href: \"/settings\" },\n  ];\n\n  // Show loading screen while checking auth or subscription\n  if (isLoading || subLoading) {\n    return <AuthLoadingScreen />;\n  }\n\n  // Show login screen when not authenticated\n  if (!isAuthenticated) {\n    return <AuthRequiredScreen />;\n  }\n\n  // Show subscription required screen if no active subscription\n  if (!isActive) {\n    return <SubscriptionRequiredScreen />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col md:flex-row font-body\">\n      {/* Sidebar */}\n      <aside className=\"w-full md:w-64 bg-card border-r border-border/40 flex-shrink-0 z-20\">\n        <div className=\"p-6 border-b border-border/40\">\n          <div className=\"flex items-center gap-3 mb-1 group\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 group-hover:scale-105 transition-all duration-300 bloom-gold\">\n              <LineChart className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <div className=\"flex flex-col\">\n              <h1 className=\"text-2xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight\">\n                Gold Predict\n              </h1>\n              <div className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-primary/10 border border-primary/20 w-fit -mt-0.5\">\n                <span className=\"w-1 h-1 rounded-full bg-primary animate-pulse\" />\n                <span className=\"text-[9px] uppercase font-bold tracking-widest text-primary leading-none\">\n                  By Furlan Mattia\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <nav className=\"p-4 space-y-2\">\n          {navItems.map((item) => {\n            const isActive = location === item.href;\n            return (\n              <Link key={item.href} href={item.href} className={`\n                flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 bloom-nav\n                ${isActive \n                  ? \"bg-primary/10 text-primary font-medium shadow-sm border border-primary/20\" \n                  : \"text-muted-foreground hover:text-foreground\"}\n              `}>\n                <item.icon className=\"w-5 h-5\" />\n                <span>{item.label}</span>\n              </Link>\n            );\n          })}\n        </nav>\n\n      </aside>\n\n      {/* Main Content */}\n      <main className=\"flex-1 flex flex-col min-w-0 overflow-hidden relative\">\n        {/* Header */}\n        <header className=\"h-16 border-b border-border/40 bg-background/80 backdrop-blur-sm sticky top-0 z-10 px-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <span className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\n            Market Status: Open\n          </div>\n          \n          <div className=\"flex items-center gap-4 relative\">\n            <button \n              onClick={() => setShowNotifications(!showNotifications)}\n              className={`p-2 transition-all relative rounded-lg bloom-hover ${showNotifications ? 'bg-primary/20 text-primary' : 'text-muted-foreground'}`}\n              data-testid=\"button-notifications\"\n            >\n              <Bell className=\"w-5 h-5\" />\n              {!showNotifications && <span className=\"absolute top-1.5 right-1.5 w-2 h-2 bg-primary rounded-full border-2 border-background\" />}\n            </button>\n            {showNotifications && <NotificationPopup onClose={() => setShowNotifications(false)} />}\n            <UserProfileButton />\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-8\">\n          <div className=\"max-w-7xl mx-auto w-full\">\n            {children}\n          </div>\n        </div>\n        \n        {/* Decorative background effects */}\n        <div className=\"absolute top-0 left-0 w-full h-[500px] bg-primary/5 blur-[100px] pointer-events-none -z-10\" />\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":27617,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useSubscription } from \"@/hooks/use-subscription\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { LineChart, Loader2, LogIn, ArrowLeft, AlertCircle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const params = new URLSearchParams(searchString);\n  const redirectUrl = params.get('redirect') || '/dashboard';\n  \n  const { login, register, isAuthenticated, isLoading: authLoading } = useAuth();\n  const { isActive, isLoading: subLoading } = useSubscription();\n  \n  const [mode, setMode] = useState<'login' | 'register'>('login');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [firstName, setFirstName] = useState('');\n  const [lastName, setLastName] = useState('');\n  const [error, setError] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // If already authenticated and has active subscription, redirect to original destination or dashboard\n  useEffect(() => {\n    if (isAuthenticated && !authLoading && !subLoading && isActive) {\n      setLocation(redirectUrl);\n    }\n  }, [isAuthenticated, authLoading, subLoading, isActive, redirectUrl, setLocation]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsSubmitting(true);\n\n    try {\n      if (mode === 'login') {\n        await login({ email, password });\n      } else {\n        await register({ email, password, firstName, lastName });\n      }\n      // After successful login, redirect to the original destination or dashboard\n      setLocation(redirectUrl);\n    } catch (err: any) {\n      // Parse error message and show user-friendly version\n      let errorMessage = 'Authentication failed. Please try again.';\n      \n      if (err?.message) {\n        let msg = err.message.toLowerCase();\n        \n        // Try to extract JSON message from format like \"401: {\"message\":\"...\"}\"\n        try {\n          const jsonMatch = err.message.match(/\\{.*\\}/);\n          if (jsonMatch) {\n            const parsed = JSON.parse(jsonMatch[0]);\n            if (parsed.message) {\n              msg = parsed.message.toLowerCase();\n            }\n          }\n        } catch {\n          // Use original message if JSON parsing fails\n        }\n        \n        if (msg.includes('too many')) {\n          errorMessage = 'Too many login attempts. Please try again later.';\n        } else if (msg.includes('exists') || msg.includes('already')) {\n          errorMessage = 'An account with this email already exists. Please sign in instead.';\n        } else if (msg.includes('invalid') || msg.includes('credentials') || msg.includes('password') || msg.includes('email')) {\n          errorMessage = 'Invalid email or password. Please try again.';\n        }\n      }\n      \n      setError(errorMessage);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background font-body flex flex-col\">\n      {/* Header */}\n      <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm\">\n        <div className=\"max-w-6xl mx-auto px-6 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 bloom-gold\">\n              <LineChart className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <div className=\"flex flex-col\">\n              <h1 className=\"text-2xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight\">\n                Gold Predict\n              </h1>\n            </div>\n          </div>\n          <Button \n            variant=\"ghost\" \n            onClick={() => setLocation('/')}\n            data-testid=\"button-back-pricing\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Plans\n          </Button>\n        </div>\n      </header>\n\n      {/* Login Form */}\n      <main className=\"flex-1 flex items-center justify-center p-6\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl\">\n              {mode === 'login' ? 'Welcome Back' : 'Create Account'}\n            </CardTitle>\n            <CardDescription>\n              {mode === 'login' \n                ? 'Sign in to access your Gold Predict dashboard' \n                : 'Complete your account setup after subscribing'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              {error && (\n                <Alert variant=\"destructive\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              {mode === 'register' && (\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"firstName\">First Name</Label>\n                    <Input\n                      id=\"firstName\"\n                      value={firstName}\n                      onChange={(e) => setFirstName(e.target.value)}\n                      placeholder=\"John\"\n                      data-testid=\"input-first-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"lastName\">Last Name</Label>\n                    <Input\n                      id=\"lastName\"\n                      value={lastName}\n                      onChange={(e) => setLastName(e.target.value)}\n                      placeholder=\"Doe\"\n                      data-testid=\"input-last-name\"\n                    />\n                  </div>\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"you@example.com\"\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"\"\n                  required\n                  minLength={6}\n                  data-testid=\"input-password\"\n                />\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full\" \n                disabled={isSubmitting}\n                data-testid=\"button-submit-auth\"\n              >\n                {isSubmitting ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                ) : (\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                )}\n                {mode === 'login' ? 'Sign In' : 'Create Account'}\n              </Button>\n\n              <div className=\"text-center text-sm text-muted-foreground\">\n                {mode === 'login' ? (\n                  <>\n                    Don't have an account?{' '}\n                    <button \n                      type=\"button\"\n                      onClick={() => setMode('register')}\n                      className=\"text-primary hover:underline\"\n                      data-testid=\"button-switch-register\"\n                    >\n                      Create one\n                    </button>\n                  </>\n                ) : (\n                  <>\n                    Already have an account?{' '}\n                    <button \n                      type=\"button\"\n                      onClick={() => setMode('login')}\n                      className=\"text-primary hover:underline\"\n                      data-testid=\"button-switch-login\"\n                    >\n                      Sign in\n                    </button>\n                  </>\n                )}\n              </div>\n            </form>\n\n            <div className=\"mt-6 pt-6 border-t border-border/40\">\n              <p className=\"text-xs text-muted-foreground text-center\">\n                Note: You need an active subscription to access the dashboard. \n                If you haven't subscribed yet,{' '}\n                <button \n                  onClick={() => setLocation('/')}\n                  className=\"text-primary hover:underline\"\n                >\n                  choose a plan first\n                </button>.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":9414,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/livePrice.ts":{"content":"import type { LivePrice } from '@shared/schema';\n\nlet cachedPrice: LivePrice | null = null;\nlet lastFetch = 0;\nconst CACHE_TTL = 5000;\n\nexport async function fetchLiveXAUUSD(): Promise<LivePrice> {\n  const now = Date.now();\n  \n  if (cachedPrice && (now - lastFetch) < CACHE_TTL) {\n    return cachedPrice;\n  }\n\n  const sources = [\n    fetchFromGoldApi,\n    fetchFromGoldPriceOrg,\n    generateRealisticPrice // Fallback\n  ];\n\n  for (const source of sources) {\n    try {\n      const price = await source();\n      if (price && price.price > 0) {\n        cachedPrice = price;\n        lastFetch = now;\n        console.log(`Live price: $${price.price} from ${price.source}`);\n        return price;\n      }\n    } catch (err) {\n      console.log(`Price source failed: ${(err as Error).message}`);\n    }\n  }\n\n  if (cachedPrice) {\n    return cachedPrice;\n  }\n\n  throw new Error(\"Failed to fetch live price from all sources\");\n}\n\nasync function fetchFromGoldApi(): Promise<LivePrice> {\n  const response = await fetch('https://api.gold-api.com/price/XAU', {\n    signal: AbortSignal.timeout(5000),\n    headers: { 'User-Agent': 'Mozilla/5.0' }\n  });\n  \n  if (!response.ok) throw new Error('Gold API failed');\n  \n  const data = await response.json();\n  if (data.price) {\n    return createPriceObject(data.price, 'gold-api.com');\n  }\n  throw new Error('Invalid Gold API response');\n}\n\nasync function fetchFromGoldPriceOrg(): Promise<LivePrice> {\n  const response = await fetch('https://data-asg.goldprice.org/dbXRates/USD', {\n    signal: AbortSignal.timeout(5000),\n    headers: { 'User-Agent': 'Mozilla/5.0' }\n  });\n\n  if (!response.ok) throw new Error('GoldPrice.org failed');\n\n  const data = await response.json();\n  if (data.items && data.items.length > 0) {\n    const item = data.items[0];\n    if (item.xauPrice) {\n      return createPriceObject(item.xauPrice, 'goldprice.org');\n    }\n  }\n  throw new Error('Invalid GoldPrice.org response');\n}\n\nfunction createPriceObject(price: number, source: string): LivePrice {\n  const spread = price * 0.0002;\n  const bid = price - spread / 2;\n  const ask = price + spread / 2;\n  \n  // Simulate daily change if not available (approx 0.5% volatility)\n  const dailyChange = (Math.random() - 0.5) * (price * 0.005);\n  const changePercent = (dailyChange / price) * 100;\n  \n  const high = price + Math.abs(dailyChange) * 1.5;\n  const low = price - Math.abs(dailyChange) * 1.5;\n  \n  return {\n    symbol: 'XAUUSD',\n    bid: Math.round(bid * 100) / 100,\n    ask: Math.round(ask * 100) / 100,\n    price: Math.round(price * 100) / 100,\n    change: Math.round(dailyChange * 100) / 100,\n    changePercent: Math.round(changePercent * 10000) / 10000,\n    high: Math.round(high * 100) / 100,\n    low: Math.round(low * 100) / 100,\n    timestamp: new Date().toISOString(),\n    source\n  };\n}\n\nfunction generateRealisticPrice(): LivePrice {\n  // 2026 Estimate\n  const basePrice = 5500 + (Math.random() - 0.5) * 100;\n  return createPriceObject(basePrice, 'market-estimate');\n}\n","path":null,"size_bytes":2983,"size_tokens":null},"shared/routes.ts":{"content":"import { z } from 'zod';\nimport { PredictRequestSchema, PredictionResponseSchema, LivePriceSchema, SignalResponseSchema, UserSettingsSchema, TimeframeSchema, type PredictRequest, type PredictionResponse } from './schema';\n\n// Re-export types for use in hooks\nexport type { PredictRequest, PredictionResponse };\n\nexport const errorSchemas = {\n  validation: z.object({\n    message: z.string(),\n    field: z.string().optional(),\n  }),\n  notFound: z.object({\n    message: z.string(),\n  }),\n  internal: z.object({\n    message: z.string(),\n  }),\n};\n\nexport const api = {\n  prediction: {\n    analyze: {\n      method: 'POST' as const,\n      path: '/api/predict',\n      input: PredictRequestSchema,\n      responses: {\n        200: PredictionResponseSchema,\n        400: errorSchemas.validation,\n        500: errorSchemas.internal,\n      },\n    },\n  },\n  livePrice: {\n    get: {\n      method: 'GET' as const,\n      path: '/api/live-price',\n      responses: {\n        200: LivePriceSchema,\n        500: errorSchemas.internal,\n      },\n    },\n  },\n  signals: {\n    list: {\n      method: 'GET' as const,\n      path: '/api/signals',\n      responses: {\n        200: z.array(SignalResponseSchema),\n        500: errorSchemas.internal,\n      },\n    },\n    generate: {\n      method: 'POST' as const,\n      path: '/api/signals/generate',\n      input: z.object({ timeframe: TimeframeSchema }),\n      responses: {\n        200: SignalResponseSchema,\n        500: errorSchemas.internal,\n      },\n    },\n    delete: {\n      method: 'DELETE' as const,\n      path: '/api/signals/:id',\n      responses: {\n        200: z.object({ success: z.boolean() }),\n        404: errorSchemas.notFound,\n        500: errorSchemas.internal,\n      },\n    },\n  },\n  settings: {\n    get: {\n      method: 'GET' as const,\n      path: '/api/settings',\n      responses: {\n        200: UserSettingsSchema,\n      },\n    },\n    update: {\n      method: 'PUT' as const,\n      path: '/api/settings',\n      input: UserSettingsSchema.partial(),\n      responses: {\n        200: UserSettingsSchema,\n      },\n    },\n  },\n};\n\nexport function buildUrl(path: string, params?: Record<string, string | number>): string {\n  let url = path;\n  if (params) {\n    Object.entries(params).forEach(([key, value]) => {\n      if (url.includes(`:${key}`)) {\n        url = url.replace(`:${key}`, String(value));\n      }\n    });\n  }\n  return url;\n}\n","path":null,"size_bytes":2370,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/pages/Checkout.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { \n  useSubscriptionPlans, \n  useCheckoutRegister,\n  useConfirmSubscription,\n  useStripePublishableKey \n} from \"@/hooks/use-subscription\";\n\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Check, Loader2, Crown, Zap, TrendingUp, ArrowLeft, CreditCard, LineChart, Shield, AlertCircle, User, Mail, Lock, Eye, EyeOff } from \"lucide-react\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { Elements, CardNumberElement, CardExpiryElement, CardCvcElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\n\nconst PLAN_DISPLAY: Record<string, { \n  name: string; \n  icon: any; \n  color: string; \n  bgColor: string; \n  description: string; \n  highlights: string[]; \n}> = {\n  basic: {\n    name: \"Basic\",\n    icon: TrendingUp,\n    color: \"text-blue-500\",\n    bgColor: \"bg-blue-500/10\",\n    description: \"Essential gold market analysis for beginners\",\n    highlights: [\n      \"Real-time XAU/USD price tracking\",\n      \"Basic price chart with zoom controls\",\n      \"RSI technical indicator\",\n      \"3 AI predictions per day\",\n    ],\n  },\n  pro: {\n    name: \"Pro\",\n    icon: Zap,\n    color: \"text-primary\",\n    bgColor: \"bg-primary/10\",\n    description: \"Advanced tools for serious traders\",\n    highlights: [\n      \"Everything in Basic, plus:\",\n      \"MACD and SMA indicators\",\n      \"10 AI predictions per day\",\n      \"Full trading signals access\",\n      \"Weekly market analysis reports\",\n    ],\n  },\n  premium: {\n    name: \"Premium\",\n    icon: Crown,\n    color: \"text-amber-500\",\n    bgColor: \"bg-amber-500/10\",\n    description: \"Complete suite for professional traders\",\n    highlights: [\n      \"Everything in Pro, plus:\",\n      \"All technical indicators\",\n      \"Unlimited AI predictions\",\n      \"Priority trading signals\",\n      \"Premium AI market reports\",\n      \"Real-time email alerts\",\n    ],\n  },\n};\n\nfunction formatPrice(amount: number, currency: string) {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currency.toUpperCase(),\n  }).format(amount / 100);\n}\n\ninterface PaymentFormProps {\n  priceId: string;\n  planName: string;\n  amount: number;\n  currency: string;\n  onSuccess: () => void;\n  existingUser: { email: string } | null;\n}\n\nfunction PaymentForm({ priceId, planName, amount, currency, onSuccess, existingUser }: PaymentFormProps) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [, setLocation] = useLocation();\n  \n  const [isProcessing, setIsProcessing] = useState(false);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [cardComplete, setCardComplete] = useState(false);\n\n  const [email, setEmail] = useState(existingUser?.email || \"\");\n  const [password, setPassword] = useState(\"\");\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  \n  const checkoutRegister = useCheckoutRegister();\n  const confirmSubscription = useConfirmSubscription();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!stripe || !elements) {\n      return;\n    }\n\n    const cardNumberElement = elements.getElement(CardNumberElement);\n    if (!cardNumberElement) {\n      return;\n    }\n\n    if (!email || !password) {\n      setErrorMessage(\"Please enter your email and password.\");\n      return;\n    }\n\n    if (password.length < 6) {\n      setErrorMessage(\"Password must be at least 6 characters.\");\n      return;\n    }\n\n    setIsProcessing(true);\n    setErrorMessage(null);\n\n    try {\n      const { subscriptionId, clientSecret } = await checkoutRegister.mutateAsync({\n        email,\n        password,\n        firstName: firstName || undefined,\n        lastName: lastName || undefined,\n        priceId,\n      });\n\n      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardNumberElement,\n        },\n      });\n\n      if (error) {\n        setErrorMessage(error.message || \"Payment failed. Please try again.\");\n        setIsProcessing(false);\n        return;\n      }\n\n      if (paymentIntent?.status === \"succeeded\") {\n        await confirmSubscription.mutateAsync(subscriptionId);\n        onSuccess();\n      } else {\n        setErrorMessage(\"Payment requires additional verification. Please contact support.\");\n      }\n    } catch (err: any) {\n      console.error(\"Payment error:\", err);\n      let msg = err.message || \"An unexpected error occurred. Please try again.\";\n      try {\n        const jsonMatch = msg.match(/\\{.*\\}/);\n        if (jsonMatch) {\n          const parsed = JSON.parse(jsonMatch[0]);\n          if (parsed.error) msg = parsed.error;\n        }\n      } catch {}\n      setErrorMessage(msg);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const elementStyle = {\n    base: {\n      fontSize: '16px',\n      color: '#ffffff',\n      fontFamily: 'system-ui, -apple-system, sans-serif',\n      '::placeholder': {\n        color: '#9ca3af',\n      },\n      iconColor: '#f59e0b',\n    },\n    invalid: {\n      color: '#ef4444',\n      iconColor: '#ef4444',\n    },\n  };\n\n  const [cardNumberComplete, setCardNumberComplete] = useState(false);\n  const [cardExpiryComplete, setCardExpiryComplete] = useState(false);\n  const [cardCvcComplete, setCardCvcComplete] = useState(false);\n\n  useEffect(() => {\n    setCardComplete(cardNumberComplete && cardExpiryComplete && cardCvcComplete);\n  }, [cardNumberComplete, cardExpiryComplete, cardCvcComplete]);\n\n  const isFormValid = email && password.length >= 6 && cardComplete;\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center gap-2 mb-1\">\n          <User className=\"w-4 h-4 text-primary\" />\n          <span className=\"text-sm font-medium\">Account Details</span>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"checkout-email\">Email Address</Label>\n          <div className=\"relative\">\n            <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n            <Input\n              id=\"checkout-email\"\n              type=\"email\"\n              placeholder=\"you@example.com\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"pl-10\"\n              required\n              data-testid=\"input-checkout-email\"\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"checkout-password\">Password</Label>\n          <div className=\"relative\">\n            <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n            <Input\n              id=\"checkout-password\"\n              type={showPassword ? \"text\" : \"password\"}\n              placeholder=\"Create a password (min. 6 characters)\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"pl-10 pr-10\"\n              required\n              minLength={6}\n              data-testid=\"input-checkout-password\"\n            />\n            <button\n              type=\"button\"\n              onClick={() => setShowPassword(!showPassword)}\n              className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground\"\n              tabIndex={-1}\n              data-testid=\"button-toggle-password\"\n            >\n              {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n            </button>\n          </div>\n          <p className=\"text-xs text-muted-foreground\">\n            {existingUser ? \"Enter your existing password to confirm\" : \"This will be your login for Gold Predict\"}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"checkout-first-name\">First Name</Label>\n              <Input\n                id=\"checkout-first-name\"\n                type=\"text\"\n                placeholder=\"John\"\n                value={firstName}\n                onChange={(e) => setFirstName(e.target.value)}\n                data-testid=\"input-checkout-first-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"checkout-last-name\">Last Name</Label>\n              <Input\n                id=\"checkout-last-name\"\n                type=\"text\"\n                placeholder=\"Doe\"\n                value={lastName}\n                onChange={(e) => setLastName(e.target.value)}\n                data-testid=\"input-checkout-last-name\"\n              />\n            </div>\n          </div>\n\n        <div className=\"border-t border-border/40 pt-4 mt-4\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <CreditCard className=\"w-4 h-4 text-primary\" />\n            <span className=\"text-sm font-medium\">Payment Details</span>\n          </div>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"card-number\">Card Number</Label>\n          <div className=\"p-3 rounded-lg border border-border bg-background\">\n            <CardNumberElement\n              id=\"card-number\"\n              options={{ style: elementStyle, showIcon: true, disableLink: true }}\n              onChange={(e) => {\n                setCardNumberComplete(e.complete);\n                if (e.error) {\n                  setErrorMessage(e.error.message);\n                } else if (!cardExpiryComplete || !cardCvcComplete) {\n                  setErrorMessage(null);\n                }\n              }}\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"card-expiry\">Expiry Date</Label>\n            <div className=\"p-3 rounded-lg border border-border bg-background\">\n              <CardExpiryElement\n                id=\"card-expiry\"\n                options={{ style: elementStyle }}\n                onChange={(e) => {\n                  setCardExpiryComplete(e.complete);\n                  if (e.error) {\n                    setErrorMessage(e.error.message);\n                  } else if (!cardNumberComplete || !cardCvcComplete) {\n                    setErrorMessage(null);\n                  }\n                }}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"card-cvc\">Security Code</Label>\n            <div className=\"p-3 rounded-lg border border-border bg-background\">\n              <CardCvcElement\n                id=\"card-cvc\"\n                options={{ style: elementStyle }}\n                onChange={(e) => {\n                  setCardCvcComplete(e.complete);\n                  if (e.error) {\n                    setErrorMessage(e.error.message);\n                  } else if (!cardNumberComplete || !cardExpiryComplete) {\n                    setErrorMessage(null);\n                  }\n                }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {errorMessage && (\n          <div className=\"flex items-center gap-2 p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm\">\n            <AlertCircle className=\"w-4 h-4 shrink-0\" />\n            <span>{errorMessage}</span>\n          </div>\n        )}\n\n        <div className=\"space-y-3 pt-2\">\n          <div className=\"flex justify-between gap-2 text-sm\">\n            <span className=\"text-muted-foreground\">{planName} Plan (Monthly)</span>\n            <span>{formatPrice(amount, currency)}</span>\n          </div>\n          <div className=\"border-t border-border/40 pt-3 flex justify-between gap-2 font-bold\">\n            <span>Total Today</span>\n            <span className=\"text-primary\">{formatPrice(amount, currency)}</span>\n          </div>\n        </div>\n      </div>\n\n      <Button\n        type=\"submit\"\n        className=\"w-full\"\n        size=\"lg\"\n        disabled={!stripe || isProcessing || !isFormValid}\n        data-testid=\"button-confirm-payment\"\n      >\n        {isProcessing ? (\n          <>\n            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n            Processing...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-4 h-4 mr-2\" />\n            {existingUser ? `Pay ${formatPrice(amount, currency)}` : `Create Account & Pay ${formatPrice(amount, currency)}`}\n          </>\n        )}\n      </Button>\n\n      <p className=\"text-xs text-muted-foreground text-center\">\n        Your payment is securely processed by Stripe.\n        You can cancel anytime from your account settings.\n      </p>\n    </form>\n  );\n}\n\nfunction CheckoutContent() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const params = new URLSearchParams(searchString);\n  const planId = params.get('plan');\n  \n  const { data: plansData, isLoading: plansLoading } = useSubscriptionPlans();\n  const { data: stripeKeyData, isLoading: stripeLoading } = useStripePublishableKey();\n  \n  const [stripePromise, setStripePromise] = useState<ReturnType<typeof loadStripe> | null>(null);\n  const [paymentSuccess, setPaymentSuccess] = useState(false);\n\n  useEffect(() => {\n    if (stripeKeyData?.publishableKey && !stripePromise) {\n      setStripePromise(loadStripe(stripeKeyData.publishableKey));\n    }\n  }, [stripeKeyData?.publishableKey]);\n  \n  const plans = plansData?.plans || [];\n  const selectedPlan = plans.find(p => {\n    const planKey = p.metadata?.plan;\n    return planKey === planId;\n  });\n  \n  const planKey = (selectedPlan?.metadata?.plan as keyof typeof PLAN_DISPLAY) || 'basic';\n  const display = PLAN_DISPLAY[planKey] || PLAN_DISPLAY.basic;\n  const price = selectedPlan?.prices?.[0];\n  const Icon = display.icon;\n\n  useEffect(() => {\n    if (!plansLoading && !planId) {\n      setLocation('/');\n    }\n  }, [plansLoading, planId, setLocation]);\n\n  const handlePaymentSuccess = () => {\n    setPaymentSuccess(true);\n    setTimeout(() => {\n      setLocation('/dashboard');\n    }, 2000);\n  };\n\n  const isLoading = plansLoading || stripeLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!selectedPlan || !price) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full text-center\">\n          <CardContent className=\"py-8\">\n            <p className=\"text-muted-foreground mb-4\">Plan not found</p>\n            <Button onClick={() => setLocation('/')}>\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Plans\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (paymentSuccess) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-6\">\n        <Card className=\"max-w-md w-full text-center border-green-500/30\">\n          <CardContent className=\"py-12\">\n            <div className=\"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto mb-6\">\n              <Check className=\"w-8 h-8 text-green-500\" />\n            </div>\n            <h2 className=\"text-2xl font-bold mb-2\">Payment Successful!</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              Welcome to Gold Predict {display.name}. Redirecting to your dashboard...\n            </p>\n            <Loader2 className=\"w-6 h-6 animate-spin text-primary mx-auto\" />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background font-body\">\n      <header className=\"border-b border-border/40 bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"max-w-4xl mx-auto px-6 py-4 flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-amber-600 flex items-center justify-center shadow-lg shadow-primary/30 bloom-gold\">\n              <LineChart className=\"w-6 h-6 text-primary-foreground\" />\n            </div>\n            <div className=\"flex flex-col\">\n              <h1 className=\"text-2xl font-display font-bold bg-clip-text text-transparent bg-gradient-to-r from-foreground via-foreground/90 to-foreground/70 tracking-tight\">\n                Gold Predict\n              </h1>\n            </div>\n          </div>\n          <Button \n            variant=\"ghost\" \n            onClick={() => setLocation('/')}\n            data-testid=\"button-back-plans\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Change Plan\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-6 py-12\">\n        <div className=\"grid md:grid-cols-2 gap-8\">\n          <div>\n            <h2 className=\"text-2xl font-display font-bold mb-6\">Order Summary</h2>\n            \n            <Card className=\"border-primary/20\" data-testid=\"card-order-summary\">\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className={`w-12 h-12 rounded-full ${display.bgColor} flex items-center justify-center`}>\n                    <Icon className={`w-6 h-6 ${display.color}`} />\n                  </div>\n                  <div>\n                    <CardTitle>{display.name} Plan</CardTitle>\n                    <CardDescription>{display.description}</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"space-y-4\">\n                <ul className=\"space-y-2\">\n                  {display.highlights.map((feature, idx) => (\n                    <li key={idx} className=\"flex items-start gap-2\">\n                      <Check className=\"w-4 h-4 text-green-500 shrink-0 mt-0.5\" />\n                      <span className=\"text-sm text-muted-foreground\">{feature}</span>\n                    </li>\n                  ))}\n                </ul>\n                \n                <div className=\"pt-4 border-t border-border/40\">\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <span className=\"text-muted-foreground\">Monthly subscription</span>\n                    <span className=\"text-xl font-bold\">\n                      {formatPrice(price.unitAmount, price.currency)}/mo\n                    </span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"mt-4 border-green-500/20 bg-green-500/5\">\n              <CardContent className=\"py-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Check className=\"w-5 h-5 text-green-500\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-foreground\">7-Day Money Back Guarantee</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Not satisfied? Get a full refund within 7 days.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div>\n            <h2 className=\"text-2xl font-display font-bold mb-6\">\n              Create Account & Pay\n            </h2>\n            \n            <Card data-testid=\"card-payment-details\">\n              <CardContent className=\"pt-6 space-y-6\">\n                <div className=\"flex items-center gap-3 p-4 bg-primary/5 rounded-lg border border-primary/10\">\n                  <Shield className=\"w-5 h-5 text-primary\" />\n                  <div>\n                    <p className=\"text-sm font-medium text-foreground\">Secure Checkout</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Your account and payment are protected with 256-bit encryption.\n                    </p>\n                  </div>\n                </div>\n\n                {stripePromise ? (\n                  <Elements stripe={stripePromise}>\n                    <PaymentForm\n                      priceId={price.id}\n                      planName={display.name}\n                      amount={price.unitAmount}\n                      currency={price.currency}\n                      onSuccess={handlePaymentSuccess}\n                      existingUser={null}\n                    />\n                  </Elements>\n                ) : (\n                  <div className=\"flex items-center justify-center py-8\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default function Checkout() {\n  return <CheckoutContent />;\n}\n","path":null,"size_bytes":21150,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"replit.md":{"content":"# Gold Predict - XAUUSD Market Analysis Platform\n\n## Overview\n\nGold Predict is a real-time gold price prediction and market analysis platform focused on XAU/USD (Gold Spot vs US Dollar). The application provides live price tracking, technical analysis with indicators (RSI, MACD, SMA), price predictions using statistical models, and trading signal generation. Built as a full-stack TypeScript application with a React frontend and Express backend, it features a professional dark-themed financial dashboard interface.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter for lightweight client-side routing\n- **State Management**: TanStack React Query for server state and caching\n- **UI Components**: shadcn/ui component library built on Radix UI primitives\n- **Styling**: Tailwind CSS with custom CSS variables for theming (dark financial theme with gold accents)\n- **Charts**: Recharts for candlestick and trend visualization\n- **Build Tool**: Vite with custom path aliases (@/, @shared/, @assets/)\n\n### Backend Architecture\n- **Framework**: Express 5 on Node.js with TypeScript\n- **API Pattern**: REST API with typed route definitions in shared/routes.ts\n- **Database ORM**: Drizzle ORM with PostgreSQL dialect\n- **Validation**: Zod schemas for request/response validation with drizzle-zod integration\n- **Structure**: Modular file organization (routes.ts, storage.ts, prediction.ts, livePrice.ts)\n\n### Data Flow Pattern\n1. Shared schema definitions in `/shared/schema.ts` define database tables and API types\n2. Route contracts defined in `/shared/routes.ts` ensure type safety across client/server\n3. Frontend uses custom hooks (use-prediction.ts) wrapping React Query mutations\n4. Backend storage layer abstracts database operations with interface-based design\n\n### Key Design Decisions\n- **Monorepo Structure**: Client code in `/client`, server in `/server`, shared types in `/shared`\n- **Type Sharing**: Zod schemas and TypeScript types shared between frontend and backend\n- **Price Data Fallback**: Multiple price source strategy with caching and simulated fallback for demo purposes\n- **Technical Analysis**: Uses yahoo-finance2 for market data and technicalindicators library for RSI/MACD/SMA calculations\n\n### Database Schema\n- **predictions**: Stores prediction history (symbol, timeframe, prices, direction, confidence)\n- **signals**: Trading signals with entry/target/stop-loss prices and status tracking\n\n## External Dependencies\n\n### Data Sources\n- **Yahoo Finance API**: Primary source for historical OHLC candle data via yahoo-finance2 package\n- **Metal Price APIs**: Multiple fallback sources for live XAUUSD spot prices\n- **Simulated Data**: Fallback price generation when all external sources fail\n\n### Database\n- **PostgreSQL**: Primary database via DATABASE_URL environment variable\n- **Drizzle Kit**: Database migrations and schema management (`npm run db:push`)\n\n### Third-Party Services\n- **Google Fonts**: DM Sans, Space Grotesk, JetBrains Mono for typography\n- **Replit Plugins**: Runtime error overlay, cartographer, and dev banner for development environment\n\n### Key NPM Packages\n- **technicalindicators**: RSI, MACD, SMA technical analysis calculations\n- **simple-statistics**: Statistical analysis for prediction models\n- **date-fns**: Date formatting and manipulation\n- **connect-pg-simple**: PostgreSQL session store for sessions\n- **passport**: Authentication middleware with OpenID Connect strategy\n\n## Authentication System\n\n### Overview\nUser authentication uses email/password with inline forms (no external OAuth or popups). Users sign up and log in directly on the page.\n\n### Key Components\n- **useAuth hook** (`client/src/hooks/use-auth.ts`): React hook for authentication state and actions (login, register, logout)\n- **DashboardLayout** (`client/src/components/DashboardLayout.tsx`): Wraps all routes and enforces auth\n- **AuthRequiredScreen**: Inline login/signup form with toggle between modes\n- **UserProfileButton**: Header component showing user avatar with dropdown menu\n\n### Routes\n- `POST /api/auth/register`: Creates new user account (body: {email, password, firstName?, lastName?})\n- `POST /api/auth/login`: Authenticates user (body: {email, password})\n- `POST /api/auth/logout`: Logs out the user\n- `GET /api/auth/user`: Returns current user info (or 401 if not logged in)\n\n### Security\n- Passwords hashed with bcrypt (10 salt rounds)\n- Sessions stored in PostgreSQL with express-session + connect-pg-simple\n- SESSION_SECRET environment variable required (no fallback)\n- Cookies use sameSite: \"lax\" for CSRF protection\n\n### User Flow\n1. Unauthenticated users see inline login form with Gold Predict branding\n2. Users can toggle between \"Sign In\" and \"Create Account\" modes\n3. User enters email and password, clicks Confirm\n4. On success, dashboard is displayed (no page redirect)\n5. User profile button shows email and sign out option\n\n### Welcome Email\nWhen users register, they receive an automated welcome email containing:\n- Getting started guide with dashboard overview\n- Technical indicators explanation (RSI, MACD, SMA)\n- AI predictions and trading signals features\n- Pro tips for using the platform\n- Important disclaimer about financial advice\n\nEmail is sent via Gmail API using Replit's Google Mail connector (server/services/emailService.ts).\n\n### Database Schema\n- **users**: Stores user information (id, email, password, firstName, lastName, profileImageUrl, stripeCustomerId, stripeSubscriptionId, subscriptionPlan, subscriptionStatus, subscriptionExpiresAt, createdAt, updatedAt)\n- **sessions**: Stores session data for authenticated users\n- **predictionUsage**: Tracks daily prediction count per user (userId, usageDate, count) - resets daily at UTC midnight\n\n## Subscription System\n\n### Overview\nMonetization via Stripe subscription with 3 tiers. Users must have an active paid subscription to access premium features.\n\n### Subscription Tiers\n- **Basic** ($9.99/month): RSI indicator, 3 predictions per day\n- **Pro** ($19.99/month): RSI/MACD/SMA indicators, 10 predictions per day, trading signals, weekly alerts\n- **Premium** ($49.99/month): All indicators, unlimited predictions, priority signals, premium AI reports, real-time email alerts\n\n### User Flow (Public-First Architecture with Combined Checkout+Registration)\n1. **Landing Page** (`/`): Pricing page shown first - no auth required\n2. **Select Plan**: User clicks \"Get Started\" on a plan\n3. **Checkout Page** (`/checkout?plan=...`): Combined account creation + payment form\n   - Email/password fields for account creation (or login for existing users)\n   - Optional first/last name fields for new users\n   - Card input form with Stripe Elements (no external redirects)\n   - Account is created and subscription linked in one step\n   - Welcome email sent after successful payment confirmation\n4. **Success**: Payment confirmation shown on same page, then redirect to dashboard\n5. **Dashboard** (`/dashboard`): Protected - requires auth + active subscription\n6. **Login** (`/login`): Separate login page for returning users\n\n### Key Components\n- **LandingPricing** (`client/src/pages/LandingPricing.tsx`): Public landing page with plan comparison\n- **Checkout** (`client/src/pages/Checkout.tsx`): Combined registration + payment form with Stripe Elements\n- **Login** (`client/src/pages/Login.tsx`): Auth page for returning subscribers\n- **useSubscription hook** (`client/src/hooks/use-subscription.ts`): React hook for subscription status and feature gating\n- **useCheckoutRegister hook**: Combined registration + Stripe subscription creation mutation\n- **SubscriptionSuccess Page** (`client/src/pages/SubscriptionSuccess.tsx`): Post-checkout confirmation\n- **SubscriptionRequiredScreen**: Shown when authenticated user has no active subscription\n\n### Backend Services\n- **stripeClient.ts**: Stripe API client using environment variables (STRIPE_PUBLISHABLE_KEY, STRIPE_SECRET_KEY) - configured manually instead of Replit connector\n- **stripeService.ts**: Customer/checkout/portal session management\n- **webhookHandlers.ts**: Processes Stripe webhooks via stripe-replit-sync\n- **subscriptionRoutes.ts**: API routes for subscription management\n\n### API Routes\n- `GET /api/stripe/publishable-key`: Get Stripe publishable key for frontend\n- `GET /api/subscription/plans`: List available subscription products with prices\n- `GET /api/subscription/status`: Get current user's subscription status (requires auth)\n- `POST /api/subscription/checkout-register`: Combined registration + Stripe subscription creation (no auth required, rate-limited)\n- `POST /api/subscription/create-subscription`: Create subscription for logged-in user (requires auth)\n- `POST /api/subscription/confirm`: Confirm subscription after payment + send welcome email (requires auth)\n- `POST /api/subscription/checkout`: Create Stripe checkout session (requires auth, legacy)\n- `POST /api/subscription/portal`: Create Stripe customer portal session (requires auth)\n- `POST /api/stripe/webhook`: Stripe webhook endpoint (raw body, registered before express.json)\n\n### Feature Gating\nThe PLAN_FEATURES constant in use-subscription.ts defines what each plan includes:\n- `predictions`: Daily prediction limit\n- `indicators`: Available technical indicators\n- `signals`: Access to trading signals\n- `analysis`: Access to AI market analysis\n- `alerts`: Real-time email alerts\n\n### Prediction Limit Enforcement\n- Authentication is required for all predictions (401 returned if not logged in)\n- Daily limits enforced per subscription plan:\n  - Free: 0 predictions (must subscribe)\n  - Basic: 3 predictions per day\n  - Pro: 10 predictions per day\n  - Premium: Unlimited predictions\n- Developer email (furlan27.mattia@gmail.com) has unlimited predictions bypass\n- Usage tracked in predictionUsage table, resets at UTC midnight\n- API endpoint: `GET /api/predictions/usage` returns current usage and limits\n- Frontend displays remaining predictions badge and disables analyze button when limit reached\n\n### Stripe Integration\n- Uses `stripe-replit-sync` for webhook processing and data syncing\n- Products/prices stored in `stripe.products` and `stripe.prices` tables\n- User subscription info stored in the users table\n- Seed script: `npx tsx server/scripts/seed-products.ts` to create products in Stripe\n\n### User Flow\n1. User views pricing page with 3 plan options\n2. User clicks Subscribe on desired plan\n3. Checkout session created, user redirected to Stripe Checkout\n4. After successful payment, user redirected to /subscription/success\n5. Webhook updates user's subscription status in database\n6. User can manage subscription via Customer Portal from Settings page","path":null,"size_bytes":10797,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/hooks/use-prediction.ts":{"content":"import { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { api, type PredictRequest, type PredictionResponse } from \"@shared/routes\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport interface PredictionUsage {\n  used: number;\n  limit: number | 'unlimited';\n  remaining: number | 'unlimited';\n  plan: string;\n}\n\n// Hook to get prediction usage\nexport function usePredictionUsage() {\n  return useQuery<PredictionUsage>({\n    queryKey: ['/api/predictions/usage'],\n    retry: false,\n  });\n}\n\nexport function usePrediction() {\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async (data: PredictRequest) => {\n      const res = await apiRequest(\"POST\", api.prediction.analyze.path, data);\n      if (!res.ok) {\n        const error = await res.json();\n        if (error.code === 'LIMIT_EXCEEDED') {\n          throw new Error(`Daily limit reached (${error.limit}/day). Upgrade for more predictions.`);\n        }\n        throw new Error(error.message || 'Prediction failed');\n      }\n      return await res.json() as PredictionResponse & { usage?: PredictionUsage };\n    },\n    onSuccess: () => {\n      // Invalidate usage query to refresh count\n      queryClient.invalidateQueries({ queryKey: ['/api/predictions/usage'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Prediction Failed\",\n        description: error.message || \"Could not analyze market data.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n}\n","path":null,"size_bytes":1554,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"server/replit_integrations/auth/routes.ts":{"content":"import type { Express } from \"express\";\nimport rateLimit from \"express-rate-limit\";\nimport { authStorage } from \"./storage\";\nimport { isAuthenticated, hashPassword, verifyPassword } from \"./replitAuth\";\nimport { registerSchema, loginSchema, updateProfileSchema } from \"@shared/models/auth\";\nimport { z } from \"zod\";\nimport { sendWelcomeEmail } from \"../../services/emailService\";\n\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 10,\n  message: { message: \"Too many attempts. Please try again in 15 minutes.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nconst registerLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000,\n  max: 5,\n  message: { message: \"Too many accounts created. Please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nexport function registerAuthRoutes(app: Express): void {\n  app.post(\"/api/auth/register\", registerLimiter, async (req, res) => {\n    try {\n      const input = registerSchema.parse(req.body);\n      \n      const existingUser = await authStorage.getUserByEmail(input.email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"An account with this email already exists\" });\n      }\n      \n      const hashedPassword = await hashPassword(input.password);\n      const user = await authStorage.createUser({\n        email: input.email,\n        password: hashedPassword,\n        firstName: input.firstName,\n        lastName: input.lastName,\n      });\n      \n      req.session.userId = user.id;\n      \n      const userName = user.firstName || undefined;\n      sendWelcomeEmail(user.email, userName).catch(err => {\n        console.error(\"Failed to send welcome email:\", err);\n      });\n      \n      res.json(authStorage.getUserResponse(user));\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ message: \"Failed to register user\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", authLimiter, async (req, res) => {\n    try {\n      const input = loginSchema.parse(req.body);\n      \n      const DEV_EMAIL = \"furlan27.mattia@gmail.com\";\n      const DEV_PASSWORD = process.env.DEV_PASSWORD;\n      \n      if (DEV_PASSWORD && input.email === DEV_EMAIL && input.password === DEV_PASSWORD) {\n        let user = await authStorage.getUserByEmail(DEV_EMAIL);\n        if (!user) {\n          const hashedPassword = await hashPassword(DEV_PASSWORD);\n          user = await authStorage.createUser({\n            email: DEV_EMAIL,\n            password: hashedPassword,\n            firstName: \"Developer\",\n            lastName: \"Admin\",\n          });\n        }\n        req.session.userId = user.id;\n        return res.json(authStorage.getUserResponse(user));\n      }\n      \n      const user = await authStorage.getUserByEmail(input.email);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid email or password\" });\n      }\n      \n      const isValid = await verifyPassword(input.password, user.password);\n      if (!isValid) {\n        return res.status(401).json({ message: \"Invalid email or password\" });\n      }\n      \n      req.session.userId = user.id;\n      \n      res.json(authStorage.getUserResponse(user));\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Failed to login\" });\n    }\n  });\n\n  // Logout\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ message: \"Failed to logout\" });\n      }\n      res.clearCookie(\"connect.sid\");\n      res.json({ success: true });\n    });\n  });\n\n  // Get current authenticated user\n  app.get(\"/api/auth/user\", isAuthenticated, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const user = await authStorage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json(authStorage.getUserResponse(user));\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Update user profile (nickname)\n  app.put(\"/api/auth/profile\", isAuthenticated, async (req, res) => {\n    try {\n      const input = updateProfileSchema.parse(req.body);\n      const userId = req.session.userId!;\n      \n      const user = await authStorage.updateNickname(userId, input.nickname);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(authStorage.getUserResponse(user));\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      console.error(\"Profile update error:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n}\n","path":null,"size_bytes":5120,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"/{*path}\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1541,"size_tokens":null},"client/replit_integrations/audio/audio-utils.ts":{"content":"/**\n * Audio utility functions for voice chat.\n * Handles PCM16 decoding and AudioContext initialization.\n */\n\n/**\n * Decode base64 PCM16 audio to Float32Array for Web Audio API\n */\nexport function decodePCM16ToFloat32(base64Audio: string): Float32Array {\n  const raw = atob(base64Audio);\n  const bytes = new Uint8Array(raw.length);\n  for (let i = 0; i < raw.length; i++) {\n    bytes[i] = raw.charCodeAt(i);\n  }\n  const pcm16 = new Int16Array(bytes.buffer);\n  const float32 = new Float32Array(pcm16.length);\n  for (let i = 0; i < pcm16.length; i++) {\n    float32[i] = pcm16[i] / 32768;\n  }\n  return float32;\n}\n\n/**\n * Create and initialize AudioContext with worklet\n */\nexport async function createAudioPlaybackContext(\n  workletPath = \"/audio-playback-worklet.js\",\n  sampleRate = 24000\n): Promise<{ ctx: AudioContext; worklet: AudioWorkletNode }> {\n  const ctx = new AudioContext({ sampleRate });\n  await ctx.audioWorklet.addModule(workletPath);\n  const worklet = new AudioWorkletNode(ctx, \"audio-playback-processor\");\n  worklet.connect(ctx.destination);\n  return { ctx, worklet };\n}\n\n","path":null,"size_bytes":1086,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"server/services/gmail.ts":{"content":"// Gmail client integration using Replit's Google Mail connector\nimport { google } from 'googleapis';\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=google-mail',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('Gmail not connected');\n  }\n  return accessToken;\n}\n\n// WARNING: Never cache this client.\n// Access tokens expire, so a new client must be created each time.\n// Always call this function again to get a fresh client.\nexport async function getGmailClient() {\n  const accessToken = await getAccessToken();\n\n  const oauth2Client = new google.auth.OAuth2();\n  oauth2Client.setCredentials({\n    access_token: accessToken\n  });\n\n  return google.gmail({ version: 'v1', auth: oauth2Client });\n}\n","path":null,"size_bytes":1702,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"/{*path}\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":554,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport {\n  predictions,\n  signals,\n  predictionUsage,\n  type Prediction,\n  type InsertPrediction,\n  type Signal,\n  type InsertSignal,\n  type PredictionUsage,\n  type UserSettings\n} from \"@shared/schema\";\nimport { desc, eq, and, sql } from \"drizzle-orm\";\n\n// In-memory settings (could be persisted to DB later)\nlet userSettings: UserSettings = {\n  defaultTimeframe: \"1h\",\n  autoRefresh: true,\n  refreshInterval: 30,\n  darkMode: true,\n  notifications: true,\n};\n\nexport interface IStorage {\n  createPrediction(prediction: InsertPrediction): Promise<Prediction>;\n  getRecentPredictions(limit?: number): Promise<Prediction[]>;\n  createSignal(signal: InsertSignal): Promise<Signal>;\n  getSignals(limit?: number): Promise<Signal[]>;\n  updateSignalStatus(id: number, status: string): Promise<Signal | undefined>;\n  deleteSignal(id: number): Promise<boolean>;\n  getSettings(): UserSettings;\n  updateSettings(updates: Partial<UserSettings>): UserSettings;\n  // Prediction usage tracking\n  getDailyPredictionCount(userId: string): Promise<number>;\n  incrementPredictionCount(userId: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async createPrediction(insertPrediction: InsertPrediction): Promise<Prediction> {\n    const [prediction] = await db\n      .insert(predictions)\n      .values(insertPrediction)\n      .returning();\n    return prediction;\n  }\n\n  async getRecentPredictions(limit = 10): Promise<Prediction[]> {\n    return await db.select().from(predictions).orderBy(desc(predictions.createdAt)).limit(limit);\n  }\n\n  async createSignal(insertSignal: InsertSignal): Promise<Signal> {\n    const [signal] = await db\n      .insert(signals)\n      .values(insertSignal)\n      .returning();\n    return signal;\n  }\n\n  async getSignals(limit = 50): Promise<Signal[]> {\n    return await db.select().from(signals).orderBy(desc(signals.createdAt)).limit(limit);\n  }\n\n  async updateSignalStatus(id: number, status: string): Promise<Signal | undefined> {\n    const [updated] = await db\n      .update(signals)\n      .set({ status })\n      .where(eq(signals.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteSignal(id: number): Promise<boolean> {\n    const result = await db\n      .delete(signals)\n      .where(eq(signals.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  getSettings(): UserSettings {\n    return userSettings;\n  }\n\n  updateSettings(updates: Partial<UserSettings>): UserSettings {\n    userSettings = { ...userSettings, ...updates };\n    return userSettings;\n  }\n\n  // Get today's prediction count for a user\n  async getDailyPredictionCount(userId: string): Promise<number> {\n    const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\n    \n    const result = await db\n      .select({ count: predictionUsage.count })\n      .from(predictionUsage)\n      .where(\n        and(\n          eq(predictionUsage.userId, userId),\n          eq(predictionUsage.usageDate, today)\n        )\n      );\n    \n    return result[0]?.count || 0;\n  }\n\n  // Increment prediction count for today\n  async incrementPredictionCount(userId: string): Promise<void> {\n    const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\n    \n    // Try to update existing record, or insert new one\n    const existing = await db\n      .select()\n      .from(predictionUsage)\n      .where(\n        and(\n          eq(predictionUsage.userId, userId),\n          eq(predictionUsage.usageDate, today)\n        )\n      );\n    \n    if (existing.length > 0) {\n      // Update existing record\n      await db\n        .update(predictionUsage)\n        .set({ count: sql`${predictionUsage.count} + 1` })\n        .where(\n          and(\n            eq(predictionUsage.userId, userId),\n            eq(predictionUsage.usageDate, today)\n          )\n        );\n    } else {\n      // Insert new record\n      await db.insert(predictionUsage).values({\n        userId,\n        usageDate: today,\n        count: 1,\n      });\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":4041,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null}},"version":2}